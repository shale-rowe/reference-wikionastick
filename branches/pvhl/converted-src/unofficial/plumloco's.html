<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">

<html>
<head>
<meta name="author" content="andre" />
<meta http-equiv="Content-Type" content="text/xhtml; charset=UTF-8" />

<!-- vim:sw=4:ts=4:sts=4:et:nu:
 --><!--
Icons taked from:
http://jimmac.musichall.cz/i.php?i=gorilla-stock

Saving/loading routines taken from:
http://www.tiddlywiki.com/

License:

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of the Osmosoft Limited nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.

-->
<title>new features demo</title>

<!-- JAVASCRIPT -->
<script type="text/javascript" >
//<![cdata[
// vim:sw=4:ts=4:sts=4:et:nu:

function pp(msg){};
function log(msg){
    
    //alert(msg)
}



/////////////////////////////
// javascript.js
// vim:sw=4:ts=4:sts=4:et:nu:
//
// last modified at 16:24 on March 29, 2007 by plumloco@hcoop.net

//  GLOBALS
var debug = true;                   // won't save if it's true

var swap_links_flag = false;
var single_file_flag = true;      

var nosave_flag = false;  // true if editing and only the cancel button is shown

var editing = false;                // true => allow editing, true => viewing only
var current = 'Special::Main Page'; // title of currently loaded page
var backstack = [];     // back button stack
var forstack = [];      // forward button stack
var all_pages = null;
var dead_links = null; 
var books ;
var page_style = null;
var xpage_edit = null;
var file_dir = ''

// Browser 
var ie = false;
var firefox = false;
var opera = false;
var unsupported_browser = true;  
var exporter;
// HTML Interface

function el(e)
{
    if(typeof(e)=='string')
    {
        return document.getElementById(e);
    }
   return e;    
}

function def(x)
{
    return !(typeof(x)=='undefined');
}
function isString(x)
{
    return (typeof(x) === 'string');
}
function isArray(x)
{
    return x instanceof  Array;
}
function eDisplay(e, show)
{
    e = el(e);
    if (e && def(e.style) && def(e.style.display))
    {
        e.style.display = show?'block':'none';
        return e;
    }
    return null;
}

function getHTML(e)
{
    e = el(e);
    if (e && def(e.innerHTML))
    {
        return e.innerHTML;
    }
    return null;
}

function setHTML(e, html)
{
    e = el(e);
    if (e && def(e.innerHTML))
    {
        e.innerHTML = html;
        return e;
    }
    return null;
}

function getValue(e)
{
    e = el(e);
    if (e && def(e.value))
    {
        return e.value;
    }
    return null;
}

function setValue(e, value)
{
    e = el(e);
    if (e && def(e.value))
    {
        e.value = value;
        return e;
    }
    return null;
}


// utility functions

function foreach(a, fn)
{
    var ret;
    for (var i=0; i<a.length; i++)
    {
        if ( fn( a[i], i) === true )
        {
            return true;
        }
    }
    return false;
}

function encode(txt)
{
    return escape(txt);
}

function decode(txt)
{
    return unescape(txt);
}

function isSpecial(link)
{
    link = ulink(link)
    return (/(^|::)Special::/i.test(link)) && !isAdvanced(link);
}
function isScript(link)
{
    link = ulink(link)
    return /(^|::)Script::/i.test(link) ;
}
function isAdvanced(link)
{
    return samepage( link||current, "Special::Advanced")
}
function isTags(link)
{
    link = ulink(link)
    return /(^|::)tags::/i.test(link) ;
}
function isExternal(str)
{
    return (/:\/\//.test(str));
}

function swap_links(xpage)
{
    var reLink = /\[\[([^\]]+)\]\]/gm;
    xpage.body = xpage.body.replace
    (
        reLink,
        function (str, p1)
        {
            var a = p1.split(/\|/);
            if (a.length>1)
            {
                return '[[' + a[1] + '|' + a[0] + ']]';
            }
            return str;
        }
    );
}

// on_load helper
function get_page_list(name)
{
    var title, body, idx, x;
        
    var page_list = {};

    var pages = el(name).childNodes;
    
    for(var i=0; i<pages.length; i++)
    {
        if(pages[i].id)
        {
            
            title = decode(pages[i].id);
            body =decode(getHTML(pages[i]));
            idx = title.toUpperCase();

            if (page_list[idx])
            {
                x = 1;
                while (page_list[idx + ' :' + x])
                {   
                    x+=1;
                }
                title += ' :' + x;
                idx += ' :' + x;
                pages[i].id = encode(title);
            }
            page_list[idx] = new Page(title, body, name);
            if (swap_links_flag)
            {
                swap_links(page_list[idx])
            }
            reapTags(page_list[idx])
        }
    }
    return page_list;
}

function reapTags(xpage)
{
    function do_link(str, $1)
    {
        xpage.tags.add($1);
    }
    xpage.body.replace(/\[\[Tags::([^\]]*)/, do_link)
}

//
// CONSTRUCTOR for Books object
//
//  get, add, remove, iter_books, iter_pages, contains
//
function Books() 
{
    var books_ = {};
    var that = this;
    this.type = 'Books';
    
    this.get = function (book, page)
    {
        var ubook = ulink(book);

        book = ubook in books_ && books_[ubook];

        if ( book && page)
        {
            return book.get(page);
        }
        return book;
    };

    this.add  = function(book, page)
    {
        
        var xbook = this.get(book)
        if (xbook === false)
        {
            books_[(ulink(book))] = new Book(book)
        }
        xbook && page && xbook.add(page)
        return that;
    };

    this.iter_books = function(fn)
    {
        for (var book in books);
        {
            fn(books_[book]);
        }
        return that;
    };

    this.iter_pages = function(fn)
    {
        for (var book in books_)
        {
            books_[book].iter_pages(fn);
        }
        return that;
    };

    this.contains = function(page)
    {
        for (var book in books_)
        {
            if (books_[book].contains(page))
            {
                return true;
            }
        }
        return false;
    };

    this.remove = function(book, page)
    {
        book = this.get(book);
        return book && book.remove(page); 
    };
}

books = new Books();



// CONSTRUCTOR for Book objects.
//
// get, add, remove, contains, iter_pages
//
function Book(name)
{
    this.type = 'Book';
    var pages_ = get_page_list(name);
    var that = this;
    
    this.title = name;

    this.get = function(page)
    {
        var upage = ulink(page);
        return (upage in pages_) && pages_[upage]
    };

    this.add = function(page)
    {
        if (page.type == 'Page')
        {
            pages_[ulink(page)] = page;
        }
        else
        {
            alert(this.type + ': ' + this.title + ' can\'t add page');
        }
        return that;
    };


    this.iter_pages = function(fn)
    {
        for (var page in pages_)
        {
            fn(pages_[page]);
        }
        return that;
    };


    this.remove = function(page)
    {
        if (!this.contains(page))
        {
            return false;
	    alert ('cannot delete \'' + page + '\'from book \'' + '\' this.title\n\nThe page does not exist.')
        }
        delete pages_[ulink(page)];

    };


    this.contains = function(page)
    {
        return ulink(page) in pages_;
        
    };
}


// CONSTRUCTOR for Page objects.
function Page(title, body, book)
{
    this.type = 'Page';
    this.title = title;
    this.body = body;
    this.book = book || 'wiki';
    this.tags = new SetOfTags();
}

// On Load Helpers.

function get_books()
{
    books.add('wiki').add('variables')
}



// Returns true if a page exists. 
//  Special pages always exist.
function page_exists(page)
{
    return isSpecial(page) || books.contains(page);
}

// Returns the value of a wiki variable (wiki variable names end with a '_')
function get_var(name)
{
    return get_text(name + '_', 'variables');
}


// Sets the value of a wiki variable
function set_var(name, value)
{
    name = name + '_';
    var xpage = books('variables', name);
    if (xpage)
    {
        set_page(new Page(name, value, 'variables'));
    }
}

function get_text(title, book)
{
    var page;

    book = book || 'wiki';
    page = books.get(book, title);
    return  page.body;
}


function special_export_single_webpage(testing)
{
    return exporter.single('wiki', testing);
}
function special_export_multiple(testing)
{
    return exporter.multiple('wiki', testing);
}


// Returns an index of all pages
function special_all_pages()
{
    var title, p, pg = [], pgs = [];
    books.get('wiki').iter_pages
    (
        function(xpage)    
        {
            if ( (isSpecial(xpage) || isAdvanced(xpage)))
            {
                pgs.push("++ [[" + xpage.title + "]]")
                pp("special++ [[" + xpage.title + "]]")
            } else {
                pg.push("++ [[" + xpage.title + "]]")
                pp("normal++ [[" + xpage.title + "]]")
            }
        }
    );
            
    log()
    p = '+ Special Pages\n'
    + pgs.sort().join("\n")
    + '\n\n+ Wiki Pages\n'
    + pg.sort().join("\n");
    return p + '\n';
}

function ulink(link)
{
    if (link)
    {
        return  (isString(link) ? link : link.title).toUpperCase();
    }
    else
    {
        //alert('Bad link in ulink ', + link)
        return false;
    }
}


// CONSTRUCTOR for SetOfLinks OBJECT.
//  This object manages a Set of links. 
//   Two links are identical if the upper cased versions of each are identical.
//    Adding a link identical to one already in the set increments a counter for that link.
//
// add, remove, toString, contains, iter_pages, remove_specials
//
function SetOfLinks(){

    var links_ = {};
    var that = this;


    this.add = function(link)
    {
        link = ulink(link);

        if (link in links_)
        {
            links_[link] += 1;
        }
        else
        {
            links_[link] = 1;
        }
        return that
    };

    this.remove = function(link)
    {
        link = ulink(link);
        if (link in links_)
        {
            delete links_[link];
        }
        return that;
    };

    var links = function(sorted)
    {   
        var links = [];
        for (var link in links_)
        {
            links.push(link);
        }
        return (sorted?links.sort():links);
    };

    this.toString = function (sorted)
    {
        var s = '', slink, xpage;
        foreach
        (
            links(sorted),
            function (link)
            {
                xpage = get_page(link)
                slink =  xpage?xpage.title:link
                s += '[[' + slink + ']] (' + links_[link] + ')\n';
            }
        );    
        return s;
    };

    this.contains = function (link)
    {
        link = ulink(link)
        return link in links_ && links_[link];
    };
    
    this.iter_pages = function(sorted, fn)
    {
        if (sorted !== true)
        {
            fn = sorted;
            sorted = false
        }
        foreach
        (
            links(sorted),
            function (link)
            {
                fn(get_page(link));
            }
        );    
        return that;
    };

    this.remove_specials = function(flag)
    {
        foreach
        (
            links(false),
            function(link)
            {
                if (isSpecial(link) || (flag && isAdvanced(link)))
                {
                    delete links_[link];
                }
            }
        );
        return that;
    };
}
// CONSTRUCTOR for SetOfTags OBJECT.
//  This object manages a Set of tags. 
//   Two tags are identical if the upper cased versions of each are identical.
//    Adding a tag identical to one already in the set increments a counter for that tag
//
//  FIXME: should use inheritance !.
//  
// add, remove, toString, contains, iter_tags
//
function SetOfTags(){

    var links_ = {};
    var that = this;
    var length = 0
    this.length = 0

    this.add = function(link)
    {
        link = ulink(link);

        if (link in links_)
        {
            links_[link] += 1;
        }
        else
        {
            links_[link] = 1;
            length +=1;
            this.length = length
        }
        return that
    };

    this.remove = function(link)
    {
        link = ulink(link);
        if (link in links_)
        {
            delete links_[link];
            length -= 1;
            this.length  = length
        }
        return that;
    };

    var links = function(sorted)
    {   
        var links = [];
        for (var link in links_)
        {
            links.push(link);
        }
        return (sorted?links.sort():links);
    };
    var tags = links

    this.toString = function (sorted)
    {
        var s = '';
        foreach
        (
            links(sorted),
            function (link)
            {
                s += '[[' + link + ']] (' + links_[link] + ')\n';
            }
        );    
        return s;
    };

    this.contains = function (link)
    {
        link = ulink(link)
        return link in links_ && links_[link];
    };
    
    this.iter_tags = function(sorted, fn)
    {
        if (sorted !== true)
        {
            fn = sorted;
            sorted = false
        }
        foreach ( links(sorted), fn );    
        return that;

    };

    this.show = function ()
    {
        return length && !('NOTAGS' in links_)
    }
    
    this.clear = function ()
    {
        links_ = {}
        this.length = length = 0
    }
}

// reap_links takes a page object and 
// finds and creates a SetOfLinks object contining refs
// to all pages that this page links to providing they exist,
// and stores that set in the pages 'to' property.
//
// In addition any link it finds to a non existant page is
// added to the global dead_links object (which is a SetOfLinks.
//
//
function reap_links(xpage)
{
    function do_link(str, $1)
    {
        var pos, link, data;

        pos = $1.indexOf('|');
        if (pos > -1)
        {
            link = $1.slice(0, pos);
            data = $1.slice(pos + 1, -2);
        }
        else
        {
            link = $1.slice(0, -2);
            data = null;
        }
        if ((!link) || isSpecial(link) || isExternal(link))
        {   
            return str;
        }
        if (page_exists(link))
        {
            xpage.to.add(link);
        }
        else
        {
            dead_links.add(link);
        }
        return str;
    }

    xpage.body.replace(reReapLinks, do_link);
}

/// get_links makes two passes over each page object
//
// in the first pass, it uses reap_links to create a
// a list for each page of what pages it links to.
//
// in the second pass it visits each page that a page
// links to and adds a reference to this page to the target
// pages SetOfLinks, stored in its 'from' poperty,
//

function get_links()
{

    dead_links = new SetOfLinks();
    all_pages = new SetOfLinks();

    books.iter_pages 
    (
        function(xpage)
        {
            xpage.from = new SetOfLinks();
            xpage.to = new SetOfLinks();
            all_pages.add(xpage);
        }
    );
    books.iter_pages
    (
        function(xpage)
        {
            reap_links(xpage)
            xpage.to.iter_pages
            (
                function(xp)
                {   
                    xp.from && xp.from.add(xpage)
                }
            );
            
        }
    );
    //log()
    
    
}

// Returns a list of all links to pages that do not exist
//  and how many references to each of those pages.
function special_dead_pages()
{
    get_links();
    return dead_links.toString(true);
}

// a utility function to test if a feature is not availiable to special:: pages.
function not_for_special(link)
{
    if (isSpecial(link||current)){
        alert( '    Sorry!\nThis feature does not work for Special:: pages.');
        return true;
    }
    return false;
}

// a function to get a formated list of pages that link to the
// current page. called when special::Backlinks is selected.
//
function special_back_links()
{
    if ( not_for_special())
    {
        return false;
    }
    get_links();

    var page = get_page(current);
    if (page!==null)
    {
        return page.from.toString(true);
    }
    return false;     
}

// creates a SetOfLinks that represents a list of all pages
// that can be reached from the MainPage or SideMenu.
// 
function set_of_reachables()
{
    get_links();

    var xpage;
    var list = new SetOfLinks();
    var stk = [
        get_page(get_var('Main_Page')),
        get_page('Special::Edit menu')
    ];

    // build list of links that can be reached from MainPage or SideMenu.
    while (stk.length)
    {
        xpage = stk.pop();
        list.add(xpage);
        xpage.to.iter_pages 
        (
            function(xp)
            {
                if (!list.contains(xp))
                {
                    stk.push(xp);
                }
            }
        );         
    }
    return list;
}
  
// Returns an index of all orphaned pages.
// An orphaned page is a page that can not be reached from the MainPage or the side menu.


// Generates a formated list of 'orphaned' objects. 'Orphans' are
// pages that can not be reached from the MainPage or the SideMenu.
//
function special_orphaned_pages()
{

    var reachables = set_of_reachables();

    // all pages - reachables = orphans

    var orphans = [];
    books.get('wiki').iter_pages
    (
        function(xpage)
        {
            if (!reachables.contains(xpage))
                {
                    orphans.push(xpage.title);
                }
        }
    );
    return '[[' + orphans.sort().join(']]\n[[') + ']]';
}


// Generates a formated list of all reachable pages.
function special_reachable_pages()
{
    var reachables = [];
    books.get('wiki').iter_pages
    (
        function(xpage)
        {
            reachables.push(xpage.title);
        }
    );
    return '[[' + reachables.sort().join(']]\n[[') + ']]';
}

function show_pages_with_tag(tag)
{
    pages = new SetOfLinks()
    books.get('wiki').iter_pages
    (
        function(xpage)
        {
            if (xpage.tags.contains(tag))
            {
                pages.add(xpage)
            }
        }
    );
    return pages.toString()
}

// Special edits
function edit_special(page, text, nosave)
{
    current = page;
    document.title = page;
    setHTML("title", page);
    adjust_menu(1, nosave);
    setValue('page_title', page);
    setValue('editor', text);
    el('editor').focus();
}

// global utility function which returns the CSS style for this wiki.

function get_page_style()
{
    return getHTML(page_style);

}

// global utility function which returne the javascript for this page

function get_page_title()
{
    return getHTML(document.getElementsByTagName("title")[0]);
}

// global utility function which set the Css style for this wiki.
// the changes take effect instantly, so this makes stikwiki useful
// for experimenting whith CSS.
//
function set_page_style(css)
{
    return setHTML(page_style, css);
}


// Load a new current page
//
// This is the main function which controls the wiki.
//
function set_current(cr)
{
    var text = null;
    var noParse=false
    if (cr && samepage(cr, 'Special::Main Page'))
    {
        cr = false;
    }
    cr = cr || get_var('main_page');

    if(isSpecial(cr))
    {
        switch(cr.slice(9).toLowerCase())
        {
            case "advanced":
                text = get_text(cr);
                break;

            case "all pages":
                text = special_all_pages();
                break;

            case "orphaned pages":
                text = special_orphaned_pages();
                break;

            case "reachable pages":
                text = special_reachable_pages();
                break;

            case "pages not yet created":
                text = special_dead_pages();
                break;

            case "backlinks":
                text = special_back_links();
                if (text === false)
                {
                    go_to_best();
                    return;
                }
                break;


            case "block edits":
                if(permitEdits())
                {
                    set_var("permit_edits", "0");
                    eDisplay("menu_edit", false);
                    eDisplay("menu_edit_button", false);
                    eDisplay("unsupported_browser", false);
                    alert("Edits blocked.");
                }
                else
                {
                    set_var("permit_edits", "1");
                    eDisplay("menu_edit", true);
                    eDisplay("menu_edit_button", true);
                    if(unsupported_browser)
                    {
                        eDisplay("unsupported_browser", true);
                    }
                    alert("Edits unblocked.");
                }
                saveThisFile();
                go_to_best();
                return;

            case "edit css":
                return edit_special(cr, get_page_style());

            case "edit menu":
                return edit_special(cr, get_text(cr));

            case "export single webpage":
                text = special_export_single_webpage();
                return 

            case "export multiple webpages":
                text = special_export_multiple();
                return 
             
            case "show parsed text":
               return edit_special(cr, parse(get_page(current)).replace(/<br \/>/g, '<br />\n').replace(/(<\/[^>]+>)/g, '$1\n'), true);

            default:
                alert('Invalid Special "' + cr + '"');
                return;
        }
    }
    else
    {
        if (isTags(cr))
        {
            var tag =  cr.slice(6)
            text = new Page('tags::'+ tag, '...')
            text.body = show_pages_with_tag(tag);
            set_page(text)
        }
        else
        {
            text = get_page(cr)
            if (!text)
            {
                if (!samepage(cr, 'New page') &&
                    !confirm("Page not found. Do you want to create it?"))
                         return;
            
                text =  new Page(cr, "Insert text here.\n\n\n\n\n[[Tags::New]]", 'wiki');
                set_page(text);
                current = cr
                newpage_flag = true;
                edit()
                return
            }
        }
    }
    current = cr;
    setHTML("wiki_text", noParse?text:parse(text));
    setHTML("menu_area", parse(get_menu_page()));


    setHTML("title", cr);
    document.title = cr;
    
    setHTML("lastDate", document.lastModified);

    adjust_menu(0);
}

// when the page is loaded
function on_load()

{
    var flag;

    document.body.style.cursor = "auto";
 
    firefox = navigator.appName == "Netscape";
    ie = !firefox && (navigator.appName).indexOf("Microsoft")!=-1;

    // finds out if Opera is trying to look like Mozilla
    if(firefox  && navigator.product != "Gecko")
    {
        firefox = false;
    }

    // finds out if Opera is trying to look like IE
    if(ie && navigator.userAgent.indexOf("Opera") != -1)
    {
        ie = false; 
    }

    page_style = document.getElementsByTagName("style")[0];
    setup_menu();
    get_books();
    
    eDisplay("debug_info", debug);

    flag = permitEdits();
    eDisplay("menu_edit", flag);
    eDisplay("menu_edit_button", flag);

    flag = flag && !(firefox || ie) ;

    unsupported_browser = flag;
    eDisplay("unsupported_browser", flag);

    var icons = ['back', 'forward', 'home', 'edit', 'cancel', 'save', 'advanced'];
    var icon_codes = ["&#223;", "&#224;", "G", "&#33;", "&#253;" ,"&#60;", ":"];

    foreach
    (
        icons,
        function (icon, idx)
        {
            eDisplay('img_' + icon, !ie);
            eDisplay('alt_' + icon, ie);
            setHTML('alt_' + icon, icon_codes[idx]);
        }
    );
    get_filename();
    exporter = new Exporter()
    // Go straight to page requested
    var docref = document.location.href.split("#")[1];
 
    if(docref && page_exists(unescape(docref)))
    {
        set_current (unescape(docref));
    }
    else
    {
        set_current();
    }

}

function permitEdits()
{
     return get_var("permit_edits") == "1"   
}

// Adjusts the menu. 0 for viewing, 1 for editing
function adjust_menu(editing, nosave)
{
    switch(editing)
    {
        
        case 0:
            // check for back and forward buttons - TODO grey out icons
            eDisplay("menu_back", backstack.length); 
            eDisplay("menu_forward", forstack.length);

            eDisplay("menu_advanced", !isAdvanced());

            eDisplay("menu_home", true);
            eDisplay("menu_edit", permitEdits() && !isSpecial(current));
   
            eDisplay("menu_save", false);
            eDisplay("menu_cancel", false);
            eDisplay("text_area", true);
            eDisplay("edit_area", false);

            xpage_edit = null
            nosave_flag = newpage_flag = false
            break;


        case 1:
            nosave_flag = nosave;
            foreach
            (
                ['back', 'forward', 'advanced', 'home', 'edit'],
                function (item)
                {
                    eDisplay('menu_' + item, false);
                }
            );
            eDisplay("text_area", false);

            eDisplay("menu_save", !nosave);
            eDisplay("menu_cancel", true);
            if(!ie)
            {
                el("editor").style.width = window.innerWidth - 30 + "px";
                el("editor").style.height = window.innerHeight - 150 + "px";
            }
            eDisplay("edit_area", true);
            eDisplay("edit_page_title", !nosave && !isSpecial(current));

            xpage_edit = get_page(current)
            break;
    }
}

// when edit is clicked
function edit()
{
    adjust_menu(1);
    setValue("page_title", current);
    setValue("editor", get_text(current));
    el("editor").focus();
}


function set_page(xpage)
{

    var book = xpage.book
    var title = xpage.title
    books.add(book, xpage)
}


function get_main_page()
{
    return get_page(get_var('main_page'));
}

function set_main_page(page)
{
    if (!isString(xpage)) page = page.title;
    set_var('main_page', xpage);
}

function get_menu_page()
{
    return get_page('special::edit menu');
}


function get_page(title, book)
{
    
    return books.get(book||'wiki', title);
}


// this function expects get_links to have already been called
function change_links(text, from, to)
{
    var ufrom = ulink(from)
    var uto = ulink(to)

    function change_link(str, $1)
    {
        var a, link, data;
        
        pos = $1.indexOf('|');
        if (pos > -1)
        {
            link = ulink($1.slice(0, pos));
            data = $1.slice(pos + 1, -2);

            return (link === ufrom) ? '[[' + to + '|' + data + ']]' : str;
        }
        else
        {
            link = ulink($1.slice(0, -2));
            return (ulink == ufrom) ? '[[' + to + ']]' : str;
        }
    }
    return text.replace(reReapLinks, change_link);
}


function samepage(a, b)
{
    return ulink(a) === ulink(b);
}

function rename_page(previous, newpage)
{

    var xpage, backlinks, errmsg;


    errmsg = false

    if (isSpecial(previous) || isSpecial(newpage))
    {
        errmsg = 'Can\'t rename from or to a Special:: page'
    }


    if (!samepage(previous, newpage) && page_exists(newpage))
    {
        errmsg =  newpage + '" already exist, you must rename it or delete it' + '\n'
            + 'before renaming this page.'
    }

    if (errmsg)
    {
        alert
        (
            'Can not rename "' 
            + previous + '" to "' + newpage + '"\n\n"'
            + errmsg
        );
        return false;
    }

    if (!confirm(('rename\n' + previous + '\n' + newpage))) return false;

    if(samepage(previous, get_main_page()))
    {
        set_main_page(newpage);
    }

    xpage = get_page(previous);
    
    if (!xpage) 
    {
        alert('No page named "' + previous +'"!');
        return false;
    }

    get_links();

    xpage.title = newpage;
    set_page(xpage);

    xpage.from.iter_pages 
    (
        function(xp)
        {
            xp.body = change_links(xp.body, previous, newpage);
            set_page(xp);
        }
    );
    return true    
}


// when a page is deleted
function delete_page(title, book)
{
    books.remove(book || 'wiki', title);
}


// when save is clicked
function save()
{
    var editor = el("editor");
    var text = getValue(editor);

    var title = getValue("page_title");
    var xpage;

    switch(current.toLowerCase())
    {
        case "special::edit css":
            set_page_style(text);
            go_to_best();
            break;

        case "special::edit menu":
            xpage = get_page(current);
            xpage.body = text;
            set_page(xpage);
 
            setHTML("menu_area", parse(xpage));
            go_to_best();
            break;

        default:
            // check if text is empty
            if (text === "")
            {
                if(confirm("Are you sure you want to DELETE this page?"))
                {
                    delete_page(current);
                    go_to_best();
                    return;
                }
                return;
            }
            else
            {
                xpage = xpage_edit
                if (xpage_edit)
                {
                    xpage.body = text
                    if (ulink(title) !== ulink(xpage))
                    {
                        var retval = rename_page(current, title);
                        if (samepage(xpage, 'New Page') && !retval) return edit();
                    }
                    else
                    {
                        if (samepage(xpage, 'New Page'))
                        {
                            alert('You must rename New Page before you save it.');
                            return edit();
                        }
                    }
                }
                else
                {
                    alert('no xpage_edit')
                }
                set_page(xpage)
                set_current(title);
            }
    }
    adjust_menu(0);
    saveThisFile();
}
// when cancel is clicked
function cancel()
{
        if (nosave_flag)
        {
            adjust_menu(0);
            go_to_best();
            return
        }
    
        if(!confirm("Are you sure you want to cancel this edit?"))
        {
            return;
        }
        if (samepage(current, 'New Page'))
        {
           delete_page(current)
        }
        adjust_menu(0);
        go_to_best();

}

// when home is clicked
function home()
{
    go_to(get_var("main_page"));
    var flag = (permitEdits());
    eDisplay("menu_edit", flag);
    eDisplay("menu_edit_button", flag);
}

// when Advanced is clicked
function advanced()
{
    go_to("Special::Advanced");
}

function go_to_best()
{
    if (!go_back())
    {
        if (!go_forward())
        {
            set_current();
        }
    }
}

function go_to_encoded(link)
{
    go_to(unescape(link.replace(/_/g, '%')))
}


// follows a link
function go_to(cr)
{
    if(cr && !samepage(cr, current))
    {
        isSpecial(current) || backstack.push(current)
        forstack  = [];
    }
    set_current(cr);
}

// when Back button is clicked
function go_back()
{
    if(backstack.length)
    {
        isSpecial(current) || forstack.push(current)
        set_current(backstack.pop());
        return true;
    }
    return false;
}

// when Forward button is clicked
function go_forward()
{
    if(forstack.length)
    {
        isSpecial(current) || backstack.push(current)
        set_current(forstack.pop());
        return true;
    }
    return false;
}

function show_tag(tag)
{
    go_to('tags::'+tag);
}


window.onload = on_load;







/////////////////////////////
// loadsave.js
function get_filename()
{
    var filename = document.location.toString().split("#")[0];
    filename = filename.replace("file:///", "");
    filename = filename.replace(/%20/g, " ");
    file_dir = filename.replace(/\/[^\/]*$/, '/')

    if(navigator.appVersion.indexOf("Win")!=-1)
    {
        filename = filename.replace(/\//g, "\\");
    }
    else
    {
        filename = "/" + filename;
    }
    return filename;  
}
// save this file
function saveThisFile()
{
    var filename, msg='';

    filename = document.location.toString().split("#")[0];
    filename = filename.replace("file:///", "");
    filename = filename.replace(/%20/g, " ");
    if(navigator.appVersion.indexOf("Win")!=-1)
    {
        filename = filename.replace(/\//g, "\\");
    }
    else
    {
        filename = "/" + filename;
    }
    if(unsupported_browser)
    {
        msg = "Saving on disk is not upported on this browser";
    }
    if(debug)
    {
        msg = "DEBUG MODE is on.";
    }        
    if (unsupported_browser || debug)
    {
        alert (
        msg
        +'\n\nAny changes you have made will NOT be saved'
        +'\n\nInstead, an edit box, containing the text that'
        +'\nwould have been saved, is shown'
        +'\n\nCut & Paste can then be used to copy the text'
        +'\ninto an editor where it can be examined and then saved.'
        +'\n'
        +'\nIn Firefox, filling the textbox is very slow but in'
        +'\nOpera it is very fast.'
        );

        return edit_special('Generated File Contents', generate_entire_page(), true);
        
    }
    saveFile( filename, generate_entire_page() );
}

function generate_entire_page()
{
    return ''
+'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"\n'
+ '"http://www.w3.org/TR/html4/loose.dtd">\n'
+ '\n<html>\n<head>'
+ '\n<meta name="author" content="andre" />'
+ '\n<meta http-equiv="Content-Type" content="text/xhtml; charset=UTF-8" />\n'
+ generate_license()
+ '\n<title>'
+ get_page_title()
+ '</title>'
+ '\n\n<!-- JAVASCRIPT -->\n'
+ generate_script()
+ '\n\n<!-- CSS -->\n'
+ '<style>'
+ get_page_style()
+ '</' + 'style>'
+ '\n\n</head>'
+ '\n\n<body id="body">\n\n'
+ '\n\n<!-- WIKI -->\n'
+ generate_data('wiki')
+ '\n\n<!-- VARIABLES -->\n'
+ generate_data('variables')
+ "\n\n</body></html>\n";
}

function generate_data(book)
{
    var  data = []
    books.get(book).iter_pages
    (
        function (xpage)
        {
            data.push(
                 '<div id="' + encode(xpage.title) + '">'
                + encode(xpage.body)
                + '</div>'
            );
 
        }
    );
    return '<div id="' + encode(book) + '" style="display:none">\n\n' + data.join('\n\n') + '\n\n</div>';
}

function generate_script()
{
        return '<script type="text/javascript">' + getHTML(document.getElementsByTagName("script")[0]) + '</' + 'script>';
	
       //return generate_external_script()
}
function generate_external_script()
{	
	return '<script type="text/javascript" src="js/mywiki.js"' + '>' + '</' + 'script>';
}

// Copied from TiddyWiki
function saveFile(fileUrl, content)
{
    var r = null;
    r = mozillaSaveFile(fileUrl, content);
    if((r === null) || (r === false))
    {
        r = ieSaveFile(fileUrl, content);
    }
    if((r === null) || (r === false))
    {
        r = operaSaveFile(fileUrl, content);
    }
    return(r);
}

function loadFile(filePath)
{
    var r = null;
    r = mozillaLoadFile(filePath);
    if((r === null) || (r === false))
    {
        r = ieLoadFile(filePath);
    }
    if((r === null) || (r === false))
    {
        r = operaLoadFile(filePath);
    }
    return(r);
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function ieSaveFile(filePath, content)
{
    try
    {
        var fso = new ActiveXObject("Scripting.FileSystemObject");
    }
    catch(e)
    {
        return(null);
    }
    var file = fso.OpenTextFile(filePath,2,-1,0);
    file.Write(content);
    file.Close();
    return(true);
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function ieLoadFile(filePath)
{
    try
    {
        var fso = new ActiveXObject("Scripting.FileSystemObject");
        var file = fso.OpenTextFile(filePath,1);
        var content = file.ReadAll();
        file.Close();
    }
    catch(e)
    {
        //alert("Exception while attempting to load\n\n" + e.toString());
        return(null);
    }
    return(content);
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function mozillaLoadFile(filePath)
{
    if(window.Components)
    {
        try
        {
            netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
            var file = Components.classes["@mozilla.org/file/local;1"]
                .createInstance(Components.interfaces.nsILocalFile);
            file.initWithPath(filePath);
            if (!file.exists())
            {
                return(null);
            }
            var inputStream = Components.classes["@mozilla.org/network/file-input-stream;1"]
                .createInstance(Components.interfaces.nsIFileInputStream);
            inputStream.init(file, 0x01, 4, null);

            var sInputStream = Components.classes["@mozilla.org/scriptableinputstream;1"]
                .createInstance(Components.interfaces.nsIScriptableInputStream);
            sInputStream.init(inputStream);

            return(sInputStream.read(sInputStream.available()));
        }
        catch(e)
        {
            alert("Exception while attempting to load\n\n" + e);
            return(false);
        }
    }
    return(null);
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function mozillaSaveFile(filePath, content)
{
    if(window.Components)
    {
        try
        {
            netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
            var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
            file.initWithPath(filePath);
            if (!file.exists())
            {
                file.create(0, 6*64 + 6*8 + 4);
            }
            var out = Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);
            out.init(file, 0x20 | 0x02, 4,null);
            out.write(content, content.length);
            out.flush();
            out.close();
            return(true);
        }
        catch(e)
        {
            return(false);
        }
    }
    return(null);
}

function operaUrlToFilename(url)
{
    var f = "//localhost";
    if(url.indexOf(f) === 0)
    {
        return url.substring(f.length);
    }
    var i = url.indexOf(":");
    if(i > 0)
    {
        return url.substring(i-1);
    }
    return url;
}

function operaLoadFile(filePath)
{
    var content = [];
    try
    {
        var r = new java.io.BufferedReader(new java.io.FileReader(operaUrlToFilename(filePath)));
        var line;
        while ((line = r.readLine()) !== null)
        {
            content.push(new String(line));
        }
        r.close();
    }
    catch(e)
    {
        if(window.opera)
        {
            opera.postError(e);
        }
        return null;
    }
    return content.join("\n");
}

function operaSaveFile(filePath, content)
{
    try
    {
        var s = new java.io.PrintStream(new java.io.FileOutputStream(operaUrlToFilename(filePath)));
        s.print(content);
        s.close();
    }
    catch(e)
    {
        if(window.opera)
        {
            opera.postError(e);
        }
        return null;
    }
    return true;
}

/////////////////////////////
// display.js
// vim:sw=4:ts=4:sts=4:et:nu:
// code to create a single webpage of the wiki


// code to generate the html for the title and main menu for a page.
// must be called in on_load

function setup_menu() {

  var a = [
    'back', 'go_back',
    'forward', 'go_forward',
    'advanced', 'advanced',
    'home', 'home', 
    'edit', 'edit',
    'cancel', 'cancel',
    'save', 'save' ];

  var s;
  var ss =  '\n<table cellspacing="0"><tbody><tr>\n<td style="width: 100%;" valign="bottom">';
      ss += '<p class="title" id="title">Main Page</p></td>';
      ss += '\n';
  for (var i=0;i<a.length; i+=2){
    s =  '\n<td class="menu" onclick="' + a[i + 1] + '()">'
    + '\n<div style="display: block; cursor: pointer;" id="menu_' + a[i] +'">'
    + '\n<img style="display: block;" id="img_' + a[i] +'" alt="&nbsp;' + a[i] + '&nbsp;" src="images/' + a[i] + '.png" />'
    + '\n<span id="alt_' + a[i] + '" style="display: none; font-family: wingdings; font-size: 24pt;">*</span>'
    + '\n</div></td>\n\n';
    ss += s;
  }
ss +=
 '</tr></tbody></table><hr />'
+'    <div style="display: none;" id="debug_info">\n'
+'       <i>If you see this text, you\'re using a development version. It won\'t save on disk until you find the line that says </i>\n'
+'        <b><tt>var debug = true;</tt></b>\n'
+'        <i> and change it to </i>\n'
+'        <b><tt>false</tt></b>.\n'
+'        </div>\n'
+'\n'
+'    <div style="display: none;" id="unsupported_browser">\n'
+'        <i>Your browser is not supported. You can access the wiki but you won\'t be able to save. Sorry.</i>\n'
+'    </div>\n'
+'    <!-- Left Navigation Menu -->\n'
+'    <table style="display: block;" id="text_area" cellspacing="10"><tbody><tr>\n'
+'        <td valign="top">\n'
+'            <div class="menu_area">\n'
+'                <div class="wiki" id="menu_area">\n'
+'                    &nbsp;\n'
+'                </div>\n'
+'                <div style="display: block;" id="menu_edit_button">\n'
+'                    <hr>\n'
+'                    <div style="text-align: center;">\n'
+'                        <a class="link" onclick="go_to(\'Special::Edit Menu\')">[Edit]</a>\n'
+'                    </div>\n'
+'                </div>\n'
+'            </div>\n'
+'        </td>\n'
+'    <!-- End of left Navigation menu -->\n'
+'\n'
+'    <!-- Main window -->\n'
+'        <td style="width: 88%;" rowspan="2" valign="top">\n'
+'            <div class="text_area" id="wiki_text">Insert text here.</div>\n'
+'        </td>\n'
+'    <!-- End of main window -->\n'
+'\n'
+'    </tr><tr>\n'
+'        <td>&nbsp;</td>\n'
+'\n'   
+'    </tr>\n' 
+'    </tbody></table>\n'
+'\n'
+'    <!-- Editor -->\n'
+'    <div style="display: none;" id="edit_area">\n'
+'        <div style="display: block;" id="edit_page_title">\n'
+'            Page title: <input id="page_title" type="text">\n'
+'        </div>\n'
+'        <textarea style="width: 986px; height: 433px;" cols="0" rows="0" id="editor">\n'
+'            &nbsp;\n'
+'        </textarea>\n'
+'        <table style="font-size: 8pt;">\n'
+'            <tbody><tr>\n'
+'                <td>[[link]]</td>\n'
+'                <td>[[http://link.com]]</td>\n'
+'                <td>*bold*</td>\n'
+'                <td>+ list</td>\n'
+'                <td>!header</td>\n'
+'                <td>--- (ruler)</td>\n'
+'                <!-- JC - help note for math mode -->\n'
+'                <td>$math mode$</td>\n'
+'            </tr>\n'
+'            <tr>\n'
+'                <td>[[text|link]]</td>\n'
+'                <td>_underline_</td>\n'
+'                <td>/italic/</td>\n'
+'                <td># numbered list</td>\n'
+'                <td>!!subheader</td>\n'
+'                <td><a class="world" onclick="open_table_help()">(tables)</a></td>\n'
+'            </tr>\n'
+'        </tbody></table>\n'
+'    </div>\n';


var node = document.createElement('div');
node.innerHTML = ss;

document.body.insertBefore(node, document.body.firstChild);
}
function open_table_help()
{
    var s =  ""
+"<html><head><title>Building tables<\/title><\/head><body>"
+"<span class='u'>Building tables:<\/span><br /><br />"
+"<tt>{|   <\/tt><br />"
+"<tt>|+ Table Caption<\/tt><br />"
+"<tt>| *colum 1* || *column 2* || *column 3*<\/tt><br />"
+"<tt>|-<\/tt><br />"
+"<tt>| line 2 || [[a link]] || something<\/tt><br />"
+"<tt>|-<\/tt><br />"
+"<tt>| line 3 || || more stuff<\/tt><br />"
+"<tt>|}   <\/tt>"
+"<\/body><\/html>";

    var w = window.open("about:blank", "help", "height=200px, width=350px, menubar=no, toolbar=no, location=no, status=no, dialog=yes");
    w.document.write(s);
    w.document.close();
}
/////////////////////////////
// display.js
// vim:sw=4:ts=4:sts=4:et:nu:
//

function generate_license()
{
    return ''
+'\n<!-- vim:sw=4:ts=4:sts=4:et:nu:'
+'\n --><!--'
+'\nIcons taked from:'
+'\nhttp://jimmac.musichall.cz/i.php?i=gorilla-stock'
+'\n'
+'\nSaving/loading routines taken from:'
+'\nhttp://www.tiddlywiki.com/'
+'\n'
+'\nLicense:'
+'\n'
+'\nRedistribution and use in source and binary forms, with or without modification,'
+'\nare permitted provided that the following conditions are met:'
+'\n'
+'\nRedistributions of source code must retain the above copyright notice, this'
+'\nlist of conditions and the following disclaimer.'
+'\n'
+'\nRedistributions in binary form must reproduce the above copyright notice, this'
+'\nlist of conditions and the following disclaimer in the documentation and/or other'
+'\nmaterials provided with the distribution.'
+'\n'
+'\nNeither the name of the Osmosoft Limited nor the names of its contributors may be'
+'\nused to endorse or promote products derived from this software without specific'
+'\nprior written permission.'
+'\n'
+'\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY'
+'\nEXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES'
+'\nOF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT'
+'\nSHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,'
+'\nINCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED'
+'\nTO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR'
+'\nBUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN'
+'\nCONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN'
+'\nANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH'
+'\nDAMAGE.'
+'\n'
+'\n-->'
}


/////////////////////////////
// parser.js
// vim:sw=4:ts=4:sts=4:et:nu:
//
var end_trim = true
function str_rep(s, n) {
  var r = "";
   while (--n >= 0) r += s;
   return r;
}

var reReapLinks = function()
{
    var UntilRS = "[^\\]]*\\]";
    var Until2RS = UntilRS + "(?:[^\\]]" + UntilRS + ")*\\]";
    return new RegExp('\\[\\[(' + Until2RS + ')', 'g');
}();

 

// thanks to S.Willison
RegExp.escape = function(text) {
  if (!arguments.callee.sRE) {
    var specials = [
      '/', '.', '*', '+', '?', '|',
      '(', ')', '[', ']', '{', '}', '\\'
    ];
    arguments.callee.sRE = new RegExp(
      '(\\' + specials.join('|\\') + ')', 'g'
    );
  }
  return text.replace(arguments.callee.sRE, '\\$1');
}


function _random_string(string_length) {
    var chars = "ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";
    var randomstring = '';
    for (var i=0; i<string_length; i++) {
        var rnum = Math.floor(Math.random() * chars.length);
        randomstring += chars.charAt(rnum);
    }
    return randomstring;
}

var parse_marker = "#"+_random_string(8);

function header_replace(hdr, text) {
    return text.replace( new RegExp("(^|\n)"+RegExp.escape(hdr)+"([^"+RegExp.escape(hdr.charAt(0))+"].*)", "g"),    function (str, $1, $2) {
        var l = hdr.length, header;
        if ($2.indexOf(hdr)==$2.length-l)
            header = $2.substr(0, $2.length-l);
        else
            header = $2;
        return "<h"+l+">"+header+"<\/h"+l+">";
    });
}

function parse( text)
{
    tags = new SetOfTags()
    
    var xpage = null;
    var i, s

    if (!isString(text))
    {
        xpage = text;
        text = xpage.body;
        if (isScript(xpage))
        {
            return '<pre>'
            + text.replace(/&/g, '&amp;')
                       .replace(/</g, '&lt;')
                       .replace(/>/g, '&gt;')
                       .replace(/%/g, '&#37;')
             + '</pre>';
        }
    }

    if (text == null) {
        log("text = null while parsing current page \""+current+"\"");
        return;
    } else
//      log("typeof(text) = "+typeof(text));

    var prefmt = new Array();

    // put away stuff contained in <pre> tags
    text = text.replace(/<pre>(.*?)<\/pre>/g, function (str, $1) {
        var r = "<!-- "+parse_marker+prefmt.length+" -->";
        prefmt.push($1);
        return r;
    });
    
    // <b>
    text = text.replace(/\*([^\*]+)\*/g, parse_marker+"bS#$1"+parse_marker+"bE#");
    // <u>
    text = text.replace(/(^|[^\w])_([^_]+)_/g, "$1"+parse_marker+"uS#$2"+parse_marker+"uE#");
    
    // italics
    text = text.replace(/(^|[^\w])\/([^\/]+)\/($|[^\w\>])/g, function (str, $1, $2, $3) {
        if (str.indexOf("//")!=-1) {
            return str;
        }
        return $1+"<i>"+$2+"</i>"+$3;
    });

 
    text = text.replace
    (
        new RegExp(parse_marker+"([ub])([SE])#", "g"),
        function (str, $1, $2)
        {
            if ($1 == 'u')
            {
                if ($2 == 'S')
                {
                    return '<span style="text-decoration:underline;">';
                }
                return '</span>';
            }
            if ($2 == 'S')
            {
                return '<b>'
            } 
            return '</b>';
        }
    );
    
    // headers
    for(var i=1;i<5;i++) {
        text = header_replace(str_rep("!", i), text);
    }
    
    // <hr>


    function parseTable(str, p1)
    {
        var caption = false;
        var stk = [];
        p1.replace
        (
            /\n\|([+ -])(.*)/g,
            function(str, pp1, pp2)
            {
                if (pp1 == '-')
                {
                    return;
                }
                if (pp1 == '+')
                {
                    caption = caption || pp2;
                    return;
                }
                stk.push('<td>' + pp2.split(' ||').join('</td><td>') + '</td>');
            } 
        );
        return  '<table class="text_area">' +
                    (caption?('<caption>' + caption + '</caption>'):'') +
                    '<tr>' + stk.join('</tr><tr>') + '</tr>' +
                '</table>' 
    }
    reReapTables = /(?:^|\n)\{\|.*((?:\n\|.*)*)(?:\n|$)/g
    text = text.replace(reReapTables, parseTable)

    var targets = {
        Tags: function(link, data, xpage)
        {   
            if (!xpage) return;
            tags.add(link);
            return '';
        },
        'Date': function(a, format, xpage)
        {
            var t = new Date();
            
            return t.toLocaleString();
        },
        VARS: function(a, data, xpage)
        {
            return "** VARS not implemented **";
        },
        'Last Modified': function(a, data, xpage)
        {
            var t = new Date(document.lastModified)
            return t.toLocaleString();
        },
        'Whatever You Want or Need': function(a, data, xpage)
        {
            return '+++ NOT IN YOUR WILDEST DREAMS +++';
        },
        SPECIAL: function(a, data, xpage)
        {
            return false;
        }
    };
    function parseLinks(str, $1){
        var pos, link, data;
        pos = $1.indexOf('|');
        if (pos > -1)
        {
            link = $1.slice(0, pos);
            data = $1.slice(pos + 1, -2);
        }
        else
        {
            link = $1.slice(0, -2);
            data = null;
        }

        if(link.indexOf("://")!=-1)
        {
            return "<a class=\"world\" href=\"" + link + "\" >" + (data || link) + "<\/a>";
        }
        
        pos = link.indexOf('::');
        if (pos > -1)
        {
            target = link.slice(0, pos);
            
            if (target in targets)
            {
                retval = targets[link.slice(0, pos)](link.slice(pos+2), data, xpage);
                if (isString(retval))
                {
                    return retval;
                }
            }
        }
        return "<a class=" + (page_exists(link)?'"link"':'"unlink"') +
            " onclick='go_to_encoded(\"" + escape(link).replace(/%/g, '_') + "\")'>" + (data || link) + "<\/a>";
    }
    
    text = text.replace(reReapLinks, parseLinks);

    function parseList(str, type)
    {
        var uoro = (type=='+')?'ul':'ol';
        var suoro = '<' + uoro + '>';
        var euoro = '</' + uoro + '>';

        var sublist = function (lst, ll)
        {   
            var s = '';
            var item, sub

            while (lst.length && lst[0][1].length == ll )
            {
                item = lst.shift();
                sub = sublist(lst, ll + 1);
                if (sub.length)
                {
                    s += '<li>' + item[2] + suoro + sub + euoro + '</li>' ;
                }
                else
                {
                    s += '<li>' + item[2] + '</li>';
                }
            }
            return s;  
        }

        var old = 0;
        var reItems = /^([+#]+)[ \t]([^\n]+)/mg;

        try 
        {   var stk =[]
	        str.replace
            (
                reItems,
                function(str, p1, p2)
                {
                    level = p1.length;
                    if ((level - old) > 1)
                    {
                        throw 'ListNestingError';
                    }
                    old = level;
                    stk.push([str, p1, p2]);
                }
            );
            return suoro + sublist(stk, 1) + euoro;
        }
        catch (e )
        {
            return '\n*** ListNestingError  ***\n' + str;
        }
    }
    var reReapLists = /(?:^|\n)([+#])[ \t].*(?:\n\1+[ \t][^\n]+)*/g;
    text = text.replace(reReapLists, parseList);  
    
    //<hr />
    text = text.replace(/(?:^|\n)\-\-\-+\n?/g, "<hr />");

    // end-trim
    if (end_trim)
        text = text.replace(/[\n\s]*$/, "");
    
    text = text.replace(/\\\n/g, '').replace(/\n/g, "<br />");
    
    if (prefmt.length>0) {
        text = text.replace(new RegExp("<\!-- "+parse_marker+"(\d+) -->", "g"), function (str, $1) {
            return prefmt[$1];
        });
        prefmt = new Array();
    }
    if (tags && tags.show())
    {
        stk = [];
        tags.iter_tags
        (
            true,
            function (tag)
            {
                stk.push("<a class=\"tag\" href=\"javascript:show_tag('" + tag + "')\">" + tag +"</a>");
            }
        );
        text += "<div class=\"taglinks\">Tags: " + stk.join('&nbsp;&nbsp;') + "</div>";
    }
    xpage && (xpage.tags = tags)
    return text;
}





/////////////////////////////
// exporter.js
// vim:sw=4:ts=4:sts=4:et:nu:
//
// MODULE EXPORTER

// Global variables used:
//
//  unsuported_browser, debug
//  

// Global functions used:
// 
//  isSpecial, isAdvanced, samepage,
//  decode, encode, foreach, set_of_reachables,
//  get_page_style, get_main_page, get_menu_page
//   


// CONSTRUCTOR for Exporter Object
//

function Exporter() {
    
    var reachables, testing = false;
    var base, xmain, xmenu;
    var reLink = /<a class="(?:un)?link" onclick='go_to_encoded\("([^"]*)"\)'>/g;
    var basefilename = file_dir ;

    var basetitle = 'mywiki++ ';

    var hash = true;
    var pre = 'HTML/wiki_';
    var post = '';


    function sanitize_filename(folder, xpre, name)
    {
        if (samepage(name, xmain) || samepage(name, 'special::main page'))
        {
            name = hash?name:'index';
            xpre = '';
        }
        return encode(folder + xpre + name).toLowerCase().replace(' ','_').replace(/%../g,'_').replace( /_+/g, '_') + post;
    }

    function replace_link(str, p1)
    {
        p1 = decode(p1.replace(/_/g, '%'));
        if (!(samepage(p1, xmain) || samepage(p1, 'special::main page'))) 
        {
            if (isSpecial(p1) || isAdvanced(p1) || !reachables.contains(p1))
            {
                return '<a class="unlink" href="">';
            }
        }
        return '<a class="link" href="' + (hash?'#':'') + sanitize_filename('', pre, p1) + '">';
    }

    function saveThisPage(filename, text)
    {
        filename = basefilename + filename ;
        if(confirm("Save to file:\n\n" + filename)) 
        {
            if(navigator.appVersion.indexOf("Win")!=-1)
            {
                filename = filename.replace(/\//g, "\\");
            }
            else
            {
                filename = "/" + filename;
            }


            if(unsupported_browser)
            {
                msg = "Saving on disk is not upported on this browser";
            }
            if(debug)
            {
                msg = "DEBUG MODE is on.";
            }        
            if (unsupported_browser || debug)
            {
                alert (
                msg
                +'\n\nAny changes you have made will NOT be saved'
                +'\n\nInstead, an edit box, containing the text that'
                +'\nwould have been saved, is shown'
                +'\n\nCut & Paste can then be used to copy the text'
                +'\ninto an editor where it can be examined and then saved.'
                +'\n'
                +'\nIn Firefox, filling the textbox is very slow but in'
                +'\nOpera it is very fast.'
                );

                return edit_special(filename, text, true);
            }

            if (!saveFile(filename, text))
            {
                if
                (
                    confirm
                    (
                        'file: \n\n' + filename + '\n\n' + 'Could Not Be Saved\n\n' 
                        + 'Do you want to see what would have been written in a text box?'
                    )
                )
                {
                    return edit_special(filename, text, true);
                }
            }
        }
        return text
    }
    
    this.multiple = function( basename, testing)
    {
        get_links();
        hash = false;
        pre = 'wiki_';
        post = '.html';

        xmain = get_main_page();
        xmenu = get_menu_page();

        reachables = set_of_reachables();
        reachables.remove_specials(true).remove(xmain).remove(xmenu);        

        function gen(xp)
        {
            //alert('gen ' + xp.title)
            saveThisPage
            (
                sanitize_filename('html/',  pre, xp.title),                
                generate_webpage
                (
                    basetitle,
                    xp.title,
                    get_page_style(),
                    '',
                    parse(xmenu).replace(reLink, replace_link),
                    '<div class="fieldset-body">' + parse(xp).replace(reLink, replace_link) + '\n</div>\n'
                )
            );
        };

        gen(xmain);
        reachables.iter_pages ( true, gen);
    };


    this.single = function (basename, testing)
    {
        get_links();

        hash = true;
        pre = '';
        post = '';

        var xmain = get_main_page();
        var xmenu = get_menu_page();

        reachables = set_of_reachables();
        reachables.remove_specials(true).remove(xmain).remove(xmenu);

        function gen(xp)
        {
            return  '\n\n'
            +'<div class="fieldset">\n'
            +'  <a id="' + sanitize_filename('', '', xp.title )+'" ></a>\n'
            +'  <div class="legend">\n'
            +'    <h2 class="legend-text">' + xp.title + '</h2>\n'
            +'  </div>\n'
            +'  <div class="fieldset-body">\n'
            +     parse(xp).replace(reLink, replace_link) + '\n'
            +'  </div>\n'
            +'</div>\n\n';
        }
        
        var output = [ gen(xmain) ];
        
        reachables.iter_pages
        (
            true, 
            function(xpage)
            {
                output.push(gen(xpage))
            }
        );
        saveThisPage
        (
            sanitize_filename('html/',  pre, xmain.title) + '.html',
            generate_webpage
            (
                "mywiki++ ",
                "Test Page",
                get_page_style(),
                '',
                parse(get_menu_page()).replace(reLink, replace_link),
                output.join('\n')
            )
        );

    };

    function generate_webpage(xpre, title, style, script, menu, body)
    {
          var a = [
            'home', 'home', 
          ];
        
          var s;
          var ss = ""
        +'<?xml version="1.0"?>\n'
        +'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"\n'
        +'    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">\n'
        +'<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"\n>'
        +'\n<head>\n'
        +'<title>' + xpre + title + '</title>\n\n'
        +'<style type="text/css">\n' + style + '\n</style>\n\n'
        +'</head>\n\n'
        +'<body>\n\n'
        
        +'<table cellspacing="0"><tbody><tr>\n<td style="width: 100%;" valign="bottom">'
        +'<p class="title" id="title">' + title + '</p></td>\n';
        
          for (var i=0;i<a.length; i+=2){
            s =  '\n<td class="menu">'
            + '\n<div style="display: block; cursor: pointer;" id="menu_' + a[i] +'"><a href="index.html">'
            + '\n<img style="display: block;" id="img_' + a[i] +'" alt="&nbsp;' + a[i] + '&nbsp;" src="images/' + a[i] + '.png" />'
            + '\n<span id="alt_' + a[i] + '" style="display: none; font-family: wingdings; font-size: 24pt;">*</span></a>'
            + '\n</div></td>\n\n';
            ss += s;
          }
        ss += ''
        +'</tr></tbody></table><hr />'
        +'\n'
        +'    <!-- Left Navigation Menu -->\n'
        +'    <table style="display: block;" id="text_area" cellspacing="10"><tbody><tr>\n'
        +'        <td valign="top">\n'
        +'            <div class="menu_area">\n'
        +'                <div class="wiki" id="menu_area">\n' + menu + '\n</div>\n'
        +'            </div>\n'
        +'        </td>\n'
        +'    <!-- End of left Navigation menu -->\n'
        +'\n'
        +'    <!-- Main window -->\n'
        +'        <td style="width: 88%;" rowspan="2" valign="top">\n'
                    + body
        +'        </td>\n'
        +'    <!-- End of main window -->\n'
        +'\n'
        +'    </tr><tr>\n'
        +'        <td>&nbsp;</td>\n'
        +'\n'   
        +'    </tr>\n' 
        +'    </tbody></table>\n'
        +'\n</body></html>\n';
        return ss;
    }

}

//]]>
</script>

<!-- CSS -->
<style>
body {
  background-color: #FFCCFF;
}

/* page title */
p.title {
  font-size: 24pt;
  font-weight: bold;
  margin-bottom: 0pt;
  margin-top: 0pt;
}

/* Text */
/*
.text_area {
  font-family: "Arial";
} */

/* Left menu */
div.menu_area {
  border-width: 1pt;
  border-color: grey;
  border-style: solid;
  font-size: 9pt;
  background-color: white;
  padding: 5pt;
  width: 80pt;
}

.underline {text-decoration:underline; }

/* Main text */
div.text_area {
  border-width: 1pt;
  border-color: grey;
  border-style: solid;
  background-color: white;
  padding: 10pt;
}
	
/* existent link */
a.link {
  color: blue;
}
a.link:hover {
  text-decoration: underline;
  cursor: pointer;
}

/* unexistent link */
a.unlink {
  color: red;
}
a.unlink:hover {
  text-decoration: underline;
  cursor: pointer;
}

/* outside world link */
a.world {
  color: darkgreen;
  text-decoration: underline;
}
a.world:hover {
  cursor: pointer;
}

/* Tables */
table.text_area {
  border-color: black;
  border-spacing: 0px;
  border-style: solid;
  border-width: 1px;
}

table.text_area td
{
  border-width: 1px;
  border-style: solid;
  padding: 5px;
}

/* since v0.9 */
h1 { font-size: 23px; }

h2 { font-size: 20px; }

h3 { font-size: 17px; }

h4 { font-size: 14px; }


div.taglinks {
	border: 1px solid #aaa;
/*	background-color: #f9f9f9; */
	padding: 5px;
	margin-top: 1em;
	clear: both;
}

a.tag {
  color: navy;
}
/* webpage */

.legend {
  border-width: 1pt;
  border-color: grey;
  border-style: solid;
  padding: 0px;
  margin-bottom: 1em;
  
}
.legend-text {
    padding: 0px;
    margin: 0px;
    padding-left: 1em;
    background-color: thistle;
}
div.fieldset {
  padding-bottom: 2em;
}

div.fieldset-body {
  border-width: 1pt;
  border-color: grey;
  border-style: solid;
  background-color: white;
  padding: 10pt;
}

 </style>

</head>

<body id="body">



<!-- WIKI -->
<div id="wiki" style="display:none">

<div id="Special%3A%3AEdit%20Menu">%5B%5BSpecial%3A%3AMain%20Page%7CHome%5D%5D%20%0A%5B%5BSpecial%3A%3AAdvanced%7CAdvanced%5D%5D%0A%5B%5BFormatting%5D%5D%0A%5B%5BDirectives%5D%5D%0A---%0A%5B%5BToday%27s%20Date%5D%5D%0A---%0A%5B%5BSample%20Table%5D%5D%0A%5B%5BSample%20List%7CSample%20List%5D%5D%0A---%0A%5B%5BSpecial%3A%3ABackLinks%7CBack%20Links%5D%5D%0A%5B%5BSpecial%3A%3AShow%20Parsed%20Text%7CShow%20Parsed%20Text%5D%5D%0A---%0A%21%21%21%5B%5BExporter%20Module%7CExport%20To%20Web%20Pages%5D%5D%0A%0A---%0A%5B%5BSpecial%3A%3AAll%20Pages%7CAll%20Pages%5D%5D%0A%5B%5BNew%20Page%5D%5D%0A%0A%5B%5BTags%3A%3ANOTAGS%5D%5D</div>

<div id="Special%3A%3AAdvanced">%21Queries%20%0A%20%20%5B%5BSpecial%3A%3AMain%20Page%7CMain%20Page%5D%5D%3A%20the%20main%20page%20in%20the%20wiki%2C%20whatever%20that%20page%20is%20called.%0A%20%20%5B%5BSpecial%3A%3AAll%20Pages%7CAll%20Pages%5D%5D%3A%20a%20list%20of%20all%20pages%20in%20this%20wiki.%0A%20%20%5B%5BSpecial%3A%3APages%20not%20yet%20created%7CPages%20not%20yet%20created%5D%5D%3A%20a%20list%20of%20pages%20that%20have%20links%20to%20them%2C%20but%20were%20still%20not%20created.%20%0A%20%20%5B%5BSpecial%3A%3AOrphaned%20Pages%7COrphaned%20Pages%5D%5D%3A%20pages%20that%20can%20not%20be%20reached%20via%20%5B%5BSpecial%3A%3AMain%20Page%7CMain%20Page%5D%5D%20or%20%20%5B%5Bspecial%3A%3AEdit%20menu%7CSide%20Menu%5D%5D.%0A%5B%5BSpecial%3A%3AReachable%20Pages%7CReachable%20Pages%5D%5D%20Pages%20that%20are%20not%20orphans.%0A%20%20%5B%5BSpecial%3A%3ABackLinks%7CBackLinks%5D%5D%3A%20a%20list%20of%20pages%20that%20have%20links%20to%20the%20current%20page.%0A%21Visual%20%0A%20%20%5B%5BSpecial%3A%3AEdit%20CSS%7CEdit%20CSS%5D%5D%3A%20edit%20the%20CSS%20that%20controls%20the%20look%20of%20the%20wiki%20to%20be%20edited%20dynamically.%0A%20%20%5B%5Bspecial%3A%3AEdit%20menu%7CEdit%20Menu%5D%5D%3A%20edit%20the%20contents%20of%20the%20side%20menu.%0A%20%20%5B%5BSpecial%3A%3Ashow%20parsed%20text%7CShow%20Parsed%20Text%5D%5D%3A%20veiw%20the%20actual%20%28x%29html%20code%20produced%20by%20the%20wiki%20parser%20for%20the%20current%20page.%0A%21Controls%0A%20%20%5B%5BSpecial%3A%3ABlock%20Edits%7CBlock/Unblock%20edits%5D%5D%3A%20hides%20the%20edit%20button%2C%20to%20be%20used%20when%20this%20wiki%20goes%20public%20%28when%20used%20as%20a%20webpage%2C%20for%20example%29%0A%20%20%5B%5BExporter%20Module%5D%5D%0A%0A%21%21Last%20Modified%3A%20%3Cspan%20id%3D%22lastDate%22%3E%5Berror%5D%3C/span%3E.%0A</div>

<div id="Formatting">%21%21Wiki%20on%20a%20Stick%20Example%0A%21%21Formatting%0A%21%21%21Third%20header%0A%0A%21%21%21%21Fourth%20header%0A%0A/%28click%20on%20the%20pencil%20icon%20on%20the%20top%20right%20corner%20to%20see%20source%29/%0A%0AYou%20can%20also%20double%20click%20anywhere%20on%20the%20text%20to%20edit%2C%20and%20you%20can%20use%20escape%20to%20cancel%20editing%0A%0A%3Cpre%3E%0A%0AThis%20is%20pre-formatted%20text%21%0A%3C/pre%3E%0A%0AThis%20is%20always%20the%20%5B%5BSpecial%3A%3AMain%20Page%7CMain%20page%5D%5D%2C%20and%20this%20is%20a%20%5B%5BNew%20page%5D%5D%0A%0AIf%20you%20have%20an%20older%20StickWiki%2C%20%5B%5BSpecial%3A%3AImport%7Cimport%20it%5D%5D%21%0A%0A%21%21Testcases%0A%0AOn%20my%20right%20there%20is%20some%20_underlined%20text_%2C%20followed%20by%20*bold%20text*%20and%20/italics/.%0A%0ANow%20I%20will%20use%20/*italics%20and%20bold*/%2C%20followed%20by%20*/bold%20and%20italics/*%20and%20finally%20_*/underlined%20bold%20italics/*_.%0A%0AMaybe%20you%20want%20to%20see%20some%20*_/bold%20underlined%20italics/_*%20or%20also%20some%20*/_bold%20italics%20underlined_/*%3F%0A%0AAnd%20here%20is%2C%20just%20for%20you%2C%20a%20partial%20*bold-/italics/*%21%21%21%0A%0A%21%21Syntax%0A%0AExternal%20links%3A%20%5B%5Bhttp%3A//stickwiki.sourceforge.net/%7CWiki%20on%20a%20Stick%5D%5D%0A%0AAs%20you%20can%20see%2C%20/an/unix/path/%20is%20correctly%20recognized.%0A%0ABoldface%3A%20*Boldface%20text*%0AItalics%3A%20/italics%20text/%0AUnderline%3A%20_underlined%20text_%0A%0ARuler%3A%0A---%0A%21%21%21%20%5B%5BSample%20List%5D%5D%20can%20now%20be%20nested%20to%20any%20depth%20AND%20produce%20valid%20xhtml%20output.%0AList%3A%0A+%20Item%20A%0A++%20Subitem%20i%0A++%20Subitem%20ii%0A+%20Item%20B%0A++%20Subitem%20iii%0A+++%20Subsubitem%20iv%0A%0A%0A%5B%5BTags%3A%3ADemo%5D%5D%0A+%20Item%20C%0A%0A%0A%23%20Item%20A%0A%23%23%20Subitem%20i%0A%23%23%20Subitem%20ii%0A%23%20Item%20B%0A%23%23%20Subitem%20iii%0A%23%23%23%20Subsubitem%20iv%0A%23%20Item%20C%0A%0A%21%21Tables%0A%0A%7B%7C%0A%7C+%20Telephone%20Table%0A%7C%20*Column%20Name*%20%7C%7C%20*Type*%20%7C%7C%20*Other*%20%7C%7C%20*Description*%0A%7C-%0A%7C%20id%20%7C%7C%20INT%20%7C%7C%20PRIMARY%20KEY%20%7C%7C%20Row%20ID%0A%7C-%0A%7C%20contact_id%20%7C%7C%20INT%20%7C%7C%20KEY%20%7C%7C%20References%20FOREIGN%20KEY%28Contacts.id%29%0A%7C-%0A%7C%20type%20%7C%7C%20ENUM%28%27Home%27%2C%27Work%27%2C%27Mobile%27%2C%27Pager%27%2C%27Other%27%29%20%7C%7C%20%7C%7C%20Defines%20type%20of%20Telephone%20record%0A%7C-%0A%7C%20number%20%7C%7C%20CHAR%2832%29%20%7C%7C%20%7C%7C%20Contains%20actual%20Telephone%20number%0A%7C%7D</div>

<div id="test%20Page">Insert%20text%20here.</div>

<div id="Today%27s%20Date">%21This%20is%20a%20demo%20to%20illustrate%20the%20use%20of%20directives%0A%0A%21%21%20%5B%20%5BDate%3A%3A%5D%5D%20produces%3A%20%5B%5BDate%3A%3A%5D%5D%0A%0A%0A%0A%5B%5BTags%3A%3ADirective%5D%5D%20%5B%5BTags%3A%3Ademo%5D%5D%0A</div>

<div id="a%20link">This%20is%20a%20page%20to%20demonstrate%20linking%20from%20inside%20a%20table</div>

<div id="Sample%20Table">%7B%7C%0A%7C+%20Table%20Caption%0A%7C%20*colum%201*%20%7C%7C%20*column%202*%20%7C%7C%20*column%203*%0A%7C-%0A%7C%20line%202%20%7C%7C%20%5B%5Ba%20link%5D%5D%20%7C%7C%20something%0A%7C-%0A%7C%20line%203%20%7C%7C%20%5B%5BDate%3A%3A%5D%5D%20%7C%7C%20more%20stuff%0A%7C%7D%0A%0A%7B%7C%0A%7C+%20Table%20Caption%0A%7C%20*colum%201*%20%7C%7C%20*column%202*%20%7C%7C%20*column%203*%0A%7C-%0A%7C%20line%202%20%7C%7C%20%5B%5Ba%20link%5D%5D%20%7C%7C%20something%0A%7C-%0A%7C%20line%203%20%7C%7C%20%5B%5BDate%3A%3A%5D%5D%20%7C%7C%20more%20stuff%0A%7C%7D%0A%5B%5Bspecial%3A%3Ashow%20parsed%20text%7Cshow%20parsed%20text%5D%5D%0A%0A%5B%5BScript%3A%3AparseTable%7Cshow%20code%5D%5D%0A%0AThe%20revised%20table%20parser%20now%20produces%20valid%20XHTML%20code.%0A%0A%5B%5Bspecial%3A%3Ashow%20parsed%20text%7CCheck%20it%5D%5D%20for%20%5C%0Ayourself%20and%20tell%20me%20if%20you%20disagree.%0A%0AThere%20is%20a%20%27bug%27%20in%20that%20two%20tables%20need%20to%20be%20sepearated%20by%20at%20least%20two%20%5Cn%27s%2C%20I%20havn%27t%20%5C%0Abeen%20able%20to%20fix%20that.%20%20For%20the%20time%20being%20I%27m%20prepared%20to%20consider%20it%20%5C%0Aa%20feature%20%3B%20%29%20The%20extra%20linefeed%20is%20eaten%20anyway%2C%20so%20does%20not%20affect%20the%20output.%0A%0AYou%20can%20examine%20the%20%5B%5BScript%3A%3AparseTable%7Crevised%20code%5D%5D%20and%20the%20%5B%5Bspecial%3A%3Ashow%20parsed%20text%7Coutput%5D%5D%20it%20produces.%0A%0APlease%20feel%20free%20to%20test%20it%20to%20destruction%20but%20please%20remember%20to%20email%20to%20the%20group%20any%20markup%20that%20fails%20to%20produce%20valid%20output%2C%20%5C%0A%28And%20certainly%20feel%20free%20to%20post%20any%20fixes%21%29%0A%5B%5BTags%3A%3ASample%5D%5D%0A%7B%7C%0A%7C+%20Table%20Caption%0A%7C%20*colum%201*%20%7C%7C%20*column%202*%20%7C%7C%20*column%203*%0A%7C-%0A%7C%20line%202%20%7C%7C%20%5B%5Ba%20link%5D%5D%20%7C%7C%20something%0A%7C-%0A%7C%20line%203%20%7C%7C%20%5B%5BDate%3A%3A%5D%5D%20%7C%7C%20more%20stuff%0A%7C%7D</div>

<div id="reachable">A%20%5B%5BPage%20Object%5D%5D%20is%20considerd%20to%20be%20*reachable*%20if%20it%20can%20be%20reached%20by%20starting%20at%0Aeither%20the%20%5B%5Bspecial%3A%3Amain%20page%7CMain%20Page%5D%5D%20or%20the%20%5B%5BSpecial%3A%3AEdit%20Menu%7CSide%20Menu%5D%5D%20and%20clicking%0Aon%20only%20normal%20*%28not%20special%29*%20pages%20until%20that%20page%20is%20reached.%0A%0APages%2C%20other%20than%20Special%3A%3A%20pages%2C%20that%20are%20not%20*reachable*%20are%20considered%20to%20be%20%5B%5Borphans%5D%5D.%0A%0AA%20list%20of%20*reachable*%20pages%20can%20be%20seen%20%5B%5BSpecial%3A%3AReachable%20Pages%7Chere%5D%5D.%20And%20can%20be%0Arefered%20to%20using%20the%20wiki%20link%20%5B%5BSpecial%3A%3AReachable%20Pages%5D%5D%0A</div>

<div id="orphans">A%20%20page%20is%20an%20orphan%20if%20it%20is%20neither%20*reachable*%20nor%20Special%3A%3A.%0A%0AA%20list%20of%20orphans%20can%20be%20found%20%5B%5BSpecial%3A%3AOrphaned%20Pages%7Chere%5D%5D.%0Aand%20can%20be%20refered%20to%20by%20the%20wiki%20link%20%5B%5BSpecial%3A%3AOrphaned%20Pages%5D%5D.</div>

<div id="Exporter%20Module">%21Exporter%20Module%0AThis%20module%20will%20allow%20all%20*%5B%5Breachable%5D%5D*%20pages%20of%20the%20Wiki%20to%20be%20exported%20as%20%5C%0Asingle%20XHTML%20page%20or%20as%20multilple%20XHTML%20pages%20%5C%0Aall%20properly%20linked%20together%20to%20form%20a%20mini%20web%20site.%20The%20resulting%2C%20xhtml%20%5C%0Ashoul%20validate%20providing%20you%20do%20not%20introduce%20any%20invalid%20xhtml%20in%20your%20own%20pages.%5C%0AIf%20you%20have%20a%20page%20that%20does%20not%20validate%20please%20send%20it%20to%20me%2C%20%5B%5Bplumloco%5D%5D%0A%0A%0ANo%20javascript%20will%20be%20included%20on%20the%20page%20and%20%5C%0ACSS%20style%20sheets%20are%20embedded%20in%20the%20file%2C%20although%20eventually%20I%20will%20offer%20%5C%0Athe%20option%20to%20use%20external%20style%20sheets%20and%20some%20javascrip%20features%20if%20desired.%20%0A%0AAt%20the%20moment%20there%20is%20no%20user%20interface%20but%20the%20demo%20is%20good%20%5C%0Afor%20evaluating%20the%20usefulness%20of%20such%20a%20feature.%20A%20comprehsive%20%5C%0Awiki%20based%20interface%20will%20be%20provided%20when%20I%20have%20the%20%5B%5BForms%5D%5D%20%5C%0AModule%20implemented.%20%20%0A%0AThe%20web%20pages%20will%20be%20stored%20in%20a%20folder%20called%20%27html%27%20in%20the%20same%20folder%20%5C%0Aas%20the%20script.%20%20A%20confirmation%20box%20will%20tell%20you%20where%20the%20file%20is%20going%20%5C%0Ato%20be%20stored%20and%20what%20it%20is%20called.%20%20Choose%20%27cancel%27%20to%20stop%20the%20file%20%5C%0Abeing%20written.%0A%0ATry%20it%20now%3A%20%0A%0A+%20%5B%5BSpecial%3A%3AExport%20Single%20Webpage%7CExport%20As%20A%20Single%20Web%20Page%5D%5D%0A+%20%5B%5BSpecial%3A%3AExport%20Multiple%20Webpages%7CExport%20As%20A%20Multiple%20Web%20Pages%5D%5D%0A</div>

<div id="Automatic%20changing%20of%20links%20on%20renaming.">When%20a%20page%20is%20renamed%2C%20all%20the%20links%20refering%20to%20that%20page%20are%20automatically%0Aand%20immediatly%20changed%20to%20reflect%20the%20new%20name.%0A%0A</div>

<div id="Back%20Links%20Page">%5B%5BSpecial%3A%3ABacklinks%5D%5D%20shows%20a%20list%20of%20pages%20that%20%20have%20links%20to%20the%20current%20page.%0A%0AThis%20list%20is%20very%20useful%20when%20you%20change%20the%20name%20of%20a%20page%2C%20because%0Aalthought%20the%20link%20itself%20is%20changed%20automatically%2C%20the%20text%20is%20not%0Anor%20can%20it%20be.%0A%0AObviously%20this%20is%20most%20useful%20when%20used%20in%20the%20%5B%5BSpecial%3A%3AEdit%20menu%7CSide%20Menu%5D%5D</div>

<div id="Show%20Parsed%20Text">The%20%5B%5BSpecial%3A%3AShow%20Parsed%20Text%5D%5D%20link%20can%20be%20used%20to%0Ashow%20the%20output%20produced%20by%20the%20wiki%20parser%20for%20the%0Acurrent%20page.%0A%0AThis%20is%20mostly%20only%20useful%20for%20debugging%20purpose%20of%20course.</div>

<div id="Persistent%20Page%20Variables">@name%3A%3Avalue%0A@color%3A%3Ablue%0A@last%20modified%3A%3A15%20august%201756%0A%0APage%20variables%20are%20lines%20like%20those%20at%20the%20top%20of%20this%20page%20which%20*will%20not%20be%20seen*%20by%20the%20%5C%0Apage%20author%2C%20%28unless%20he%20wants%20to%20see%20them%20but%20will%20be%20loaded%2C%20saved%20and%20imported%20with%20the%20page.%0A%0A*_/This%20effectivly%20gives%20per%20page%20persistant%20data./_*%0A%0ABackwards%20compatability%20will%20not%20be%20a%20problem%20because%20older%20pages%20will%20not%20have%20@%20as%20the%20first%20charachter%0Aand%20so%20can%20be%20easily%20recognised%2C%20new%20pages%20with%20page%20variables%20will%20have%20an%20@version%20line%20as%20the%20very%20first%0Aline%2C%20so%20future%20imports%20will%20be%20made%20very%20easy.%0A%0APage%20variables%20will%20be%20accessed%20by%20the%20%5B%20%5BGetVar%3A%3A%5D%20%5D%20and%20%5B%20%5BSetVar%3A%3A%5D%20%5D%20%5B%5BDirectives%5D%5D.%20e.g%0A+%20e.g.%20%20*%5B%20%5BSetVar%3A%3APage%20variables%3A%3Alast%20modified%20%7C%2023%20May%202006%5D%20%5D*%0A+%20e.g.%20*%5B%20%5BGetVar%3A%3APage%20variables%3A%3Alast%20modified%5D%20%5D*%0A%5B%5BForms%5D%5D%20element%20will%20have%20a%20variable%20asscociated%20with%20them%20and%20will%20use%20the%20same%20mechanism%20to%20%5C%0Aaccess%20their%20values%20and%20these%20values%20will%20be%20made%20persistant%20throught%20the%20page%20variables%20mechanism.%0A%0AThe%20variables%20on%20one%20page%20will%20be%20able%20to%20be%20read%20and%20set%20from%20any%20other%20page.%0A%0AThe%20page%20variables%20will%20be%20accessed%20from%20javascript%20%5B%20%5BScript%3A%3A%5D%5D%20pages%20by%20e.g%0A+%20*value%20%3D%20xpage.getvar%28%27My%20Best%20Page%3A%3AAuthor%27%29*%20%0A+%20*xpage.setvar%28%27My%20Best%20Page%3A%3AAuthor%27%2C%20%27plumloco%27%29*%0Awhere%20*xpage*%20is%20a%20%5B%5BPage%20Object%5D%5D%20object.%0A%0A%20</div>

<div id="Forms">%21Forms%20Module%0AThe%20forms%20module%20will%20allow%20the%20inclusion%20of%20html%20form%20elements%20in%20a%20wiki%20sort%20of%20way.%0A%0ASuppose%20you%20have%20a%20page%20called%20%27Personal%20Information%27.%20%5C%0AYou%20will%20be%20able%20to%20put%3A%20%0A+%20%5B%20%5BInput%3A%3AFirst%20Name%5D%5D%0Aand%20an%20input%20box%20will%20appear.%20Then%20from%20any%20where%20else%20in%20the%20wiki%20where%20you%20want%20the%20%5C%0Acontents%20of%20that%20input%20box%20use%0A+%20*%5B%20%5BGetVar%3A%3APersonal%20Information%3A%3AFirst%20Name%5D%5D*%20%5C%0Aand%20it%20will%20be%20replaced%20with%20the%20contents%20of%20the%20input%20box%2C%20conversely%2C%20to%20set%20%5C%0Athe%20contents%20of%20the%20input%20box%2C%20use%0A+%20*%5B%20%5BSetVar%3A%3APersonal%20Information%3A%3AFirst%20Name%20%7C%20some%20other%20name%5D%5D*%20%5C%0Aand%20voila%20any%20page%20that%20uses%20the%20contents%20of%20this%20inbox%20will%20be%20automatically%20updated.%0A%0AAny%20number%20of%20input%2C%20textarea%2C%20checkboxes%2C%20radiobuttons%20and%20option%20menus%20will%20be%20able%20%5C%0Ato%20be%20used%2C%20and%20their%20values%20will%20be%20%5BPersistent%20User%20Variables%7Cpersistent%5D%2C%20ie%20they%20will%20hold%20their%20value%20even%20after%20%5C%0Athe%20browser%20is%20closed.%20%0A%0AI%20hope%20to%20build%20a%20user%20interface%20for%20my%20%5B%5BExporter%20Module%5D%5D%20using%20these%20features.%0A</div>

<div id="Inline%20includes">In%20line%20includes%20will%20allow%20you%20to%20include%20the%20contents%20of%20one%20or%20more%20wiki%20pages%0Aor%20%5B%5BPersistant%20Page%20Variables%7Cpage%20variable%5D%5D%20in%20another.%0A%0ASee%20also%3A%20%5B%5BForms%5D%5D.</div>

<div id="XHTML%20compatability">%21xhtml%20compatability%0A%0AProblems%20with%20the%20v0.9%20parsers%20output%20have%20been%20fixed%20so%20that%20it%20should%20now%20produce%20valid%20%5C%0Axhtml%20code%2C%20providing%20you%20do%20not%20introduce%20any%20incompatible%20elements%20in%20your%20content.%0A%0AThe%20two%20main%20culprits%20were%20the%20%5B%5BSample%20Table%7Ctable%5D%5D%20and%20%5B%5BSample%20List%7Clist%5D%5D%20parsers.%20Hopefully%20they%20%5C%0Aare%20now%20fixed.%20Please%20feel%20free%20to%20visit%20the%20%5B%5Btags%3A%3Asample%7Csamples%5D%5D%20and%20test%20them%20to%20destruction%2C%20but%20%5C%0Aplease%20also%20mail%20the%20group%20with%20an%20example%20of%20any%20wiki%20markup%20that%20does%20not%20parse%20correctly.</div>

<div id="Multiple%20CSS">%21Style%20Pages%0A%0AI%20intend%20to%20create%20a%20Style%3A%3A%20class%20of%20page%20so%20that%0Amultiple%20CSS%20pages%20can%20exist%20in%20a%20wiki%20and%20be%20chosen%20either%0Afor%20the%20wiki%20or%20for%20exported%20web%20pages.%0A%0AStyle%20pages%20will%20be%20parsed%20differently%20and%20will%20have%20the%20ability%20to%20include%0Aother%20style%20pages%20inline%20allowing%20the%20development%20of%20%27themes%27%20is%20so%20desired%0A%0A</div>

<div id="Programmers%20Interface">I%20am%20working%20on%20defining%20a%20consistent%20reliable%20programmers%20interface%20to%20the%20core%20%5C%0Afunctionality%20of%20the%20wiki%20so%20that%20it%20can%20be%20extended%20easily%20by%20the%20developers%20or%20%5C%0Athird%20party%27s.%0A%0AI%20am%20hoping%20to%20provide%20enough%20core%20functionality%20to%20allow%20future%20improvement%20and%20extensions%20%5C%0Ato%20made%20via%20wiki%20pages.%0A%0AI%20am%20introducing%20the%20concept%20of%20%5B%5BBooks%5D%5D%2C%20which%20are%20a%20collection%20of%20wiki%20pages%20that%0Arelate%20to%20each%20other.%0A</div>

<div id="New%20Features%20Demo">%21%5B%5BPlumloco%7Cplumloco%27s%5D%5D%20Proposed%20new%20features%20for%20StickWiki%0AHi%2C%20I%27m%20developing%20a%20version%20of%20stickwiki%20to%20use%20as%20a%20book%20markup%20tool%2C%20so%20that%20enthusiasts%20can%20mark%20up%20their%20favourite%20etext%20and%20refer%20to%20and%20index%20notes%20on%20characters%20themes%20and%20plots%20etc.%0A%0AThey%20will%20then%2C%20at%20the%20click%20of%20a%20button%2C%20be%20able%20to%20export%20the%20marked%20up%20text%20and%20notes%2C%20as%20a%20complete%2C%20self%20contained%20and%20easily%20%20maintained%20website.%20%0A%0AI%20present%20my%20ideas%20and%20code%20here%20in%20the%20spirit%20of%20open%20source%20software%2C%20returning%20any%20new%20ideas%20or%20code%20to%20the%20community%2C%20so%20that%20others%20may%20take%20advantage%20of%20any%20developments%20I%20may%20%20%28or%20many%20not%29%20make.%0A%0ARemember%20this%20is%20very%20much%20in%20the%20alpha%20stage%2C%20do%20not%20rely%20on%20it%20for%20anything%20important.%0A%0A%5B%5BScript%3A%3AparseTable%7Ccode%20for%20parsing%20tables%5D%5D%0A%5B%5BScript%3A%3AparseList%7Ccode%20for%20parsing%20lists%5D%5D%0A%0A%21%21%21Demo%20of%20New%20Features%20includes%3A%0A+%20%5B%5BExporter%20Module%5D%5D%20exports%20the%20wiki%20to%20a%20single%20or%20to%20multiple%20xhtml%20pages.%0A+%20%5B%5BAutomatic%20changing%20of%20links%20on%20renaming.%5D%5D%0A+%20%5B%5BBack%20Links%20Page%5D%5D%0A+%20%5B%5BShow%20Parsed%20Text%5D%5D%0A+%20%5B%5BMain%20Page%20Link%5D%5D%0A+%20%5B%5BShow%20Output%20on%20Save%5D%5D%20for%20debug%20mode%20and%20unsupported%20browser%20*DOUBLE%20COOL%20FEATURE*%0A+%20%5B%5BAll%20output%20is%20generated%20by%20the%20javascript%5D%5D%0A+%20%5B%5BDirectives%5D%5D%20only%20partially%20implemented%0A+%20%5B%5BSample%20List%7CRevised%20list%20parsing%20to%20produce%20valid%20xhtml%5D%5D%0A+%20%5B%5BSample%20Table%7CRevised%20table%20parsing%20to%20produce%20valid%20xhtml%5D%5D%0A%21%21%21Features%20I%27m%20working%20on%3A%0A+%20%5B%5BBooks%5D%5D%0A+%20%5B%5BInline%20includes%5D%5D%0A+%20%5B%5BXHTML%20compatability%5D%5D%0A+%20%5B%5BPersistent%20Page%20Variables%5D%5D%0A+%20%5B%5BForms%7CForms%20Module%5D%5D%0A+%20%5B%5BMultiple%20CSS%7CStyles%20Pages%5D%5D%0A+%20%5B%5BScript%20pages%5D%5D%0A+%20%5B%5BProgrammers%20Interface%5D%5D%0A+%20%5B%5BSearch%20Module%2C%20Tagging%20Engine%20Etc%5D%5D%0A%0A%5B%5BTags%3A%3AChapter%5D%5D</div>

<div id="Main%20Page%20Link">A%20new%20%5B%5BSpecial%3A%3AMain%20Page%5D%5D%20link%20which%20ALWAYS%20links%20to%0Athe%20Main%20Page%2C%20whatever%20that%20page%20may%20be%20called.</div>

<div id="Show%20Output%20on%20Save">%21%20This%20is%20a%20DOUBLE%20COOL%20feature.%0A%0AIn%20debug%20and%20unsupported%20browser%20modes%2C%20the%20text%20that%20would%20have%20been%20saved%20%5C%0Ais%20shown%20in%20a%20text%20box.%0A%0AThis%20means%20that%20you%20can%20use%20cut%20and%20paste%20to%20copy%20the%20text%20into%20an%20%5C%0Aeditor%20an%20save%20it%20from%20there.%0A%0AThis%20is%20an%20excellent%20debug%20feature%20and%20a%20safety%20feature%20for%20development.%0A%0AIt%20is%20also%20valuable%20for%20saving%20read%20only%20wikis%20from%20the%20web.%0A%0AOn%20Firefox%20there%20will%20be%20a%20delay%20as%20the%20text%20box%20takes%20a%20long%20time%20to%20fill%20but%20%5C%0Aon%20Opera%20this%20is%20almost%20instantaneous.%0A%0AJavascript%20is%20very%20fast%20on%20Opera%20and%20IE%20compared%20to%20Firefox.</div>

<div id="All%20output%20is%20generated%20by%20the%20javascript">All%20output%20is%20generated%20by%20the%20javascript%20so%20%5C%0Abrowser%20mangling%20problems%20disappear.%0A%0AI%20had%20a%20particular%20problem%20with%20Firefox%20Web%20Developer%2C%20not%20now%20though.</div>

<div id="Directives">%21This%20is%20a%20demo%20to%20illustrate%20the%20use%20of%20directives%0A%0A%5B%20%5BDate%3A%3A%5D%5D%20produces%3A%20%5B%5BDate%3A%3A%5D%5D%0A%5B%20%5BLast%20Modified%3A%3A%5D%5D%20produces%20%5B%5BLast%20Modified%3A%3A%20%5D%5D%0A%5B%20%5BWhatever%20You%20Want%20or%20Need%3A%3A%5D%5D%20produces%20%5B%5BWhatever%20You%20Want%20or%20Need%3A%3A%5D%5D%0A%0A%5B%5BTags%3A%3ADirective%5D%5D</div>

<div id="Page%20Object">%21Page%20Objects%0AThese%20are%20javascript%20objects%20which%20represents%20a%20wiki%20page%20in%20the%20core%20wiki%20%5C%0Acode%20and%20in%20%5B%5BScript%20Pages%5D%5D.%20%20Everything%20about%20a%20page%20can%20%28and%20should%20only%20be%29%20accessed%20%5C%0Athrough%20this%20object.%0A%0A*/A%20full%20description%20of%20the%20%5B%5BPage%20Object%5D%5D%20and%20its%20user%20interface%20will%20be%20included%20soon./*</div>

<div id="Script%20Pages">%21Script%20Pages%0AScript%3A%3A%20pages%20will%20contain%20javascript%20programs%20that%20can%20be%20run%20in%20various%20contexts.%20eg%0A+%20to%20provide%20dynamically%20generated%20%5B%5BInline%20includes%5D%5D%0A+%20to%20provide%20scripted%20acctions%20to%20%5B%5BForms%5D%5D%20elements%20such%20as%20%5B%5BButtons%5D%5D%0A%0AI%20have%20not%20fully%20defined%20the%20user%20interface%20for%20this%20yet%2C%20but%20will%20do%20s%20Real%20Soon%20Now.%0A</div>

<div id="Buttons">%21Buttons%0AButtons%20appear%20as%20normal%20html%20buttons%20and%20are%20part%20of%20the%20%5B%5BForms%5D%5D%20module.%20They%20can%20be%20used%20to%20execute%20javascript%20in%20%5BScript%20Pages%5D%5D%20%5C%0Aor%20to%20load%20pages%20as%20though%20it%20were%20a%20link%20or%20whatever.%0A%0Athey%20will%20be%20placed%20on%20the%20page%20eg%0A%0A+%20%5B%20%5BButton%3A%3ADo%20Whatever%7Conclick%28My%20Clever%20Thing%29%5D%20%5D%0A+%20%5B%20%5BButton%3A%3AExport%20Single%7Conclick%28Exporter%3A%3AExport%20Single%20XHTML%5D%20%5D</div>

<div id="Books">%21Books%0AA%20%27book%27%20is%20a%20collection%20of%20pages%20that%20relate%20to%20each%20other%2C%20several%20books%20%5C%0Acan%20exist%20within%20a%20wiki%20and%20a%20book%20can%20be%20imported%20as%20a%20whole%20unit%20from%20another%20wiki.%0A%0AI%20am%20hoping%20to%20implement%20modules%20as%20books%20which%20can%20be%20imported%20as%20a%20whole%20%5C%0Aor%20used%20to%20refer%20to%20external%20modules.%0A%0AFor%20example%20my%20%5B%5BExporter%20Module%5D%5D%20will%20eventually%20be%20implemented%20as%20a%20book%2C%20you%20will%20%5C%0Abe%20able%20to%20import%20the%20module%20when%20or%20if%20you%20need%20it%20or%20you%20will%20be%20able%20to%20keep%20it%20%5C%0Aas%20a%20seperate%20file%20%28including%20all%20its%20code%20and%20documentation%20as%20wiki%20pages%29%20and%20%20%5C%0Adefine%20a%20book%20as%20refering%20to%20that%20file.%0A%0ASomewhere%20in%20your%20wiki%20there%20will%20be%20a%20page%20where%20you%20can%20put%20something%20like%20%0A+%20%5B%20%5BImport%20Book%3A%3AExporter%20%7C%20modules/exporter.html%5D%20%5D%0Ayou%20will%20then%20be%20able%20to%20refer%20to%20any%20page%20in%20the%20exporter%20module%20as%20eg.%0A+%20%5B%20%5BExporter%3A%3AExport%20Single%20XHTML%5D%5D%0A%0A</div>

<div id="Plumloco">%21Plumloco%0A%0AThis%20is%20my%20version%20of%20stickwiki%20which%20I%20built%20by%20gradually%20modifying%20%0AAndre%27s%20original%20code%20attempting%20to%20use%20an%20object%20orientated%20approach.%0AI%27m%20pleased%20with%20the%20results%20so%20far.%0A%0AI%20intend%20using%20this%20version%20of%20stickwiki%20as%20a%20book%20markup%20tool%20that%20will%0Aallow%20enthusiasts%20to%20easily%20work%20on%20an%20ebook%20and%20add%20mark%20up%20to%20link%20from%20%0Athe%20text%20to%20notes%20on%20characters%20and%20themes%20etc.%0A%0AThe%20marked%20up%20etext%20and%20notes%20will%20then%20be%20converted%20to%20an%20html%20website%20which%0Acan%20be%20created%20and%20maintained%20very%20easily%20even%20by%20naive%20users.%0A%0AI%20present%20my%20source%20and%20ideas%20here%20in%20the%20spirit%20of%20open%20source%20software%2C%20if%20you%0Afind%20anything%20of%20mine%20that%20is%20useful%20to%20you%20go%20ahead%20and%20use%20it%2C%20I%20neither%20require%0Anor%20want%20any%20attribution%20other%20than%20that%20covered%20by%20the%20phrase%20%27contributions%20from%20%0Amembers%20of%20the%20stickwiki%20group.%27%0A%0AI%20would%20like%20to%20work%20on%20the%20official%20version%20but%20I%20do%20not%20have%20the%20skills%20or%20internet%0Aaccess%20facilities%20to%20use%20svn.%20In%20addition%20my%20program%20is%20object%20oriented%20and%20easy%20to%20extend%0Ait%20would%20be%20crazy%20for%20me%20to%20abandon%20months%20of%20effort%20in%20favour%20of%20the%20official%20version.%0A%0Aemail%3A%3A%20%5B%5Bmailto%3A//plumloco@hcoop.net%7Cplumloco@hcoop.net%5D%5D%0A%0Aplumloco%20is%20a%20proud%20member%20of%20%5B%5Bhttp%3A//hcoop.net%7Chcoop%5D%5D%20the%20%5B%5Bhttp%3A//hcoop.net%7Cinternet%20hosting%20cooperative%5D%5D.</div>

<div id="Search%20Module%2C%20Tagging%20Engine%20Etc">%21Search%20Modules%2C%20Tagging%20Engines%20etc%0AAll%20modules%20such%20as%20search%20modules%20and%20tagging%20engines%20will%20be%20implemented%20%5C%0Aentirely%20as%20wiki%20pages%20using%20the%20%5B%5BBooks%5D%5D%20feature%20and%20appropriate%20%5C%0A%5B%5BForms%5D%5D%2C%20%5B%5BScript%20Pages%5D%5D%20and%20%5B%5BPersistent%20Page%20Variables%5D%5D%20pages.%0A%0ASuch%20modules%20should%20include%20their%20documentation%20as%20wiki%20pages%2C%20their%20code%20%5C%0Aas%20%5B%5BScript%20Pages%5D%5D%20and%20also%20have%20a%20default%20%5B%5BForms%7Cform%5D%5D%20for%20the%20user%20to%20%5C%0Acontrol%20it.%0A%0AThe%20module%20should%20also%20allow%20all%20of%20its%20facillities%20to%20be%20accessed%20via%20%5B%5BPersistent%20Page%20Variables%7Cpage%20variables%5D%5D%20%5C%0Aand%20%5B%5BScript%20Pages%5D%5D%20so%20that%20they%20can%20design%20their%20own%20interface%20%5B%5BForms%7Cforms%5D%5D%20if%20they%20%5C%0Aso%20desire%2C%20and%20so%20that%20third%20party%20developers%20can%20use%20and%20extend%20your%20module.</div>

<div id="Sample%20List">Ok%2C%20now%20it%20*/_REALLY_/*%20does%20work%20this%20time%20for%20SURE%2C%20HONEST.%0A%0AAs%20a%20bonus%20it%20also%20allows%20nesting%20to%20any%20depth.%0A%0A%23%201%0A%23%23%20%202%0A%23%23%23%203%20%0A%23%23%23%23%204%0A%23%23%23%23%23%205%0A%23%23%23%23%23%23%206%0A%23%23%23%23%23%23%23%207%0A%23%23%23%23%23%23%23%23%208%0A%23%23%23%23%23%23%23%23%23%209%0A%23%20done%0A+%20Item%20A%0A++%20Subitem%20i%0A++%20Subitem%20ii%0A+%20Item%20B%0A++%20Subitem%20iii%0A+++%20Subsubitem%20iv%0A+%20Item%20C%0A%0AThe%20revised%20list%20parser%20now%20produces%20valid%20XHTML%20code.%20%5B%5Bspecial%3A%3Ashow%20parsed%20text%7CCheck%20it%5D%5D%20for%20%5C%0Ayourself%20and%20tell%20me%20if%20you%20disagree.%0A%0AYou%20can%20examine%20the%20%5B%5BScript%3A%3AparseList%7Crevised%20code%5D%5D%20and%20the%20%5B%5Bspecial%3A%3Ashow%20parsed%20text%7Coutput%5D%5D%20it%20produces.%0A%0APlease%20feel%20free%20to%20test%20it%20to%20destruction%20but%20please%20remember%20to%20email%20to%20the%20group%20any%20markup%20that%20fails%20to%20produce%20valid%20output%2C%20%5C%0A%28And%20certainly%20feel%20free%20to%20post%20any%20fixes%21%29%0A%0APS%20Item%20C%20is%20missing%20delibrately%20in%20the%20table%20below.%0A%5B%5BTags%3A%3ASample%5D%5D%0A+%20Item%20A%0A++%20Subitem%20i%0A++%20Subitem%20ii%0A+%20Item%20B%0A++%20Subitem%20iii%0A+++%20Subsubitem%20iv</div>

<div id="Script%3A%3AparseTable">%20%0A%20%20%20%20//%0A%20%20%20%20//%20%20Code%20for%20parsing%20stickwiki%20tables%20into%20valid%20xhtml%20code.%0A%20%20%20%20//%20%0A%0A%20%20%20%20function%20parseTable%28str%2C%20p1%29%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20var%20caption%20%3D%20false%3B%0A%20%20%20%20%20%20%20%20var%20stk%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20%20%20p1.replace%0A%20%20%20%20%20%20%20%20%28%0A%20%20%20%20%20%20%20%20%20%20%20%20/%5Cn%5C%7C%28%5B+%20-%5D%29%28.*%29/g%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20function%28str%2C%20pp1%2C%20pp2%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28pp1%20%3D%3D%20%27-%27%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28pp1%20%3D%3D%20%27+%27%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20caption%20%3D%20caption%20%7C%7C%20pp2%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20stk.push%28%27%3Ctd%3E%27%20+%20pp2.split%28%27%20%7C%7C%27%29.join%28%27%3C/td%3E%3Ctd%3E%27%29%20+%20%27%3C/td%3E%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%0A%20%20%20%20%20%20%20%20%29%3B%0A%20%20%20%20%20%20%20%20return%20%20%27%3Ctable%20class%3D%22text_area%22%3E%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%28caption%3F%28%27%3Ccaption%3E%27%20+%20caption%20+%20%27%3C/caption%3E%27%29%3A%27%27%29%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%3Ctr%3E%27%20+%20stk.join%28%27%3C/tr%3E%3Ctr%3E%27%29%20+%20%27%3C/tr%3E%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%3C/table%3E%27%20%0A%20%20%20%20%7D%0A%20%20%20%20reReapTables%20%3D%20/%28%3F%3A%5E%7C%5Cn%29%5C%7B%5C%7C.*%28%28%3F%3A%5Cn%5C%7C.*%29*%29%28%3F%3A%5Cn%7C%24%29/g%0A%20%20%20%20text%20%3D%20text.replace%28reReapTables%2C%20parseTable%29%0A</div>

<div id="Script%3A%3AparseList">%20%0A%20%20%20%20//%0A%20%20%20%20//%20%20Code%20for%20parsing%20stickwiki%20lists%20into%20valid%20xhtml%0A%20%20%20%20//%0A%0A%20%20%20%20function%20parseList%28str%2C%20type%29%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20var%20uoro%20%3D%20%28type%3D%3D%27+%27%29%3F%27ul%27%3A%27ol%27%3B%0A%20%20%20%20%20%20%20%20var%20suoro%20%3D%20%27%3C%27%20+%20uoro%20+%20%27%3E%27%3B%0A%20%20%20%20%20%20%20%20var%20euoro%20%3D%20%27%3C/%27%20+%20uoro%20+%20%27%3E%27%3B%0A%0A%20%20%20%20%20%20%20%20var%20sublist%20%3D%20function%20%28lst%2C%20ll%29%0A%20%20%20%20%20%20%20%20%7B%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20s%20%3D%20%27%27%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20item%2C%20sub%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20while%20%28lst.length%20%26%26%20lst%5B0%5D%5B1%5D.length%20%3D%3D%20ll%20%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20item%20%3D%20lst.shift%28%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20sub%20%3D%20sublist%28lst%2C%20ll%20+%201%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28sub.length%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20s%20+%3D%20%27%3Cli%3E%27%20+%20item%5B2%5D%20+%20suoro%20+%20sub%20+%20euoro%20+%20%27%3C/li%3E%27%20%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20s%20+%3D%20%27%3Cli%3E%27%20+%20item%5B2%5D%20+%20%27%3C/li%3E%27%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20s%3B%20%20%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20var%20old%20%3D%200%3B%0A%20%20%20%20%20%20%20%20var%20reItems%20%3D%20/%5E%28%5B+%23%5D+%29%5B%20%5Ct%5D%28%5B%5E%5Cn%5D+%29/mg%3B%0A%0A%20%20%20%20%20%20%20%20try%20%0A%20%20%20%20%20%20%20%20%7B%20%20%20var%20stk%20%3D%5B%5D%0A%09%20%20%20%20%20%20%20%20str.replace%0A%20%20%20%20%20%20%20%20%20%20%20%20%28%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20reItems%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20function%28str%2C%20p1%2C%20p2%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20level%20%3D%20p1.length%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28%28level%20-%20old%29%20%3E%201%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20%27ListNestingError%27%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20old%20%3D%20level%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20stk.push%28%5Bstr%2C%20p1%2C%20p2%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20suoro%20+%20sublist%28stk%2C%201%29%20+%20euoro%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20catch%20%28e%20%29%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20%27%5Cn***%20ListNestingError%20%20***%5Cn%27%20+%20str%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20var%20reReapLists%20%3D%20/%28%3F%3A%5E%7C%5Cn%29%28%5B+%23%5D%29%5B%20%5Ct%5D.*%28%3F%3A%5Cn%5C1+%5B%20%5Ct%5D%5B%5E%5Cn%5D+%29*/g%3B%0A%20%20%20%20text%20%3D%20text.replace%28reReapLists%2C%20parseList%29%3B%20%20%0A</div>

<div id="tags%3A%3ADIRECTIVE">%5B%5BToday%27s%20Date%5D%5D%20%281%29%0A%5B%5BDirectives%5D%5D%20%281%29%0A</div>

<div id="tags%3A%3ASAMPLE">%5B%5BSample%20Table%5D%5D%20%281%29%0A%5B%5BSample%20List%5D%5D%20%281%29%0A</div>

<div id="tags%3A%3ADEMO">%5B%5BFormatting%5D%5D%20%281%29%0A%5B%5BToday%27s%20Date%5D%5D%20%281%29%0A</div>

</div>

<!-- VARIABLES -->
<div id="variables" style="display:none">

<div id="main_page_">new%20features%20demo</div>

<div id="version_">0.04</div>

<div id="permit_edits_">1</div>

<div id="last_modified_">notset</div>

</div>

</body></html>
