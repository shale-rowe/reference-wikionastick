<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<script type="text/javascript">
/* <![CDATA[ */

/* UUZJizdTQtSsJsMSZA-START */

var version = "0.9B";

var __marker = "UUZJizdTQtSsJsMSZA";

var permit_edits = true;

var dblclick_edit = false;

var save_on_quit = false;

var allow_diff = true;

var key_cache = true;

var current = "Main Page";

var main_page = "Main Page";

var backstack = [
"Special::Advanced",
"Special::Edit CSS",
"Special::Advanced",
"Special::Backlinks",
"Special::Advanced"
];

var page_titles = [
"Special::Menu",
"Special::Advanced",
"Special::Import",
"Special::About",
"Main Page",
"Special::Search",
"MyPages::Page 2",
"MyPages::Approved::Page 3",
"Hello there!",
"Special::Lock",
"Special::Security",
"MyPages::Page 1",
"Thanks"
];

/* UUZJizdTQtSsJsMSZA-DATA */
var page_attrs = [0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0];

var pages = [
"[[Main Page]]\n\
\n\
[[Special::Advanced]]\n\
[[Special::Backlinks]]\n\
[[Special::Search]]",
"!Info\n\
  [[Special::About|About Wiki on a Stick]]\n\
  This wiki was last modified in <span id=\"lastDate\"></span>.\n\
\n\
!Pages\n\
  [[Special::All Pages|All Pages]]: a list of all user created pages in this wiki\n\
  [[Locked::|All encryted pages]]: a list of all encrypted pages\n\
  [[Unlocked::|All plain pages]]: a list of all plain pages\n\
  [[Special::|All static Special Pages]]: list of all system pages\n\
  [[Special::Pages not yet created|Pages not yet created]]: a list of pages that have links to them, but were still not created \n\
  [[Special::Orphaned Pages|Orphaned Pages]]: a list of pages that once were linked to, but now no page links to them anymore\n\
  [[Special::Search|Search]]: search all wiki pages\n\
\n\
!Maintenance\n\
  [[Special::Import|Import wiki]] from an early (or current) version.\n\
  [[Special::Erase Wiki|Erase Wiki]]: delete ALL wiki pages and reset with default data\n\
\n\
!Special edits\n\
  [[Special::Edit CSS|Edit CSS]]: edit the global CSS styles\n\
  [[Special::Edit Menu|Edit Menu]]: edit main menu (on the left)\n\
\n\
!Options\n\
  <label for=\"cb_allow_diff\"><input type=\"checkbox\" id=\"cb_allow_diff\" onclick=\"allow_diff = el_eval('cb_allow_diff')\" />Diff mode (consistent newlines splitting in saved data, useful for versioning)<br />\n\
  <label for=\"cb_permit_edits\"><input type=\"checkbox\" id=\"cb_permit_edits\" onclick=\"permit_edits = !el_eval('cb_permit_edits')\" />Disable edit mode for all pages (useful when publishing the Wiki On a Stick file on a web server)<br />\n\
  <label for=\"cb_dblclick_edit\"><input type=\"checkbox\" id=\"cb_dblclick_edit\" onclick=\"dblclick_edit = el_eval('cb_dblclick_edit')\" />Double click to edit pages/menu<br />\n\
  <label for=\"cb_save_on_quit\"><input type=\"checkbox\" id=\"cb_save_on_quit\" onclick=\"save_on_quit = el_eval('cb_save_on_quit')\" />Automatically save options (if changed) before quitting<br />\n\
  <label for=\"cb_key_cache\"><input type=\"checkbox\" id=\"cb_key_cache\" onclick=\"key_cache = !el_eval('cb_key_cache')\" />Do not temporarily cache the AES key (will have to enter it for each encrypted page, useful if you leave WoaS open to possible unauthorized access)<br />\n\
  <label for=\"cb_fixed_layout\"><input type=\"checkbox\" id=\"cb_fixed_layout\" onclick=\"_set_layout(el_eval('cb_fixed_layout'))\" />Fixed menu area and topbar<br />\n\
  <input type=\"button\" onclick=\"save_options()\" value=\"Save options\" />",
"Import a wiki from an early (or current) version:\n\
\n\
File: <input id=\"filename_\" type=\"file\" />&nbsp;<input type=\"button\" value=\"Import\" onclick=\"import_wiki()\" />\n\
\n\
*Important:* CSS will not be imported from versions below v0.04",
"!Wiki on a Stick version 0.9\n\
\n\
Current version *v0.9B* by Daniele C. ([[http://sf.net/users/legolas558/|legolas558]])\n\
Original version (v0.01 &tilde; v0.04) by Andr\u00e9 Wagner\n\
Wiki on a Stick is licensed under the [[http://www.gnu.org/copyleft/gpl.html|GNU/GPL]] license.\n\
\n\
!!Thanks to\n\
This project wouldn't be what it is without the help of other people. If you contributed to Wiki on a Stick and your name is not here, please send an email to <a class=\"world\" href=\"mailto:legolas558 _AT_ users.sourceforge.net\">this email address</a>. If, for any reason, you don't want your name listed here, just send an email.\n\
\n\
* *Jeremy Ruston* - the creator of the wonderful [[http://www.tiddlywiki.com/|TiddlyWiki]], who served as inspiration for Wiki on a Stick. He also kindly allowed the usage of his saving/loading routines.\n\
* *Philip O'Donnel* - creator of the table syntax & parsing code\n\
* *Tim Lord*\n\
* *Knut Kohl*\n\
* *Rob Schmersel*\n\
* *Michiel van Everdingen* - original javascript implementation of AES encryption\n\
* *Cyril Mazard* - search feature\n\
\n\
And, last but not least:\n\
\n\
* *the StickWiki google group* users for their support, advices and testing which has pushed WoaS development up to the current status.\n\
\n\
!!Contributing\n\
\n\
Read more at [[http://sf.net/projects/stickwiki/|Our SourceForge Project]]\n\
We also have an active [[http://groups.google.com/group/stickwiki/|Google dicussion group]]",
"!Welcome to Wiki on a Stick!\n\
A self-containing XHTML/javascript wiki.\n\
\n\
!!How to use\n\
/(click on the pencil icon on the top right corner to edit the wiki source)/\n\
\n\
You can also double click anywhere on the text to edit (if this option is enabled from [[Special::Advanced]]), and you can use escape to cancel editing or to go backward.\n\
\n\
!!Upgrading\n\
\n\
If you have an older Wiki on a Stick (v0.01 &tilde; v0.04), [[Special::Import|import it]]!\n\
\n\
!!!Syntax changes in v0.9\n\
There have been a few changes in the wiki syntax, they will be automatically applied on import or saving (except the wiki link parts inversion).\n\
\n\
* bullet lists are recognized using a plus sign '+' (previous stickwiki syntax) or an asterisk '*' (0.9 stickwiki syntax), with preference for asterisk lists\n\
* wiki link parts are inverted, e.g. no more [<!-- -->[the label|WikiActualPage]] but [<!-- -->[WikiActualPage|the label]]\n\
* lines ending with a backslash '' will be joined\n\
\n\
!!!New features\n\
* namespaces support through the separator '::'\n\
* tags support through [<!-- -->[Tag:Sometag]] or [<!-- -->[Tags:Sometag, Somethingelse]] syntax\n\
\n\
!Syntax examples \n\
\n\
Follows a brief example of all the capabilities of Wiki on a Stick syntax.\n\
\n\
!!Formatting\n\
!!!Subheader of third level\n\
!!!!Subheader of fourth level\n\
<pre>\n\
This is pre-formatted text! This text does not get _underlined_, as you can see\n\
</pre>\n\
\n\
<pre style=\"color:gray\">\n\
This is pre-formatted text with CSS style!\n\
</pre>\n\
\n\
!!Some specials\n\
\n\
Using [[Special::Main Page]] you will always link to the main page, no matters what its name is.\n\
\n\
New pages have red links, like this [[New page]], but you can use [[Special::New page]] to automatically create a new one.\n\
\n\
!!Tags and namespaces\n\
There is support for [[Tagged::Nice|tags]] and namespaces. For example, see [[MyPages::Page 1]] (password is /test/) and [[MyPages::Page 2]], both belonging to the [[MyPages::]] namespace. You can also use subnamespaces, like in [[MyPages::Approved::Page 3]]\n\
\n\
!!Syntax parser testcases\n\
\n\
On my right there is some _underlined text_, followed by *bold text* and /italics/.\n\
\n\
Now I will use /*italics and bold*/, followed by */bold and italics/* and finally _*/underlined bold italics/*_.\n\
\n\
Maybe you want to see some *_/bold underlined italics/_* or also some */_bold italics underlined_/*?\n\
\n\
And here is, just for you, a partial *bold-/italics/*!!!\n\
\n\
*Some bold text* on a line beginning\n\
\n\
!!Syntax\n\
\n\
External links: [[http://stickwiki.sourceforge.net/|Wiki on a Stick]]\n\
\n\
As you can see, /an/unix/path/ is correctly recognized.\n\
\n\
Boldface: *Boldface text*\n\
Italics: /italics text/\n\
Underline: _underlined text_\n\
\n\
Ruler:\n\
---\n\
\n\
List:\n\
* Item 1\n\
** Subitem a\n\
** Subitem b\n\
* Item 2\n\
** Subitem c\n\
*** Subsubitem d\n\
* Item 3\n\
\n\
Numbered list:\n\
# Item A\n\
## Subitem i\n\
## Subitem ii\n\
# Item B\n\
## Subitem iii\n\
### Subsubitem iv\n\
# Item C\n\
\n\
!!Tables\n\
\n\
{|\n\
|+ Telephone Table\n\
| *Column Name* || *Type* || *Other* || *Description*\n\
|-\n\
| id || INT || PRIMARY KEY || Row ID\n\
|-\n\
| contact_id || INT || KEY || References FOREIGN KEY(Contacts.id)\n\
|-\n\
| type || ENUM('Home','Work','Mobile','Pager','Other') || || Defines type of Telephone record\n\
|-\n\
| number || CHAR(32) || || Contains actual Telephone number\n\
|}",
"!Search in Wiki\n\
\n\
<input id=\"string_to_search\" type=\"text\" onfocus=\"search_focus(true)\" onblur=\"search_focus(false)\" />&nbsp;<input type=\"button\" value=\"Search\" onclick=\"do_search()\" />&nbsp;<input type=\"button\" value=\"Clear\" onclick=\"clear_search()\" />\n\
",
"Hey, don't tell anyone around but...I am better than [[MyPages::Page 1]]!",
"This is a page in a subnamespace!\n\
\n\
The parent namespace is [[MyPages::]] while the subnamespace is [[MyPages::Approved::]]\n\
\n\
[[Tag::Useful]]",
"saadadsasd\n\
\n\
dasasd",
"!!AES encryption\n\
Read more about the [[Special::Security|embedded AES encryption]] used in Wiki On a Stick.\n\
\n\
!!Password\n\
Enter your password for AES encryption. The more complex your password is, the more difficult it will be to attack the encryption. It is suggested *not* to use passwords whose textbox color is <span style=\"background-color:red\">&nbsp;red&nbsp;</span>, and to accept passwords only when the textbox color is <span style=\"background-color:lime\">&nbsp;green&nbsp;</span>.\n\
\n\
 *If you forget the password there is no way to retrieve it or your data, FOREVER.*\n\
\n\
  <input type=\"password\" id=\"pw1\" style=\"background-color:red\" value=\"\" size=\"50\" onfocus=\"custom_focus(true)\" onblur=\"custom_focus(false)\" onkeyup=\"pw_quality()\" />&nbsp;<span id=\"txtBits\">&nbsp;</span>\n\
  <input type=\"password\" id=\"pw2\" value=\"\" size=\"50\" onfocus=\"custom_focus(true)\" onblur=\"custom_focus(false)\" />\n\
  <input id=\"btn_lock\" type=\"button\" value=\"\" />",
"!!AES encryption\n\
Since Wiki on a Stick v0.9 the [[http://en.wikipedia.org/wiki/Advanced_Encryption_Standard|AES]] 256-bit high security data encryption standard is supported to protect a single page or groups of them.\n\
\n\
 *If you forget the password there is no way to retrieve it or your data, FOREVER*.\n\
\n\
!!How Do I Encrypt a page?\n\
In order to encrypt a page you will have to click on the /lock/ icon on the top-right navigation panel; if your page is already encrypted you will first have to unlock it.\n\
\n\
!!Security level\n\
Security is never absolute. Data encrypted with these pages might be compromised in a variety of ways, including but not limited to the following:\n\
\n\
* You have not disabled the AES key cache, so when you will enter the password for the first time other users (if not you) will be able to see encrypted pages and could possibly get your key\n\
* Your Web browser and/or JavaScript interpreter may contain bugs or deliberate security violations which report activity on your computer back to some other Internet site.\n\
* Some other applet running on another page in your browser, perhaps without your being aware of its existence, is spying on other windows.\n\
* Some other \"spyware\" application running on your computer may have compromised your system's security and be snooping on your activity.\n\
* Your Web browser may be keeping a \"history log\" or \"cache\" of data you generate. Somebody may come along later and recover a copy of your data from that log.\n\
* The implementation of the encryption may contain a bug which makes its results insecure. This is why transparency is essential. Wiki on a Stick is open-source. You can judge for yourself whether the tool merits your confidence.\n\
* Your computer's security may have been compromised physically; when's the last time you checked that a bug that transmits your keystrokes and/or screen contents to that white van parked down the street wasn't lurking inside your computer cabinet?\n\
\n\
Apart from the above, your normal usage of encrypted pages can be considered secure. They will be even more secure if you do not open them.",
"[[Tag::Nice]]\n\
\n\
This is indeed the better page of the wiki, and it is _cryptographically protected_ too!",
"This project wouldn't be what it is without the help of other people. I'll try not be unfair, if you contributed to Wiki on a Stick and your name is not here, please send me a <a class=\"world\" href=\"mailto:andre_nho@users.sourceforge.net\">e-mail</a>.\n\
\n\
* *Jeremy Ruston* - the creator of the wonderful [[http://www.tiddlywiki.com/|TiddlyWiki]], who served as inspiration for StickWiki. He also kindly allowed me to use his saving/loading routines.\n\
* *Philip O'Donnel* - creator of the table routines\n\
* *Tim Lord*\n\
* *Knut Kohl*\n\
* *Rob Schmersel*\n\
\n\
If, for any reason, you don't want your name listed here, please send me a <a class=\"world\" href=\"mailto:andre_nho@users.sourceforge.net\">e-mail</a>.\n\
\n\
Some of you sent me changes but I still hadn't the time to test them and add them. Please stay tuned! :-) Also, be sure to check the CVS version before suggesting changes, since what you suggest might already be implemented!"
];

/* UUZJizdTQtSsJsMSZA-END */



/* ]]> */ </script>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<style type="text/css">/* existent link */
a.link {
  color: blue;
}
a.link:hover {
  text-decoration: underline;
  cursor: pointer;
}

/* unexistent link */
a.unlink {
  color: red;
}
a.unlink:hover {
  text-decoration: underline;
  cursor: pointer;
}

/* outside world link */
a.world {
  color: darkgreen;
  text-decoration: underline;
}
a.world:hover {
  cursor: pointer;
}

/* Main text */
div.text_area {
  border-width: 1pt;
  border-color: grey;
  border-style: solid;
  background-color: white;
  padding: 10pt;
}

/* since v0.9 */
h1 { font-size: 23px; }

h2 { font-size: 20px; }

h3 { font-size: 17px; }

h4 { font-size: 14px; }

div.taglinks {
	border: 1px solid #aaa;
/*	background-color: #f9f9f9; */
	padding: 5px;
	margin-top: 1em;
	clear: both;
}

div.search_results {
	border: 1px solid #aaa;
	background-color: #f9f9f9;
	padding: 5px;
	margin-top: 1em;
	clear: both;
}

a.link.tag {
  color: navy;
}

/* main wiki pane when locked */
div.text_area.locked {
	background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAAAAACMmsGiAAAALHRFWHRDcmVhdGlvbiBUaW1lAGdpbyAyOSBtYXIgMjAwNyAxMTo1MToxMCArMDEwME%2BTNUAAAAAHdElNRQfXAx0JNByGxueSAAAACXBIWXMAAAsSAAALEgHS3X78AAAABGdBTUEAALGPC%2FxhBQAAABlJREFUeNpj%2FM%2FwmYHpMwMvAxOQwcvECyQBO1oE%2BlG5iisAAAAASUVORK5CYII%3D);
	background-color: #eeeeee;
}

div.menu {
}

/* page title */
.title {
  font-size: 24pt;
  font-weight: bold;
  margin-bottom: 0pt;
  margin-top: 0pt;
  display:inline;
}

.bg {
/*	background-color: #CCFFCC;	*/
	background-color: #F0F0F5;
}

#wiki_text {
	position: relative;
	left: 16%;
	width: 81%;
	z-index: 0;
}

table.text_area {
	border-color: black;
	border-spacing: 0px;
	border-style: solid; 
	border-width: 1px;
}

table.text_area td {
	border-style: solid; 	 
	border-width: 1px;	
	padding: 5px;
}

/* Left menu */
div.menu_area {
	border-width: 1pt;
	border-color: grey;
	border-style: solid;
	font-size: 9pt;
	background-color: white;
	padding: 5pt;
	width: 13%;
	left: 1%;
}

div.wiki_header {
	top: 0px;
	left: 0px;
	border: 1px solid #aaa;
	filter:alpha(opacity=75);-moz-opacity:.75;opacity:.75;
	z-index: 1;
}</style>

<script language="javascript" type="text/javascript">
/* <![CDATA[ */
/*** stickwiki.js ***/

// page attributes bits are mapped to (readonly, encrypted, ...)

var debug = true;			// toggle debug mode (and console)
var save_override = true;	// allow to save when debug mode is active
var end_trim = true;		// trim pages from the end

var forstack = new Array();
var cached_search = "";
var cfg_changed = false;	// true when configuration has been changed
var search_focused = false;
var _custom_focus = false;
var prev_title = current;	// used when entering/exiting edit mode
var decrypt_failed = false;
var post_dom_render = "";
var result_pages;
var last_AES_page;

var ie = false;
var firefox = false;
var opera = false;
//var unsupported_browser = true;

// Returns the element by ID
function el(name)
{
	return document.getElementById(name);
}

// fixes the array.push and array.splice methods
if (typeof Array.prototype.push == "undefined") {
  Array.prototype.push = function(str) {
    this[this.length] = str;
  }
}

if (typeof Array.prototype.splice == "undefined") {
  Array.prototype.splice = function(offset, length) {
    var temp = [];
    for (var i = this.length - 1; i >= 0; i--) {
      if (i < offset || i > (offset + length - 1)) {
        temp[temp.length] = this[i];
      }
      this.length--;
    }
    for (i = temp.length - 1; i >= 0; i--) {
      this[this.length] = temp[i];
    }
  }
}

function page_index(page) {
	for(var i=0; i<page_titles.length; i++)
	{
		if(page_titles[i].toUpperCase() == page.toUpperCase())
			return i;
	}
	return -1;
}

function page_exists(page)
{
	return (is_reserved(page) || (page.substring(page.length-2)=="::") || (page_index(page)!=-1));
}

function str_rep(s, n) {
  var r = "";
   while (--n >= 0) r += s;
   return r;
}

function _rand(scale) {
	return Math.floor(Math.random() * scale);
}

function _random_string(string_length) {
	var chars = "ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";
	var randomstring = '';
	for (var i=0; i<string_length; i++) {
		var rnum = _rand(chars.length);
		randomstring += chars.charAt(rnum);
	}
	return randomstring;
}

var parse_marker = "#"+_random_string(8);

function _get_tags(text) {
	var tags = new Array();
	if (text.indexOf("Tag::")==0) {
		tags.push(text.substring(5));
	} else if (text.indexOf("Tags::")==0) {
		var alltags = text.substring(6).split(",");
		for(var i=0;i<alltags.length;i++) {
			tags.push(alltags[i].replace(/^\s/g, "").replace(/\s$/g, ""));
		}
	}
	return tags;
}

function header_replace(hdr_char, len, text) {
	var esc_hdr_char = RegExp.escape(hdr_char);
	return text.replace( new RegExp("(^|\n)"+str_rep(esc_hdr_char, len)+"([^"+esc_hdr_char+"\n].*)(\n"+esc_hdr_char+"?)?", "g"), 	function (str, $1, $2, $3) {
		if ($2.indexOf(str_rep(hdr_char, len))==$2.length-len)
			header = $2.substr(0, $2.length-len);
		else
			header = $2;
		var tmp = $3;
		if (tmp.length==1)
			tmp = "";
		return "</p>"+"<h"+len+">"+header+"</h"+len+"><p class=level"+len+">"+tmp;
	});
}

// XHTML lists parsing code by plumloco
// This is a bit of a monster, if you know an easier way please tell me!
// There is no limit to the level of nesting and it produces
// valid xhtml markup.
var reReapLists = /(?:^|\n)([\*#])[ \t].*(?:\n\1+[ \t][^\n]+)*/g;
function parseList(str, type, $2) {
        var uoro = (type=='#')?'ol':'ul';
        var suoro = '<' + uoro + '>';
        var euoro = '</' + uoro + '>';

        function sublist(lst, ll)
        {   
            var s = '';
            var item, sub

            while (lst.length && lst[0][1].length == ll )
            {
                item = lst.shift();
                sub = sublist(lst, ll + 1);
                if (sub.length)
                {
                    s += '<li>' + item[2] + suoro + sub + euoro + '</li>' ;
                }
                else
                {
                    s += '<li>' + item[2] + '</li>';
                }
            }
            return s;  
        }
		
        var old = 0;
        var reItems = /^([\*#]+)[ \t]([^\n]+)/mg;

		var stk = [];
	    str.replace( reItems,
                function(str, p1, p2)
                {
//					log("p1 = "+p1+", p2 = "+p2);
                    level = p1.length;
					if (debug) {
	                    if ((level - old) > 1)
	                    {
	                        alert('ListNestingError');
	                    }
					}
                    old = level;
                    stk.push([str, p1, p2]);
                }
            );

		return "\n"+suoro + sublist(stk, 1) + euoro;
	}

	var reReapTables = /(?:^|\n)\{\|.*((?:\n\|.*)*)(?:\n|$)/g;	
    function parseTables(str, p1)
    {
        var caption = false;
        var stk = [];
        p1.replace( /\n\|([+ -])(.*)/g, function(str, pp1, pp2)
            {
                if (pp1 == '-')
                {
                    return;
                }
                if (pp1 == '+')
                {
                    caption = caption || pp2;
                    return;
                }
                stk.push('<td>' + pp2.split(' ||').join('</td><td>') + '</td>');
            } 
        );
        return  '<table class="text_area">' +
                    (caption?('<caption>' + caption + '</caption>'):'') +
                    '<tr>' + stk.join('</tr><tr>') + '</tr>' +
                '</table>' 
    }


// single quote escaping for page titles	
function _sq_esc(s) {
	return s.replace(/'/g, "\\'");
}

// used not to break layout when presenting search results
var force_inline = false;

// Parse typed code into HTML
function parse(text)
{
	if (text == null) {
		log("text = null while parsing current page \""+current+"\"");
		return;
	} //else		log("typeof(text) = "+typeof(text));

	// thank you IE, really thank you
	if (ie)
		text = text.replace("\r\n", "\n");

	var prefmt = [];
	var tags = [];
	var html_tags = [];

	// put away stuff contained in <pre> tags
	text = text.replace(/(\<pre.*?>(.|\n)*?<\/pre>)/g, function (str, $1) {
		var r = "<!-- "+parse_marker+prefmt.length+" -->";
		prefmt.push($1);
		return r;
	});
	
	// save html tags attributes
	text = text.replace(/\<\w+[^>]*>/g, function (tag) {
		var r = "<!-- "+parse_marker+'::'+html_tags.length+" -->";
		html_tags.push(tag);
		return r;
	});
	
	// <u>
	text = text.replace(/(^|[^\w])_([^_]+)_/g, "$1"+parse_marker+"uS#$2"+parse_marker+"uE#");
	
	// italics
	text = text.replace(/(^|[^\w])\/([^\/]+)\/($|[^\w])/g, function (str, $1, $2, $3) {
		if (str.indexOf("//")!=-1) {
			return str;
		}
		return $1+"<i>"+$2+"</i>"+$3;
	});
	
	// ordered/unordered lists parsing (code by plumloco)
	text = text.replace(reReapLists, parseList);
	
	// headers (from h1 to h6, as defined by the HTML 3.2 standard)
	for(i=1;i<7;i++) {
		text = header_replace("!", i, text);
	}
	
	// <b>
	text = text.replace(/\*([^\*\n]+)\*/g, parse_marker+"bS#$1"+parse_marker+"bE#");

	// <strike>
	//text = text.replace(/(^|\n|\s|\>|\*)\-(.*?)\-/g, "$1<strike>$2<\/strike>");
	// <br />
	
	text = text.replace(new RegExp(parse_marker+"([ub])([SE])#", "g"), function (str, $1, $2) {
		if ($2=='E')
			return "</span>";
		if ($1=='u')
			tag = "<span style=\"text-decoration:underline;\">";
		else
			tag = "<span style=\"font-weight: bold;\">";
		return tag;
	});

	// <hr>
	text = text.replace(/(^|\n)\-\-\-/g, "<hr />");
	
    text = text.replace(reReapTables, parseTables);

	// links with | 
	text = text.replace(/\[\[([^\]\]]*?)\|(.*?)\]\]/g, function(str, $1, $2)
			{
				if($1.indexOf("://")!=-1)
					return "<a class=\"world\" href=\"" + $1 + "\" target=\"_blank\">" + $2 + "<\/a>";
				
				if(page_exists($1))
					return "<a class=\"link\" onclick='go_to(\"" + _sq_esc($1) +"\")'>" + $2 + "<\/a>";
				else
					return "<a class=\"unlink\" onclick='go_to(\"" + _sq_esc($1) +"\")'>" + $2 + "<\/a>";
			}); //"<a class=\"wiki\" onclick='go_to(\"$2\")'>$1<\/a>");
	// links without |
	var inline_tags = 0;
	text = text.replace(/\[\[([^\|]*?)\]\]/g, function(str, $1)
			{
				if($1.match("://"))
					return "<a class=\"world\" href=\"" + $1 + "\" target=\"_blank\">" + $1 + "<\/a>";
					
				found_tags = _get_tags($1);
				
				if (found_tags.length>0) {
					tags = tags.concat(found_tags);
					if (!force_inline)
						return "";
					inline_tags++;
					return "<!-- "+parse_marker+":"+inline_tags+" -->";
				}
				
				if(page_exists($1))
					return "<a class=\"link\" onclick=\"go_to('" + _sq_esc($1) +"')\">" + $1 + "<\/a>";
				else
					return "<a class=\"unlink\" onclick=\"go_to('" + _sq_esc($1) +"')\">" + $1 + "<\/a>";
					}); //"<a class=\"wiki\" onclick='go_to(\"$1\")'>$1<\/a>");

	// end-trim
	if (end_trim)
		text = text.replace(/[\n\s]*$/, "");

	// fix double newlines
	text = text.replace(/\n\n/g, "<\/p><p>");

	// convert newlines (wrapped and plain) to br tags
	text = text.replace(/\\?\n/g, "<br />");
	
	if (prefmt.length>0) {
//		log("Replacing "+prefmt.length+" preformatted blocks");
		text = text.replace(new RegExp("<\\!-- "+parse_marker+"(\\d+) -->", "g"), function (str, $1) {
//			log("Replacing prefmt block #"+$1);
			return prefmt[$1];
		});
		// make some newlines cleanup - disabled
		text = text.replace(/(<br \/>)?(<\/?pre>)(<br \/>)?/gi, "$2");
	}
	
	if (html_tags.length>0) {
		text = text.replace(new RegExp("<\\!-- "+parse_marker+"::(\\d+) -->", "g"), function (str, $1) {
			return html_tags[$1];
		});
	}

	
	if (tags.length) {
		if (force_inline)
			s = "";
		else
			s = "<div class=\"taglinks\">";
		s += "Tags: ";
		for(var i=0;i<tags.length-1;i++) {
			s+="<a class=\"link tag\" onclick=\"go_to('Tagged::"+_sq_esc(tags[i])+"')\">"+tags[i]+"</a>&nbsp;&nbsp;";
		}
		if (tags.length>0)
			s+="<a class=\"link tag\" onclick=\"go_to('Tagged::"+_sq_esc(tags[tags.length-1])+"')\">"+tags[tags.length-1]+"</a>";
		if (!force_inline) {
			s+="</div>";
			text += s;
		} else {
			text = text.replace(new RegExp("<\\!-- "+parse_marker+":(\\d+) -->", "g"), function (str, $1) {
				if ($1==inline_tags)
					return s;
				return "";
			});
		}
	}
	if (force_inline)
		force_inline = false;
	
	return "<p class=\"level0\">" + text + "</p>";
}

// prepends and appends a newline character to workaround plumloco's XHTML lists parsing bug
function _join_list(arr) {
	if (!arr.length)
		return "";
	result_pages = arr.slice(0);
	return "\n* [["+arr.sort().join("]]\n* [[")+"]]\n";
}

function _simple_join_list(arr, sorted) {
	if (sorted)
		arr = arr.sort();
	return arr.join("\n")+"\n";
}

// with two trailing double colon
function _get_namespace(ns) {
	var pg = new Array();
	switch (ns) {
		case "Locked::":
			return "!Pages in "+ns+" namespace\n" + special_encrypted_pages(true);
		case "Unlocked::":
			return "!Pages in "+ns+" namespace\n" + special_encrypted_pages(false);
	}

	for(var i=0;i<page_titles.length;i++) {
		if (page_titles[i].indexOf(ns)==0)
			pg.push( page_titles[i]);
	}
	return "!Pages in "+ns+" namespace\n" + _join_list(pg);
}

function _get_tagged(tag) {
	var pg = new Array();

	var tmp;
	for(var i=0; i<pages.length; i++)
	{
		tmp = get_page(i);
		if (tmp==null)
			continue;
		tmp.replace(/\[\[([^\|]*?)\]\]/g, function(str, $1)
			{
				if($1.match("://"))
					return;
					
				found_tags = _get_tags($1);
				
//				alert(found_tags);
				
				for (var t=0;t<found_tags.length;t++) {
					if (found_tags[t] == tag)
						pg.push(page_titles[i]);
				}

				
			});
	}
	
	if (!pg.length)
		return "No pages tagged with *"+tag+"*";
	return "!Pages tagged with " + tag + "\n" + _join_list(pg);
}

function special_encrypted_pages(locked) {
	var pg = [];
	for(var i=0;i<pages.length;i++) {
		if (locked == is__encrypted(i))
			pg.push(page_titles[i]);
	}
	return _join_list(pg);
}

// Returns a index of search pages (by miz & legolas558)
function special_search( str )
{
	var pg_body = new Array();
	var title_result = "";

	var count = 0;
	// matches the search string and nearby text
	var reg = new RegExp( ".*?" + RegExp.escape(str).replace(/^\s+/, "").
					replace(/\s+$/, "").replace(/\s+/g, ".*?") + ".*", "gi" );

	var tmp;
	result_pages = [];
	for(var i=0; i<pages.length; i++)
	{
		if (is_reserved(page_titles[i]) && (page_titles[i] != "Special::Menu"))
			continue;
			
		tmp = get_page(i);
		if (tmp==null)
			continue;
//		log("Searching into "+page_titles[i]);
		
//		log("Regex is \""+reg+"\"");

		var added = false;
		//look for str in title
		if(page_titles[i].match(reg)) {
			title_result += "* [[" + page_titles[i] + "]]\n";
			result_pages.push(page_titles[i]);
			added = true;
		}

		//Look for str in body
		res_body = tmp.match( reg );
//		log("res_body = "+res_body);
		if (res_body!=null) {
			count = res_body.length;
			res_body = res_body.join(" ").replace( /\n/g, " ");
			pg_body.push( "* [[" + page_titles[i] + "]]: found *" + count + "* times :<div class=\"search_results\"><i>...</i><br />" + res_body +"<br/><i>...</i></div>");
			if (!added)
				result_pages.push(page_titles[i]);
		}
	}
	
	if (!pg_body.length && !title_result.length)
		return "No results found for *"+str+"*";
	force_inline = true;
	return "Results for *" + str + "*\n" + title_result + "\n\n---\n" + _simple_join_list(pg_body, false);
}

// Returns a index of all pages
function special_all_pages()
{
	var pg = new Array();
	var text = "";
	for(var i=0; i<page_titles.length; i++)
	{
		if (!is_reserved(page_titles[i]))
			pg.push( page_titles[i] );
	}
	return _join_list(pg);
}

// Returns a index of all dead pages
function special_dead_pages () {
	var dead_pages = new Array();
	var from_pages = new Array();
	var page_done = false;
	var tmp;
	for (j=0;j<pages.length;j++) {
		tmp = get_page(j);
		if (tmp==null)
			continue;
		tmp.replace(/\[\[([^\]\]]*?)(\|([^\]\]]+))?\]\]/g,
			function (str, $1, $2, $3) {
				if (page_done)
					return false;
//				log("In "+page_titles[j]+": "+$1+" -> "+$3);
				if ($1.indexOf("://")!=-1)
					return;
				if ($1.match(/Tag(s|ged)?:/gi))
					return;
				p = $1;
				if (!page_exists(p) && ((up = p.toUpperCase)!=page_titles[j].toUpperCase())) {
//					up = p.toUpperCase();
					for(var i=0;i<dead_pages.length;i++) {
						if (dead_pages[i].toUpperCase()==up) {
							from_pages[i].push(page_titles[j]);
							page_done = true;
							break;
						}
					}
					if (!page_done) {
						dead_pages.push(p);
						from_pages.push(new Array(page_titles[j]));
						page_done = true;
					}
				}
	        }
		);
		page_done = false;
	}

	var pg = new Array();
	for(var i=0;i<dead_pages.length;i++) {
		s = "[["+dead_pages[i]+"]] from ";
		var from = from_pages[i];
		for(j=0;j<from.length-1;j++) {
			s+="[["+from[j]+"]], ";
		}
		if (from.length>0)
			s+="[["+from[from.length-1]+"]]";
		pg.push(s);
	}

  result_pages = dead_pages;	
  if (!pg.length)
	return '<i>No dead pages</i>';
  return _simple_join_list(pg, true);
}

// Returns a index of all orphaned pages
function special_orphaned_pages()
{
	var pg = new Array();
	var found = false;
	for(j=0; j<pages.length; j++)
	{
		if (is_reserved(page_titles[j]))
			continue;
		// search for pages that link to it
		var tmp;
		for(var i=0; i<pages.length; i++) {
			if ((i==j) /*|| is_reserved(page_titles[i])*/)
				continue;
			tmp = get_page(i);
			if (tmp==null)
				continue;
			if (tmp.match(new RegExp("\\[\\["+RegExp.escape(page_titles[i])+"(\\||\\]\\])", "gi"))) {
//					log("Page \""+page_titles[j]+"\" linked from page \""+page_titles[i]+"\"");
					found = true;
					break;
			}
		}
		if(found == false) {
			if (!is_reserved(page_titles[j]))
				pg.push( page_titles[j] );
		} else found = false;
	}
//	alert(pages[0]);
	if (!pg.length)
		return "/No orphaned pages found/";
	else
		return _join_list(pg); // TODO - Delete repeated data
}

function special_links_here()
{
	var pg = new Array();
	var tmp;
	var reg = new RegExp("\\[\\["+RegExp.escape(current)+"(\\||\\]\\])", "gi");
	for(j=0; j<pages.length; j++)
	{
		// search for pages that link to it
		tmp = get_page(j);
		if (tmp==null)
			continue;
		if (tmp.match(reg)) {
			pg.push( page_titles[j] );
		}
	}
	if(pg.length == 0)
		return "/No page links here/";
	else
		return "!!Links to "+current+"\n"+_join_list(pg);
}

function is_readonly(page) {
	return is__readonly(page_index(page));
}

function is__readonly(pi) {
	if (page_attrs[pi] & 1)
		return true;
	return false;
}

function is__encrypted(pi) {
	if (debug) {
		if (pi==-1) {
			alert("Invalid page index!");
			return;
		}
	}
//	log(page_titles[pi]+" flags: "+page_attrs[pi].toString(16)+" (enc:"+(page_attrs[pi] & 2)+")");
	if (page_attrs[pi] & 2)
		return true;
	return false;
}
function is_encrypted(page) {
	return is__encrypted(page_index(page));
}

// return a plain page or a decrypted one if available through the latest key
function get_page(pi) {
	if (!is__encrypted(pi))
		return pages[pi];
	if (!key.length)
		return null;
	var pg = AES_decrypt(pages[pi].slice(0));	/*WARNING: may not be supported by all browsers*/
	last_AES_page = page_titles[pi];
	return pg;	
}

function get_text(title) {
	var pi = page_index(title);
	if (pi==-1)
		return null;
	// is the page encrypted or plain?
	if (!is__encrypted(pi))
		return pages[pi];
	decrypt_failed = true;
	var retry = 0;		
	var pg = null;
	do {
		if (retry || !key.length) {
			var pw = prompt('The latest entered password (if any) was not correct for page "'+title+"'\n\nPlease enter the correct password.", '');
			if (pw==null)
				return null;
			if (!pw.length)
				return null;
			AES_setKey(pw);
			retry++;
		}
		// pass a copied instance to the decrypt function
		pg = AES_decrypt(pages[pi].slice(0));	/*WARNING: may not be supported by all browsers*/
		last_AES_page = title;
		if (pg != null)
			break;
	} while (retry<2);
	if (pg != null) {
		decrypt_failed = false;
		if (!key_cache)
			AES_clearKey();
	} else {
		alert("Access denied");
		AES_clearKey();
	}
	return pg;
}

function _set_text(pi, text) {
	log("Setting wiki text for page #"+pi+" \""+page_titles[pi]+"\"");
	text = _new_syntax_patch(text);
	if (!is__encrypted(pi)) {
		pages[pi] = text;
		return;
	}
	pages[pi] = AES_encrypt(text);
	last_AES_page = page_titles[pi];
}

// Sets text typed by user
function set_text(text)
{
	var pi = page_index(current);
	if (pi==-1) {
		log("current page \""+current+"\" is not cached!");
		return;
	}
	_set_text(pi, text);
}

// thanks to S.Willison
RegExp.escape = function(text) {
  if (!arguments.callee.sRE) {
    var specials = [
      '/', '.', '*', '+', '?', '|',
      '(', ')', '[', ']', '{', '}', '\\'
    ];
    arguments.callee.sRE = new RegExp(
      '(\\' + specials.join('|\\') + ')', 'g'
    );
  }
  return text.replace(arguments.callee.sRE, '\\$1');
}

function clear_search() {
	if (!cached_search.length)
		return;
	cached_search = "";
	assert_current("Special::Search");
}

function assert_current(page) {
	if( current != page )
		go_to( page ) ;
	else
		set_current( page );
}

// make the actual search and cache the results
function do_search()
{
	var search_string = el("string_to_search").value;

	if ( !search_string.length )
		return;
	
	cached_search = special_search( search_string )

	assert_current("Special::Search");
}

var reserved_namespaces = [
"Special", "Lock", "Locked", "Unlocked", "Unlock", "Tag", "Tagged"];

var reserved_rx = "^";
for(var i=0;i<reserved_namespaces.length;i++) {
	reserved_rx += /*RegExp.Escape(*/reserved_namespaces[i] + "::";
	if (i<reserved_namespaces.length-1)
		reserved_rx += "|";
}
reserved_rx = new RegExp(reserved_rx, "i");

function is_reserved(page) {
	return (page.search(reserved_rx)==0);
}

function _create_page(ns, cr, ask) {
	if (is_reserved(ns)) {
		alert("You are not allowed to create a page titled \""+ns+cr+"\" because namespace \""+ns+"\" is reserved");
			return false;
		}
	if (ask && !confirm("Page not found. Do you want to create it?"))
		return false;
	// create and edit the new page
	cr = ns+cr;
	pages.push("!"+cr+"\n");
	page_attrs.push(0);
	page_titles.push(cr);
	current = cr;
	log("Now pages list is: "+page_titles);
	edit_page(cr);
	return true;
//			save_page(cr);
}

function _get_special(cr) {
	var text = null;
	log("Getting special page "+cr);
	switch(cr) {
		case "New page":
			var title = prompt("Insert new page title", "");
			if ((title!=null) && title.length) {
				if (page_index(title)!=-1)
					alert("A page with title \""+title+"\" already exists!");
				else {
					cr = title;
					if (cr.substring(cr.length-2)=="::") {
						alert("You cannot create a page as a namespace");
					} else {
						var p = cr.indexOf("::");
						if (p!=-1) {
							ns = cr.substring(0,p+2);
							log("namespace of "+cr+" is "+ns);
							cr = cr.substring(p+2);
						} else ns="";
						if (!_create_page(ns, cr, false))
							return;
						if (confirm("Do you want to add a link in the main menu?")) {
							var menu = get_text("Special::Menu");
							var p = menu.indexOf("\n\n");
							if (p==-1)
								menu += "\n[["+ns+cr+"]]";
							else
								menu = menu.substring(0,p)+"\n[["+title+"]]"+menu.substring(p);
							_set_text(page_index("Special::Menu"), menu);
							refresh_menu_area();
						}
					}

				}
			}
			return;
		case "Search":
			text = get_text("Special::"+cr);
			text += cached_search;
			break;
		case "Advanced":
			text = get_text("Special::"+cr);
			post_dom_render = "_setup_options()";
			break;
		case "Erase Wiki":
			if (erase_wiki()) {
				save_to_file(true);
				back_or(main_page);
			}
			return null;
		case "Main Page":
			go_to(main_page);
			return null;
		case "All Pages":
			text = special_all_pages();
			break;
		case "Orphaned Pages":
			text = special_orphaned_pages();
			break;
		case "Pages not yet created":
			text = special_dead_pages();
			break;
		case "Backlinks":
			text = special_links_here();
			break;
		case "Edit Menu":
			go_to("Special::Menu");
			edit();
			return null;
		case "Edit CSS":
			current_editing("Special::"+cr, true);
			el("wiki_editor").value = document.getElementsByTagName("style")[0].innerHTML;
			return null;
		default:
			text = get_text("Special::"+cr);
			if(text == null)
				alert("Invalid special page.");
	}
	return text;
}

// Load a new current page
function set_current(cr)
{
	var text, namespace, ns;
	result_pages = [];
//	log("Setting \""+cr+"\" as current page");
	if (cr.substring(cr.length-2)=="::") {
		text = _get_namespace(cr);
		ns = "";
	} else {
		var p = cr.indexOf("::");
		if (p!=-1) {
			namespace = cr.substring(0,p);
			log("namespace of "+cr+" is "+namespace);
			cr = cr.substring(p+2);
				switch (namespace) {
					case "Special":
						text = _get_special(cr);
						if (text == null)
							return;
						break;
					case "Tagged":
						text = _get_tagged(cr);
						if (text == null)
							return;
						break;
					case "Lock":
						pi = page_index(cr);
						if (debug) {
							if ((pi==-1) || is__encrypted(pi)) {
								alert("Invalid lock page request");
								return;
							}
						}
						if (key.length) {
							if (confirm("Do you want to use the last password (last time used on page \""+latest_AES_page+"\") to lock this page \""+cr+"\"?")) {
								_perform_lock(pi);
								return;
							}
						}
						text = get_text("Special::Lock");
						post_dom_render = "_setup_lock_page('"+_sq_esc(cr)+"')";
						break;
					case "Unlock":
						pi = page_index(cr);
						if (debug) {
							if ((pi==-1) || !is__encrypted(pi)) {
								alert("Invalid lock page request");
								return;
							}
						}
						if (!confirm("Do you want to remove encryption for page \""+cr+"\"?"))
							return;
						text = get_text(cr);
						if (decrypt_failed) {
							decrypt_failed = false;
							return;
						}
						pages[pi] = text;
						page_attrs[pi] -= 2;
						if (!key_cache)
							AES_clearKey();
						save_to_file(true);
						set_current(cr);
						return;
					default:
						text = get_text(namespace+"::"+cr);
				}

			ns = namespace+"::";
		} else {
			ns = "";
			text = get_text(cr);
		}
	}
	
	if(text == null)
	{
		if (decrypt_failed) {
			decrypt_failed = false;
			return;
		}
		if (!_create_page(ns, cr, true))
			return;
	}
	
	log("set_current() with ns = \""+ns+"\", cr = \""+cr+"\"");

	load_as_current(ns+cr, text);
	if(document.getElementById("lastDate"))
		document.getElementById("lastDate").innerHTML = document.lastModified;
}

function load_as_current(title, text) {
	log("CURRENT loaded: "+title+", "+text.length+" bytes");
	current = title;
	el("wiki_title").innerHTML = title;
	el("wiki_text").innerHTML = parse(text);
	document.title = title;
	update_nav_icons(title);
	if (post_dom_render.length!=0) {
		eval(post_dom_render);
		post_dom_render = "";
	}
}

function bool2chk(b) {
	if (b) return "checked";
	return "";
}

function el_eval(name) {
	cfg_changed = true;
	if (el(name).checked)
		return true;
	return false;
}

function _setup_options() {
	el("cb_allow_diff").checked = bool2chk(allow_diff);
	el("cb_key_cache").checked = bool2chk(!key_cache);
	el("cb_dblclick_edit").checked = bool2chk(dblclick_edit);
	el("cb_permit_edits").checked = bool2chk(!permit_edits);
	el("cb_save_on_quit").checked = bool2chk(save_on_quit);
	el("cb_fixed_layout").checked = (el("sw_wiki_header").style.position == "fixed");
}

function _set_layout(fixed) {
	el("sw_wiki_header").style.position = (fixed ? "fixed" : "absolute");
	el("sw_menu_area").style.position = (fixed ? "fixed" : "absolute");
}

function _setup_lock_page(page) {
	el("btn_lock").value = "Lock "+page;
	el("pw1").focus();
	el("btn_lock").setAttribute("onclick", "lock_page('"+_sq_esc(page)+"')");
}

function lock_page(page) {
	var pwd = el("pw1").value;
	if (!pwd.length) {
		el("pw1").focus();
		return;
	}
	if (pwd!=el("pw2").value) {
		el("pw2").focus();
		return;
	}
	var pi = page_index(page);
	if (debug) {
		if (pi==-1) {
			alert("Cannot encrypt unexisting page!");
			return;
		}
		if (is__encrypted(pi)) {
			alert("Page already encrypted!");
			return;
		}
	}
	AES_setKey(pwd);
	_perform_lock(pi);
	last_AES_page = page;
	go_to(page);
	if (!key_cache)
		AES_clearKey();
}

function _perform_lock(pi) {
	pages[pi] = AES_encrypt(pages[pi]);
	log("E: encrypted length is "+pages[pi].length);
	page_attrs[pi] += 2;
	save_to_file(true);
}

var _pw_q_lock = false;

function pw_quality() {

	if (_pw_q_lock)
		return;
		
	_pw_q_lock = true;

function _hex_col(tone) {
	var s=Math.floor(tone).toString(16);
	if (s.length==1)
		return "0"+s;
	return s;
}

	// from http://lxr.mozilla.org/seamonkey/source/security/manager/pki/resources/content/password.js
	// Here is how we weigh the quality of the password
	// number of characters
	// numbers
	// non-alpha-numeric chars
	// upper and lower case characters
	var pw=el('pw1').value;

	//length of the password
	var pwlength=pw.length;
	
	if (pwlength!=0) {

	//use of numbers in the password
	  var numnumeric = pw.replace (/[0-9]/g, "");
	  var numeric=numnumeric.length/pwlength;

	//use of symbols in the password
	  var symbols = pw.replace (/\W/g, "");
	  var numsymbols= symbols.length/pwlength;

	//use of uppercase in the password
	  var numupper = pw.replace (/[A-Z]/g, "");
	  var upper=numupper.length/pwlength;
	  // end of modified code from Mozilla

	//   var pwstrength=((pwlength*10)-20) + (numeric*10) + (numsymbols*15) + (upper*10);
	  
		// 80% of security defined by length (at least 16, best 22 chars), 10% by symbols, 5% by numeric presence and 5% by upper case presence
		var pwstrength = ((pwlength/18) * 80) + (numsymbols * 10 + upper*5 + numeric*5);
	} else
		var pwstrength = 0;
  
	if (pwstrength>100)
		color = "#00FF00";
	else
		color = "#" + _hex_col((100-pwstrength)*255/100) + _hex_col((pwstrength*255)/100) + "00";
  
	el("pw1").style.backgroundColor = color;
	el("txtBits").innerHTML = "Key size: "+(pwlength*8).toString() + " bits";
	
	_pw_q_lock = false;
}

function refresh_menu_area() {
/*
	var bl_src = "\n\n[[Special::Backlinks]]";
	if (is_reserved(current)) {
		pre_src = "";
		post_src = bl_src;
	} else {
		post_src = "";
		pre_src = bl_src;
	}	*/
	el("menu_area").innerHTML = parse(get_text("Special::Menu")/*+pre_src)+post_src*/);
}

function _gen_display(id, visible, prefix) {
	el(prefix+"_"+id).style.display = (visible ? "inline" : "none");
}

function img_display(id, visible) {
	if (!ie) {
		_gen_display(id, visible, "img");
		_gen_display(id, !visible, "alt");
	} else {
		_gen_display(id, !visible, "img");
		_gen_display(id, visible, "alt");
	}
}

function menu_display(id, visible) {
	_gen_display(id, visible, "menu");
//	log("menu_"+id+" is "+el("menu_"+id).style.display);
}

function create_alt_buttons() {
	if (ie) {
		el("alt_back").innerHTML = "&#223;";
		el("alt_forward").innerHTML = "&#222;";
		el("alt_cancel").innerHTML = "&#251;";
	}
}

// save configuration on exit
function before_quit() {
	if (save_on_quit && cfg_changed)
		save_to_file(false);
	return true;
}

// when the page is loaded
function on_load()
{
	log("***** StickWiki started *****");
	
	document.body.style.cursor = "auto";
	
	if(debug == true)
		el("debug_info").style.display = "block";
	else
		el("debug_info").style.display = "none";
		
	if (!ie) {
//		setup_uri_pics(el("img_home"),el("img_back"),el("img_forward"),el("img_edit"),el("img_cancel"),el("img_save"),el("img_advanced"));
	}

	img_display("back", true);
	img_display("forward", true);
	img_display("home", true);
	img_display("edit", true);
	img_display("advanced", true);
	img_display("cancel", true);
	img_display("save", true);
	img_display("lock", true);
	img_display("unlock", true);
	
//	unsupported_browser = (!firefox && !ie);
//	document.getElementById("unsupported_browser").style.display = (unsupported_browser ? "block" : "none");

	// customized keyboard hook
	document.onkeydown = kbd_hook;

	// Go straight to page requested
	var qpage=document.location.href.split("?")[1];
	if(qpage)
		current = unescape(qpage);

	set_current(current);
	refresh_menu_area();
	disable_edit();
}

function ff_fix_focus() {
//runtime fix for Firefox bug 374786
	if (firefox)
		el("wiki_text").blur();
}

function search_focus(focused) {
	search_focused = focused;
	if (!focused)
		ff_fix_focus();
}

function custom_focus(focused) {
	_custom_focus = focused;
	if (!focused)
		ff_fix_focus();
}

var kbd_hooking=false;

function kbd_hook(orig_e)
{
	if (!orig_e)
		e = window.event;
	else
		e = orig_e;
		
	if (!kbd_hooking) {
		if (_custom_focus)
			return orig_e;
		if (search_focused) {
			if (e.keyCode==13) {
				ff_fix_focus();
				do_search();
				return false;
			}
			return orig_e;
		}
		if ((e.keyCode==8) || (e.keyCode==27)) {
			go_back();
			ff_fix_focus();
			return false;
		}
	}

	if (e.keyCode==27) {
		cancel();
		ff_fix_focus();
		return false;
	}

	return orig_e;
}

// when the page is resized
function on_resize()
{
	if(ie == false)
	{
		el("wiki_editor").style.width = window.innerWidth - 30 + "px";
		el("wiki_editor").style.height = window.innerHeight - 150 + "px";
	}
}

function update_nav_icons(page) {
	menu_display("back", (backstack.length > 0));
	menu_display("forward", (forstack.length > 0));
	menu_display("advanced", (page != "Special::Advanced"));
	menu_display("edit", edit_allowed(page));
	update_lock_icons(page, true);
}

function update_lock_icons(page, results_only) {
	var cyphered, can_lock, can_unlock;
	if (!results_only) {
		var pi = page_index(page);
		if (pi==-1) {
			can_lock = can_unlock = false;
			cyphered = false;
		} else {
			can_unlock = cyphered = is__encrypted(pi);
			can_lock = !can_unlock;
		}
	} else {
		log("result_pages is ("+result_pages+")");
		can_lock = can_unlock = (result_pages.length>0);
		cyphered = false;
	}
	
	menu_display("lock", !kbd_hooking && can_lock);
	menu_display("unlock", !kbd_hooking && can_unlock);
	var cls;
	if (cyphered || (page.indexOf("Locked::")==0))
		cls = "text_area locked";
	else
		cls = "text_area";
	el("wiki_text").className = cls;
}

// Adjusts the menu buttons
function disable_edit()
{
//	log("DISABLING edit mode");
	kbd_hooking = false;
	// check for back and forward buttons - TODO grey out icons
	update_nav_icons(current);
	menu_display("home", true);
	menu_display("save", false);
	menu_display("cancel", false);
	el("text_area").style.display = "inline";
	el("edit_area").style.display = "none";
//	log("setting back title to "+prev_title);
	document.title = el("wiki_title").innerHTML = prev_title;
}

function menu_dblclick() {
	if (!dblclick_edit)
		return false;
	edit_menu();
	return true;
}

function page_dblclick() {
	if (!dblclick_edit)
		return false;
	edit();
	return true;
}

function edit_menu() {
	edit_page("Special::Menu");
}

function lock() {
	if (result_pages.length)
		_lock_pages(result_pages);
	else
		go_to("Lock::" + current);
}

function unlock() {
	if (result_pages.length)
		_unlock_pages(result_pages);
	else
		go_to("Unlock::" + current);
}

function _lock_pages(arr) {
	alert("Not yet implemented");
}

function _unlock_pages(arr) {
	alert("Not yet implemented");
}

// when edit is clicked
function edit()
{
	edit_page(current);
}

var edit_override = false;

function edit_allowed(page) {
	if (edit_override)
		return (page_index(page) != -1);
	if (!permit_edits)
		return false;
	if (is_reserved(page) && (page!="Special::Menu"))
		return false;
	return !is_readonly(page);
}

// setup the title boxes and gets ready to edit text
function current_editing(page, disabled) {
	scrollTo(0,0);
	log("CURRENT editing "+page+", title disabled: "+disabled);
	prev_title = current;
	el("wiki_page_title").disabled = (disabled ? "disabled" : "");
	el("wiki_page_title").value = page;
	document.title = el("wiki_title").innerHTML = "Editing "+page;
	// current must be set BEFORE calling enabling menu edit
//	log("ENABLING edit mode");
	kbd_hooking = true;
	menu_display("back", false);
	menu_display("forward", false);
	menu_display("advanced", false);
	menu_display("home", false);
	menu_display("edit", false);
	menu_display("save", true);
	menu_display("cancel", true);
	update_lock_icons(page, false);
	el("text_area").style.display = "none";

	// FIXME!
	if(!ie)	{
		el("wiki_editor").style.width = window.innerWidth - 30 + "px";
		el("wiki_editor").style.height = window.innerHeight - 150 + "px";
	}
	el("edit_area").style.display = "inline";

	el("wiki_editor").focus();
	current = page;
}

function edit_page(page) {
	if (!edit_allowed(page))
		return;
	var tmp = get_text(page);
	if (tmp == null)
		return;
	// setup the wiki editor textbox
	current_editing(page, is_reserved(page));
	el("wiki_editor").value = tmp;
}

function rename_page(previous, newpage)
{
	log("Renaming "+previous+" to "+newpage);
	for(var i=0; i<pages.length; i++)
	{
		if(page_titles[i] == previous)
		{
			page_titles[i] = newpage;
			// TODO - change all references
			break;
		}
	}
	if (previous == main_page)
		main_page = newpage;
}

// when a page is deleted
function delete_page(page)
{
	for(var i=0; i<pages.length; i++)
	{
		if(page_titles[i].toUpperCase() == page.toUpperCase())
		{
			log("DELETED page "+page);
			page_titles.splice(i,1);
			pages.splice(i,1);
			page_attrs.splice(i,1);
			break;
		}
	}
}

// applies some on-the-fly patches for the syntax changes in v0.9
function _new_syntax_patch(text) {
	//BUG: will also modify text contained in <pre> tags
	text = text.replace(/(^|\n)(\+*)/g, function (str, $1, $2) {
		return $1+str_rep("*", $2.length);
	});
	
	return text;
}

// when save is clicked
function save()
{
	switch(current)
	{
		case "Special::Edit CSS":
			document.getElementsByTagName("style")[0].innerHTML = el("wiki_editor").value;
			back_to = null;
			current = "Special::Advanced";
			el("wiki_page_title").disabled = "";
			break;
		default:
			// check if text is empty
			if(el("wiki_editor").value == "")
			{
				if(confirm("Are you sure you want to DELETE this page?"))
				{
					delete_page(current);
					disable_edit();
					back_or(main_page);
					save_to_file(true);
				}
				return;
			} else {
				// here the page gets actually saved
				set_text(el("wiki_editor").value);
				new_title = el("wiki_page_title").value;
				if (new_title=="Special::Menu") {
					refresh_menu_area();
					back_to = prev_title;
//					alert(prev_title);
				} else { if (!is_reserved(new_title) && (new_title != current))
							rename_page(current, new_title);
					back_to = new_title;
				}				
			}
	}
	save_page(current);
	
	if (back_to != null)
		set_current(back_to);
	else // used for CSS editing
		back_or(main_page);
	disable_edit();
}

// when cancel is clicked
function cancel()
{
//	if(confirm("Are you sure you want to cancel this edit?")) 
	if (kbd_hooking)
	{
		disable_edit();
	} 
}

// when home is clicked
function home()
{
	go_to(main_page);
}

function back_or(or_page) {
	if (!go_back())
		set_current(or_page);
}

// when Advanced is clicked
function advanced()
{
	go_to("Special::Advanced");
}

function history_mem(page) {
	if (backstack.length>6)
		backstack = new Array(page);
	else
		backstack.push(page);
}

// follows a link
function go_to(cr)
{
	if(cr == current)
		return;
	history_mem(current);
	forstack = new Array();
	set_current(cr);
}

// when Back button is clicked
function go_back()
{
	if(backstack.length > 0)
	{
		forstack.push(current);
		set_current(backstack.pop());
		return true;
	}
	return false;
}

// when Forward button is clicked
function go_forward()
{
	if(forstack.length > 0)
	{
		history_mem(current);
		set_current(forstack.pop());
	}
}

function js_encode(s, split_lines) {
	// escape double quotes
	s = s.replace(new RegExp("\"", "g"), "\\\"");
	// escape newlines (\r\n happens only on the stupid IE) and eventually split the lines accordingly
	if (!split_lines)
		s = s.replace(new RegExp("\r\n|\n", "g"), "\\n");
	else
		s = s.replace(new RegExp("\r\n|\n", "g"), "\\n\\\n");
	// and fix also the >= 128 ascii chars (to prevent UTF-8 characters corruption)
	return s.replace(new RegExp("([^\u0000-\u007F])", "g"), function(str, $1) {
				var s = $1.charCodeAt(0).toString(16);
				for(var i=4-s.length;i>0;i--) {
					s = "0"+s;
				}
				return "\\u" + s;
	});
}

function printout_arr(arr, split_lines) {

	function elem_print(e) {
		return "\"" + js_encode(e, split_lines) + "\"";
	}

	var s = "";
	for(var i=0;i<arr.length-1;i++) {
		s += elem_print(arr[i]) + ",\n";
	}
	if (arr.length>1)
		s += elem_print(arr[arr.length-1]) + "\n";
	return s;
}

function printout_mixed_arr(arr, split_lines, attrs) {

	function elem_print(e, attr) {
		if (attr & 2) {
			return "[" + printout_num_arr(e) + "]";
		}
		return "\"" + js_encode(e, split_lines) + "\"";
	}

	var s = "";
	for(var i=0;i<arr.length-1;i++) {
		s += elem_print(arr[i], attrs[i]) + ",\n";
	}
	if (arr.length>1)
		s += elem_print(arr[arr.length-1], attrs[arr.length-1]) + "\n";
	return s;
}

// used to print out encrypted pages bytes and attributes
function printout_num_arr(arr) {
	var s = "";
	for(var i=0;i<arr.length-1;i++) {
		s += "0x"+arr[i].toString(16) + ",";
	}
	if (arr.length>1)
		s += "0x"+arr[i].toString(16);
	return s;
}

function save_page(page_to_save) {
	log("Saving page \""+page_to_save+"\"");
	save_to_file(true);
}

function save_options() {
	save_to_file(true);
	set_current("Special::Advanced");
}

function save_to_file(full) {
	document.body.style.cursor = "wait";

	var new_marker;
	if (!debug && full)
		new_marker = _random_string(18);
	else new_marker = __marker;

	var computed_js = "\n/* <![CDATA[ */\n\n/* "+new_marker+"-START */\n\nvar version = \""+version+
	"\";\n\nvar __marker = \""+new_marker+
	"\";\n\nvar permit_edits = "+permit_edits+
	";\n\nvar dblclick_edit = "+dblclick_edit+
	";\n\nvar save_on_quit = "+save_on_quit+
	";\n\nvar allow_diff = "+allow_diff+
	";\n\nvar key_cache = "+key_cache+
	";\n\nvar current = \"" + js_encode(current)+
	"\";\n\nvar main_page = \"" + main_page + "\";\n\n";
	
	computed_js += "var backstack = [\n" + printout_arr(backstack, false) + "];\n\n";

	computed_js += "var page_titles = [\n" + printout_arr(page_titles, false) + "];\n\n";
	
	computed_js += "/* " + new_marker + "-DATA */\n";
	
	if (full) {
	
		computed_js += "var page_attrs = [" + printout_num_arr(page_attrs) + "];\n\n";
		
		computed_js += "var pages = [\n" + printout_mixed_arr(pages, allow_diff, page_attrs) + "];\n\n";
		
		computed_js += "/* " + new_marker + "-END */\n";
	}

	// not needed: the end tag must not be removed by the offset
//	computed_js += "/* ]]> */";

	// cleanup the DOM before saving
	el("wiki_editor").value = "";
	el("wiki_text").innerHTML = "";
	el("menu_area").innerHTML = "";
	if (ie) {	// to prevent their usual UTF-8 corruption
		el("alt_back").innerHTML = "";
		el("alt_forward").innerHTML = "";
		el("alt_cancel").innerHTML = "";
	} else {
//		free_uri_pics(el("img_home"),el("img_back"),el("img_forward"),el("img_edit"),el("img_cancel"),el("img_save"),el("img_advanced"))
	}
	
	// fully remove the first <script> tag
	var offset;
	if (full) {
		offset = document.documentElement.innerHTML.indexOf("/* "+__marker+ "-END */");
		if (offset == -1) {
			alert("END marker not found!");
			return false;
		}			
		offset += 6 + 4 + __marker.length;
	} else {
		offset = document.documentElement.innerHTML.indexOf("/* "+__marker+ "-DATA */");
		if (offset == -1) {
			alert("DATA marker not found!");
			return false;
		}
		offset += 6 + 5 + __marker.length;
	}
		
	if ( (!debug || save_override) )
		r = saveThisFile(computed_js, offset);
	else r = false;
	document.body.style.cursor= "auto";
	
	refresh_menu_area();
	
	if (ie)
		create_alt_buttons();
//	else		setup_uri_pics(el("img_home"),el("img_back"),el("img_forward"),el("img_edit"),el("img_cancel"),el("img_save"),el("img_advanced"))

	if (r)
		cfg_changed = false;

	return r;
}

/*** loadsave.js ***/
// save this file
function saveThisFile(data, offset)
{
/*	if(unsupported_browser)
	{
		alert("This browser is not supported and your changes won't be saved on disk.");
		return false;
	}	*/
	var filename = document.location.toString().split("?")[0];
	filename = filename.replace("file:///", "");
	filename = filename.replace(/\s/g, "_");
	filename = filename.replace(/#.*/g, "");
	if(navigator.appVersion.indexOf("Win")!=-1)
		filename = filename.replace(/\//g, "\\");
	else
		filename = "/" + filename;
	
	r = saveFile(filename,
	"<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\" xml:lang=\"en\">\n<head>\n<script type=\"text/javascript\">" + data + "\n" + document.documentElement.innerHTML.substring(offset) + "</html>");
	if (r==true)
		log("\""+filename+"\" saved successfully");
	else
		alert("Save to file "+filename+" failed!\n\nMaybe your browser is not supported");
	return r;
}

// Copied from TiddyWiki
function saveFile(fileUrl, content)
{
	var r = null;
	r = mozillaSaveFile(fileUrl, content);
	if((r == null) || (r == false))
		r = ieSaveFile(fileUrl, content);
	if((r == null) || (r == false))
		r = operaSaveFile(fileUrl, content);
	return(r);
}

function loadFile(filePath)
{
	var r = null;
	r = mozillaLoadFile(filePath);
	if((r == null) || (r == false))
		r = ieLoadFile(filePath);
	if((r == null) || (r == false))
		r = operaLoadFile(filePath);
	return(r);
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function ieSaveFile(filePath, content)
{
	try
	{
		var fso = new ActiveXObject("Scripting.FileSystemObject");
	}
	catch(e)
	{
		log("Exception while attempting to save\n\n" + e.toString());
		return(false);
	}
	var file = fso.OpenTextFile(filePath,2,-1,0);
	file.Write(content);
	file.Close();
	return(true);
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function ieLoadFile(filePath)
{
	try
	{
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		var file = fso.OpenTextFile(filePath,1);
		var content = file.ReadAll();
		file.Close();
	}
	catch(e)
	{
		alert("Exception while attempting to load\n\n" + e.toString());
		return(null);
	}
	return(content);
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function mozillaLoadFile(filePath)
{
	if(window.Components)
		try
		{
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if (!file.exists())
				return(null);
			var inputStream = Components.classes["@mozilla.org/network/file-input-stream;1"].createInstance(Components.interfaces.nsIFileInputStream);
			inputStream.init(file, 0x01, 00004, null);
			var sInputStream = Components.classes["@mozilla.org/scriptableinputstream;1"].createInstance(Components.interfaces.nsIScriptableInputStream);
			sInputStream.init(inputStream);
			return(sInputStream.read(sInputStream.available()));
		}
		catch(e)
		{
			alert("Exception while attempting to load\n\n" + e);
			return(false);
		}
	return(null);
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function mozillaSaveFile(filePath, content)
{
	if(window.Components)
		try
		{
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if (!file.exists())
				file.create(0, 0664);
			var out = Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);
			out.init(file, 0x20 | 0x02, 00004,null);
			out.write(content, content.length);
			out.flush();
			out.close();
			return(true);
		}
		catch(e)
		{
			alert("Exception while attempting to save\n\n" + e);
			return(false);
		}
	return(null);
}

function operaUrlToFilename(url)
{
	var f = "//localhost";
	if(url.indexOf(f) == 0)
		return url.substring(f.length);
	var i = url.indexOf(":");
	if(i > 0)
		return url.substring(i-1);
	return url;
}

function operaLoadFile(filePath)
{
	var content = [];
	try
	{
		var r = new java.io.BufferedReader(new java.io.FileReader(operaUrlToFilename(filePath)));
		var line;
		while ((line = r.readLine()) != null)
			content.push(new String(line));
		r.close();
	}
	catch(e)
	{
		if(window.opera)
			opera.postError(e);
		return null;
	}
	return content.join("\n");
}

function operaSaveFile(filePath, content)
{
	try
	{
		var s = new java.io.PrintStream(new java.io.FileOutputStream(operaUrlToFilename(filePath)));
		s.print(content);
		s.close();
	}
	catch(e)
	{
		if(window.opera) {
			opera.postError(e);
			return false;
		}
		return null;
	}
	return true;
}
/*** end of loadsave.js ***/

function erase_wiki() {
	if(confirm("This will ERASE all your pages.\n\nAre you sure you want to continue?") == false)
		return false;
	var pg_about = get_text("Special::About");
	var pg_advanced = get_text("Special::Advanced");
	var pg_import = get_text("Special::Import");
	var pg_lock = get_text("Special::Lock");
	var pg_search = get_text("Special::Search");
	var pg_security = get_text("Special::Security");
	page_titles = new Array("Main Page", "Special::Menu", "Special::Advanced", "Special::Import", "Special::Search", "Special::Security", "Special::Lock", "Special::About");
	pages = new Array("This is your empty main page", "[[Main Page]]\n\n[[Special::Advanced]]\n[[Special::Backlinks]]\n[[Special::Search]]", pg_advanced, pg_import, pg_search, pg_security, pg_lock, pg_about);
	current = main_page = "Main Page";
	backstack = new Array();
	forstack = new Array();	
	return true;
}

function import_wiki()
{
	var filename = el("filename_").value;
	if(filename == "")
	{
		alert("A file must be selected");
		return false;
	}

	if(confirm("This will OVERWRITE pages with the same title.\n\nAre you sure you want to continue?") == false)
		return;

	// set hourglass
	document.body.style.cursor= "wait";
	
	var ct = loadFile(filename);
	
	// get version
	var old_version;
	var ver_str = ct.match(/<div .*?id=("version_"|version_).*?>([^<]+)<\/div>/i);
	if (ver_str && ver_str.length>1) {
		ver_str = ver_str[2];
		log("Importing wiki with version string \""+ver_str+"\"");
		switch(ver_str)
		{
			case "0.03":
				old_version = 3;
				break;
			case "0.04": 
			case "0.04G":
				old_version = 4;
				break;
			case "0.9B":
				old_version = 9;
			default:
				alert("Incompatible version: " + ver_str);
				return false;
		}
	} else {
		log("Maybe version 0.02?");
		old_version = 2;
		if(ct.match("<div id=\"?"+escape("Special::Advanced")))
			old_version = 3;
	}
	
	var wiki;
	try {
		wiki = ct.match(/<div .*?id=(wiki|"wiki")[^_\\]*?>((.|\n|\t|\s)*)<\/div>/i)[0];
	} catch(e) {
		alert("Unrecognized file");
		document.body.style.cursor= "auto";
		return false;
	}
	
	// eliminate comments
	wiki = wiki.replace(/\<\!\-\-.*?\-\-\>/g, "");
	
	// separate variables from wiki
	var vars;
	var p = wiki.search(/<div .*?id=("variables"|variables)[^>]*?>/i);
	if (p!=-1) {
		vars = wiki.substring(p);
		wiki = wiki.substring(0, p);
	} else
		vars = "";
		
	if(old_version == 2)
	{
		try {
			vars = wiki.match(/\<div .*?id=("main_page"|main_page)>(.*?)\<\/div\>/i)[1];
		} catch(e) {
			log("No variables found");
		}
	}

	// get an array of variables and wikis
	var var_names = new Array();
	var var_values = new Array();
	var vc = 0;
	var page_names = new Array();
	var page_contents = new Array();
	var pc = 0;

	// eliminate headers
	wiki = wiki.substring(wiki.indexOf(">")+1);
	vars = vars.substring(vars.indexOf(">")+1);
	
	vars.replace(/<div id="?(version_|main_page_|permit_edits_|[\w_]+)"?>((\n|.)*?)<\/div>/gi, function(str, $1, $2)
			{
				if(old_version == 2)
					var_names[vc] = "main_page_";
				else
					var_names[vc] = $1;
				var_values[vc] = $2;
				vc++;
			});
			
	log("Variables are ("+var_names+")");

	// now extract the pages
	wiki.replace(/<div .*?id="?([^">]+)"?>((\n|.)*?)<\/div>/gi, function(str, $1, $2, $3)
			{
				log("Parsing old page "+$1);
				if (old_version != 2) {
					page_names[pc] = unescape($1);
					page_contents[pc] = unescape($2);
				} else {
					page_names[pc] = $1;
					page_contents[pc] = $2;
				}
				// dismiss special pages
				if (page_names[pc].indexOf("Special::")==0) {
					if (page_names[pc] == "Special::Edit Menu")
						page_names[pc] = "Special::Menu";
					else return;
				}

				if (old_version < 9) {	// apply compatibility changes to stickwiki versions below v0.9
					page_contents[pc] = _new_syntax_patch(page_contents[pc].replace(new RegExp("(\\[\\[|\\|)Special::Import wiki\\]\\]", "ig"), "$1Special::Import]]").replace(/\[\[([^\]\]]*?)(\|([^\]\]]+))?\]\]/g,
					function (str, $1, $2, $3) {
						if ($3.length)
							return "[["+$3+"|"+$1+"]]";
						else
							return str;
					}));
				}
				pc++;
			}
			);

	log("page_names is ("+page_names+")");

	// add new data
	var pages_imported = 0;
	
	if (old_version==9) {
		var css = null;
		ct.replace(/<style\s.*?type="?text\/css"?[^>]*>((\n|.)*?)<\/style>/i, function (str, $1) {
			css = $1;
		});
		if (css!=null) {
			log("Imported "+css.length+" bytes of CSS");
			document.getElementsByTagName("style")[0].innerHTML = css;
		}
	}
	
	// import the variables
	var new_main_page = main_page;
	var old_block_edits = !permit_edits;
	for(var i=0;i<var_names.length;i++) {
		if (var_names[i] == "main_page_")
			new_main_page = (version!=2) ? unescape(var_values[i]) : var_values[i];
		else if (var_names[i] == "permit_edits")
			old_block_edits = (var_values[i]=="0");
	}
	if (page_exists(new_main_page))
		main_page = new_main_page;
		
	permit_edits = !old_block_edits;
	
	//note: before v0.04 permit_edits didnt exist
	//note: in version 2 pages were not escaped
	
	for(var i=0; i<page_names.length; i++)
	{
		if ( !is_reserved(page_names[i]) || (page_names[i] == "Special::Menu") )
		{
			pi = page_index(page_names[i]);
			if (pi == -1) {
				page_titles.push(page_names[i]);
				pages.push(page_contents[i]);
				page_attrs.push(0);
			} else {
				page_titles[pi] = page_names[i];
				pages[pi] = page_contents[i];
				page_attrs[pi] = 0;
			}
			pages_imported++;
		}
	}

	// remove hourglass
	document.body.style.cursor= "auto";
	
	alert("Import completed: " + pages_imported + " pages imported.");
	
	current = main_page;
	// save everything
	save_to_file(true);
	
	set_current(main_page);
}

function open_table_help()
{
	w = window.open("about:blank", "help", "height=200px, width=350px, menubar=no, toolbar=no, location=no, status=no, dialog=yes");
	w.document.writeln("<html><head><title>Building tables<\/title><\/head><body>");
	w.document.writeln("<u>Building tables:<\/u><br /><br />");
	w.document.writeln("<tt>{|   <\/tt><br />");
	w.document.writeln("<tt>|+ Table Caption<\/tt><br />");
	w.document.writeln("<tt>| *colum 1* || *column 2* || *column 3*<\/tt><br />");
	w.document.writeln("<tt>|-<\/tt><br />");
	w.document.writeln("<tt>| line 2 || [[a link]] || something<\/tt><br />");
	w.document.writeln("<tt>|-<\/tt><br />");
	w.document.writeln("<tt>| line 3 || || more stuff<\/tt><br />");
	w.document.writeln("<tt>|}   <\/tt>");
	w.document.writeln("<\/body><\/html>");
	w.document.close();
}

/* if((navigator.userAgent).indexOf("Opera")!=-1)
	opera = true;
else */ if(navigator.appName == "Netscape")
	firefox = true;
else if((navigator.appName).indexOf("Microsoft")!=-1)
	ie = true;

// finds out if Opera is trying to look like Mozilla
if(firefox == true && navigator.product != "Gecko")
	firefox = false;

// finds out if Opera is trying to look like IE
if(ie == true && navigator.userAgent.indexOf("Opera") != -1)
	ie = false;

if (debug) {
	// logging function - used in development

	function log(aMessage)
	{
	    var logbox = document.getElementById("swlogger");
		nls = logbox.value.match(new RegExp("\n", "g"));
		if (nls!=null && typeof(nls)=='object' && nls.length>11)
			logbox.value = "";
		logbox.value += aMessage + "\n";
	}
} else {
	function log(aMessage) { }
}

if (!ie)
	window.onresize = on_resize;

// function used to store encrypted pages into javascript strings
function js_hex_encode(s) {
	// escape double quotes
	s = s.replace(new RegExp("\"", "g"), "\\\"");
	// escape newlines (\r\n happens only on the stupid IE) and eventually split the lines accordingly
	s = s.replace(new RegExp("\r\n|\n", "g"), "\\n");
	// and fix also the >= 128 ascii chars (to prevent UTF-8 characters corruption)
	return s.replace(new RegExp("([^\u0000-\u007F])", "g"), function(str, $1) {
				var s = $1.charCodeAt(0).toString(16);
				for(var i=2-s.length;i>0;i--) {
					s = "0"+s;
				}
				return "\\x" + s;
	});
}
	
/*** aes.js ***/

// AES encryption for StickWiki
// adapted by legolas558
// license: GNU/GPL
// original code from http://home.versatel.nl/MAvanEverdingen/Code/
// this is a javascript conversion of a C implementation by Mike Scott

var bData;
var sData;
var aes_i;
var aes_j;
var tot;
var key = [];
var lenInd = true;	// length indicator (to remove padding bytes)

var wMax = 0xFFFFFFFF;
function rotb(b,n){ return ( b<<n | b>>>( 8-n) ) & 0xFF; }
function rotw(w,n){ return ( w<<n | w>>>(32-n) ) & wMax; }
function getW(a,i){ return a[i]|a[i+1]<<8|a[i+2]<<16|a[i+3]<<24; }
function setW(a,i,w){ a.splice(i,4,w&0xFF,(w>>>8)&0xFF,(w>>>16)&0xFF,(w>>>24)&0xFF); }
function setWInv(a,i,w){ a.splice(i,4,(w>>>24)&0xFF,(w>>>16)&0xFF,(w>>>8)&0xFF,w&0xFF); }
function getB(x,n){ return (x>>>(n*8))&0xFF; }

function getNrBits(i){ var n=0; while (i>0){ n++; i>>>=1; } return n; }
function getMask(n){ return (1<<n)-1; }

function getLen(bits){
  var n = (bits+7)>>>3;
  var r=0;
  for (var i=0; i<n; i++) r += bData.shift()<<(i*8);
  return r&getMask(bits);
}

var bMax=0xFFFF;
var bMaxBits=getNrBits(bMax);

function bGetNrBits(a){ return (a.length-1)*bMaxBits+getNrBits(a[a.length-1]); }

function insLen(len, bits){
  var n=(bits+7)>>>3;
  while (bits<n*8){ len=((len&0xFF)<<bits)|len; bits*=2; }
  while (n-->0) bData.unshift( (len>>>(n*8))&0xFF );
}

var utf8sets = [0x800,0x10000,0x110000];

function unExpChar(c){
  return "unexpected character '"+String.fromCharCode(c)+"' (code 0x"+c.toString(16)+").";
}

function utf8Encrypt(){
  if (aes_i==0) { /* prgr='UTF-8'; */ bData=[]; tot=sData.length; aes_j=0; }
  var z = Math.min(aes_i+100,tot);
  var c = 0;
  var k = 0;
  while (aes_i<z) {
    c = sData.charCodeAt(aes_i++);
    if (c<0x80){ bData[aes_j++]=c; continue; }
    k=0; while(k<utf8sets.length && c>=utf8sets[k]) k++;
    if (k>=utf8sets.length) throw( "UTF-8: "+unExpChar(c) );
    for (var n=aes_j+k+1;n>aes_j;n--){ bData[n]=0x80|(c&0x3F); c>>>=6; }
    bData[aes_j]=c+((0xFF<<(6-k))&0xFF);
    aes_j += k+2;
  }
}

function utf8Decrypt(){
  if (aes_i==0){ /* prgr='UTF-8'; */ sData=""; tot=bData.length; }
  var z=Math.min(aes_i+100,tot);
  var c = 0;
  var e = "";
  var k = 0;
  var d = 0;
  while (aes_i<z){
    c = bData[aes_i++];
    e = '0x'+c.toString(16);
    k=0; while(c&0x80){ c=(c<<1)&0xFF; k++; }
    c >>= k;
    if (k==1||k>4) {
//		throw
		log('UTF-8: invalid first byte '+e+'.');
		sData = null;
		aes_i=tot;
		return;
	}
    for (var n=1;n<k;n++){
      d = bData[aes_i++];
      e+=',0x'+d.toString(16);
      if (d<0x80||d>0xBF) break;
      c=(c<<6)+(d&0x3F);
    }
    if ( (k==2&&c<0x80) || (k>2&&c<utf8sets[k-3]) ) {
//		throw
		log("UTF-8: invalid sequence "+e+'.');
		sData = null;
		aes_i=tot;
		return;
	}
    sData+=String.fromCharCode(c);
  }
}

var aesNk;
var aesNr;

var aesPows;
var aesLogs;
var aesSBox;
var aesSBoxInv;
var aesRco;
var aesFtable;
var aesRtable;
var aesFi;
var aesRi;
var aesFkey;
var aesRkey;

function aesMult(x, y){ return (x&&y) ? aesPows[(aesLogs[x]+aesLogs[y])%255]:0; }

function aesPackBlock() {
  return [ getW(bData,aes_i), getW(bData,aes_i+4), getW(bData,aes_i+8), getW(bData,aes_i+12) ];
}

function aesUnpackBlock(packed){
  for ( var mj=0; mj<4; mj++,aes_i+=4) setW( bData, aes_i, packed[mj] );
}

function aesXTime(p){
  p <<= 1;
  return p&0x100 ? p^0x11B : p;
}

function aesSubByte(w){
  return aesSBox[getB(w,0)] | aesSBox[getB(w,1)]<<8 | aesSBox[getB(w,2)]<<16 | aesSBox[getB(w,3)]<<24;
}

function aesProduct(w1,w2){
  return aesMult(getB(w1,0),getB(w2,0)) ^ aesMult(getB(w1,1),getB(w2,1))
       ^ aesMult(getB(w1,2),getB(w2,2)) ^ aesMult(getB(w1,3),getB(w2,3));
}

function aesInvMixCol(x){
  return aesProduct(0x090d0b0e,x)     | aesProduct(0x0d0b0e09,x)<<8 |
         aesProduct(0x0b0e090d,x)<<16 | aesProduct(0x0e090d0b,x)<<24;
}

function aesByteSub(x){
  var y=aesPows[255-aesLogs[x]];
  x=y;  x=rotb(x,1);
  y^=x; x=rotb(x,1);
  y^=x; x=rotb(x,1);
  y^=x; x=rotb(x,1);
  return x^y^0x63;
}

function aesGenTables(){
  var i,y;
  aesPows = [ 1,3 ];
  aesLogs = [ 0,0,null,1 ];
  aesSBox = new Array(256);
  aesSBoxInv = new Array(256);
  aesFtable = new Array(256);
  aesRtable = new Array(256);
  aesRco = new Array(30);

  for ( i=2; i<256; i++){
    aesPows[i]=aesPows[i-1]^aesXTime( aesPows[i-1] );
    aesLogs[aesPows[i]]=i;
  }

  aesSBox[0]=0x63;
  aesSBoxInv[0x63]=0;
  for ( i=1; i<256; i++){
    y=aesByteSub(i);
    aesSBox[i]=y; aesSBoxInv[y]=i;
  }

  for (i=0,y=1; i<30; i++){ aesRco[i]=y; y=aesXTime(y); }

  for ( i=0; i<256; i++){
    y = aesSBox[i];
    aesFtable[i] = aesXTime(y) | y<<8 | y<<16 | (y^aesXTime(y))<<24;
    y = aesSBoxInv[i];
    aesRtable[i]= aesMult(14,y) | aesMult(9,y)<<8 |
                  aesMult(13,y)<<16 | aesMult(11,y)<<24;
  }
}

function aesInit(){
  key=key.slice(0,32);
  var i,k,m;
  var j = 0;
  var l = key.length;

  while ( l!=16 && l!=24 && l!=32 ) key[l++]=key[j++];
  aesGenTables();

  aesNk = key.length >>> 2;
  aesNr = 6 + aesNk;

  var N=4*(aesNr+1);
  
  aesFi = new Array(12);
  aesRi = new Array(12);
  aesFkey = new Array(N);
  aesRkey = new Array(N);

  for (m=j=0;j<4;j++,m+=3){
    aesFi[m]=(j+1)%4;
    aesFi[m+1]=(j+2)%4;
    aesFi[m+2]=(j+3)%4;
    aesRi[m]=(4+j-1)%4;
    aesRi[m+1]=(4+j-2)%4;
    aesRi[m+2]=(4+j-3)%4;
  }

  for (i=j=0;i<aesNk;i++,j+=4) aesFkey[i]=getW(key,j);

  for (k=0,j=aesNk;j<N;j+=aesNk,k++){
    aesFkey[j]=aesFkey[j-aesNk]^aesSubByte(rotw(aesFkey[j-1], 24))^aesRco[k];
    if (aesNk<=6)
      for (i=1;i<aesNk && (i+j)<N;i++) aesFkey[i+j]=aesFkey[i+j-aesNk]^aesFkey[i+j-1];
    else{
      for (i=1;i<4 &&(i+j)<N;i++) aesFkey[i+j]=aesFkey[i+j-aesNk]^aesFkey[i+j-1];
      if ((j+4)<N) aesFkey[j+4]=aesFkey[j+4-aesNk]^aesSubByte(aesFkey[j+3]);
      for (i=5;i<aesNk && (i+j)<N;i++) aesFkey[i+j]=aesFkey[i+j-aesNk]^aesFkey[i+j-1];
    }
  }

  for (j=0;j<4;j++) aesRkey[j+N-4]=aesFkey[j];
  for (i=4;i<N-4;i+=4){
    k=N-4-i;
    for (j=0;j<4;j++) aesRkey[k+j]=aesInvMixCol(aesFkey[i+j]);
  }
  for (j=N-4;j<N;j++) aesRkey[j-N+4]=aesFkey[j];
}

function aesClose(){
  aesPows=aesLogs=aesSBox=aesSBoxInv=aesRco=null;
  aesFtable=aesRtable=aesFi=aesRi=aesFkey=aesRkey=null;
}

function aesRounds( block, key, table, inc, box ){
  var tmp = new Array( 4 );
  var i,j,m,r;

  for ( r=0; r<4; r++ ) block[r]^=key[r];
  for ( i=1; i<aesNr; i++ ){
    for (j=m=0;j<4;j++,m+=3){
      tmp[j]=key[r++]^table[block[j]&0xFF]^
             rotw(table[(block[inc[m]]>>>8)&0xFF], 8)^
             rotw(table[(block[inc[m+1]]>>>16)&0xFF], 16)^
             rotw(table[(block[inc[m+2]]>>>24)&0xFF], 24);
    }
    var t=block; block=tmp; tmp=t;
  }

  for (j=m=0;j<4;j++,m+=3)
    tmp[j]=key[r++]^box[block[j]&0xFF]^
           rotw(box[(block[inc[m  ]]>>> 8)&0xFF], 8)^
           rotw(box[(block[inc[m+1]]>>>16)&0xFF],16)^
           rotw(box[(block[inc[m+2]]>>>24)&0xFF],24);
  return tmp;
}

function aesEncrypt(){
  aesUnpackBlock( aesRounds(aesPackBlock(), aesFkey, aesFtable, aesFi, aesSBox ) );
}

function aesDecrypt(){
  aesUnpackBlock( aesRounds(aesPackBlock(), aesRkey, aesRtable, aesRi, aesSBoxInv ) );
}

// Blockcipher

function blcEncrypt(enc){
  if (tot==0){
//    prgr = name;
    if (key.length<1) return;
    if (lenInd) insLen( bData.length%16, 4 );
    //if (cbc)
	for (aes_i=0; aes_i<16; aes_i++) bData.unshift( Math.floor(Math.random()*256) );
    while( bData.length%16!=0 ) bData.push(0);
    tot = bData.length;
    aesInit();
  }else{
    //if (cbc)
	for (aes_j=aes_i; aes_j<aes_i+16; aes_j++) bData[aes_j] ^= bData[aes_j-16];
    enc();
  }
  if (aes_i>=tot) aesClose();
}

function blcDecrypt(dec){
  if (tot==0){
//    prgr = name;
    if (key.length<1) return;
    //if (cbc)
	{ aes_i=16; }
    tot = bData.length;
    if ( (tot%16) || tot<aes_i ) throw 'AES: Incorrect length (tot='+tot+', aes_i='+aes_i+')';
    aesInit();
  }else{
    //if (cbc)
	aes_i=tot-aes_i;
    dec();
    //if (cbc)
	{
      for (aes_j=aes_i-16; aes_j<aes_i; aes_j++) bData[aes_j] ^= bData[aes_j-16];
      aes_i = tot+32-aes_i;
    }
  }
  if (aes_i>=tot){
    aesClose();
    //if (cbc)
	bData.splice(0,16);
    if (lenInd){
      var ol = bData.length;
      var k = getLen(getNrBits(15));
      while((k+ol-bData.length)%16!=0) bData.pop();
    }
    else{
      while(bData[bData.length-1]==0) bData.pop();
    }
  }
}

// sets global key to the utf-8 encoded key
function AES_setKey(sKey) {
  sData=sKey;
  aes_i=tot=0;
  do{ utf8Encrypt(); } while (aes_i<tot);
  sData = null;
  key = bData;
  bData = null;
}

function AES_clearKey() {
	key = [];
}

// sets global bData to the utf-8 encoded binary data extracted from d
function setData(d) {
	sData = d;
	aes_i=tot=0;
	do{ utf8Encrypt(); } while (aes_i<tot);
	sData = null;
}

var _magic_check = false;

// returns an array of encrypted characters
function AES_encrypt(raw_data) {
	setData(raw_data);

	if (_magic_check) {
		// save 2 random characters for decryption control
		var magic_pos = _rand( Math.max(0, bData.length-2));
		var magic_len = 2 + _rand(4);
		bData.push(0);
		for(a=0;a<magic_len;a++)
			bData.push(bData[magic_pos+a]);

		setW(bData, bData.length, magic_pos);
		setW(bData, bData.length, magic_len);
	}
	
	aes_i=tot=0;
	do{ blcEncrypt(aesEncrypt); } while (aes_i<tot);

	return bData;
}

// decrypts an array of encrypted characters
// returns null if magic check fails
function AES_decrypt(raw_data) {
	bData = raw_data;
	
	aes_i=tot=0;
	do{ blcDecrypt(aesDecrypt); } while (aes_i<tot);
	
	if (_magic_check) {
		// check if the magic characters were saved
		if (bData.length < 10)
			return null;
		var magic_pos = getW(bData.length-8);
		var magic_len = getW(bData.length-4);
		if ((magic_pos >= bData.length - 9) ||
			(magic_pos + magic_len >= bData.length - 9))
			return null;
		for(a=0;a<magic_len;a++)
			if (bData[magic_pos+a] != bData[bData.length-8-magic_len+a])
				return null;
				
		bData.splice(bData.length-8 - magic_len, 8 + magic_len + 1);
	}
	
	aes_i=tot=0;
	do{ utf8Decrypt(); } while (aes_i<tot);
	
	return sData;
}

/* ]]> */
</script></head><body class="bg" id="body" style="cursor: wait;" onload="on_load()" onunload="before_quit()">
<div class="wiki_header bg" id="sw_wiki_header" style="position: absolute;">
<table cellspacing="0" width="100%">
<tbody>
<tr>
<td width="80%"><span class="title" id="wiki_title">Editing Main Page</span></td>
<td align="right" width="20%">
<div id="menu_back" style="display: none; cursor: pointer;" onclick="go_back()"><img id="img_back" style="display: inline;" alt="Back" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABGdBTUEAAK/INwWK6QAAAAZiS0dEAP8A/wD/oL2nkwAABexJREFUeNp9lWuMlkcVx39n5nned9+9sO6yLCy3XSg1LAVES2Itoi1YoynGJtbGhDQa+8VUqyFqtI0aYiQWEz/VSzTapImJmlY/tIENASzQ7SVtdVfcpiqUTYGyyy6yu+x7eZ5nLscP70u6UeMkk5kzk/P/zzkzc/7Cfzdp9dgyho3hboFtCv2t9WlVxqLyPDDZ8rOtPeX/NNMCR+Bea3geyFtOccl4c14zhmeBXf/pv/S0S8Ej0G+EXyvsUyX2dIrs3mLj9iGjvcuQwsPF2ah/Phdl7EI0hQcRBOVJhUeAegtXlxLcBN9sDCMxMrS8C/foZ0vy+T2p7VsuoogSjAQfNfeBhZoycTHwq2M+/OHFSFQSEV5X5V5g5iaJLGFbaw2jITL44WHjfvdoR7JmqF1i3Wp0KibWcdkCDZ+ShTK5C6ioiiAjrwd97Cnn5qqURHhVlT1A7ebFNEMQno7K7Xdvte7Y4a60d3kvRb5CSPskKZeZb1RY6N5HR+qxxRTRlMiLKDfqqreuEd6/ySQnx2ORFayn+RieA4xt5elBhW+s7hU3cqiS9r6nS13ol6RjAFtZzuyNNm4MfY+VOw9g+j8KV0fw2XUiCarIfA1ZvRwd6MWeGNcI7AROA5MGEBG+CnBwf8msGbDq8rLYchemrYeZah/1Dd9lw7aPkbgZbMcgptyLISAiiEAphbkq7N5qZM/7RFsZ+VpzFO6Kys4NK0XvvzMxsapYazDGM3u9oLH2IQY330FwOVoZwJw7BPPjkC4DERALGIwgzqOf+mAzK1HZC2wyRrgHYO8OG3s6hcwhhgVmr1Wpr32YwffuJIYcY8skfzsAE48TvCdm84SsSshqhKKBCGQFsmGVsL6fAHSJsDsBdgBsHzK4IBA9s/NlasPfZ3B4FyGbw5S7WZweo/GvKnHVl3HOU3hP4Rw+CKY6Sbg8ig+WcgqDK4SLM4rAjkSVlQC9nUjhReq1BgsbD7Jhy1587SpiK8R8gfaeW2jb9QSEAo0FMWREX6AxQzRw7uS3mTt7lLb2Et2d4eY3Xp3c/Gw+Qu4juYfuSkGMnhgcRiwKiClj8CgF4BANGAlEdaSlLpKOAZyHNIrou9VIEhGuoTA9p1q4oAVtYv9+mKx7HeW1+4jFdSTtwl09Q3H1DJp0412ODxEfAj5CY3GWS2efAWvIXdC5xRa8MpMAE8A9f52M5F7JnIDmuNEv0X3nz2hb+wlCPo9UVlO9dIrFS2MEK+ROyRxkBWQOCixRDfWGcnFWW/hMmKicBHjhjSDTcxEXotZ9Sr2IXD39MLW3j4BpI9pOeu76Dcm6j9Dw4Gwn3lYISRsxKVN4AVGdnFIuX8MCmSpnjConjfDm5WuYI68FTRJYbHga3lIvApf+9BUWL44gRohukZUfOgTt66nVqmRFICs8eRHInKLAiTFt6ojwIjBhWky/APj5kRAuTEcBdLHuaThLLQ+cP36AucljpOVl2KSdgg4aeTM1uYNqppRT9LV/qLz0ZvOKVfnJ0nJdEuFlVT6wY6P4w19MknKCZgWSJAaNHqTEytseoL7wDtPnThBIKJzScFApoW9NqRx+OrrFOinwLPDpZiDvasF2I7wQlWVbh8R/836TrOsTrefgg0iMSpH5po7aBB8UETSxyF/OK78ciW6hRirCpCq7gClahUSlSTJ9+ybzCvCZt6a0cvosznmhrxtpLyvWCjZNxSQWIaqPyOVryjOjGn9/WkMjJ13Vw6VKiU/WcyZbB9elkmnHn2gPpcTcdt8Pst/+8x2/DYjL2oUtgzauX6HS2RbFR7i+iF6YUj1/BVP4ppwMr5NTP/yC3X98PF756XPRGCFGBaxpot+1zeL+2Gnc0S7qR9eXHn9o4JFV/T3n/4fQL7XjLQNy9jufS/a/9OOSnPlRKk993ZqOtiWin5hmmXjsgZRDD5a5URfT1Q4L3ffFfOPBysuvvLrn+MlTH58YG906N/VGH2Jib6fMDK+T8Ts2m5Gdt5rRUqr+ynU11YaqiOq3ngxMvK0YgX8Db1YRHvYQ7IQAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAAAAElFTkSuQmCC"><span id="alt_back" style="display: none; font-size: 24pt; font-family: wingdings;"></span></div>
<div id="menu_forward" style="display: none; cursor: pointer;" onclick="go_forward()"><img id="img_forward" style="display: inline;" alt="Forward" src="data:image/png;base64,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"><span id="alt_forward" style="display: none; font-size: 24pt; font-family: wingdings;"></span></div>
<div id="menu_advanced" style="display: none; cursor: pointer;" onclick="advanced()"><img id="img_advanced" style="display: inline;" alt="Advanced" src="data:image/png;base64,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"><span id="alt_advanced" style="display: none; font-size: 24pt; font-family: wingdings;">:</span></div>
<div id="menu_home" style="display: none; cursor: pointer;" onclick="home()"><img id="img_home" style="display: inline;" alt="Home" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABGdBTUEAAK/INwWK6QAAAAZiS0dEAP8A/wD/oL2nkwAABbdJREFUeNp9lVuMVlcVx39rn/N9c7/fmKHMwBTFQaDQIRptIQNUU1ONbaxNE2IxxhcT2xBrNOXBNxpJ0yejiQk16UPTVsWYkpY0zggtEBtrZbQzVIsyOOUyzAwzzO27nLP3Wj58Z+hEjTs5Z+19Ttb/v9fae62/8N9DskezxYBz7BPYbtCZfZ8y44Iap4GJzC/K/hn/Z7gMHIGHIsdpoJw56Rq7Ol9xjteA+/7Tf+1u14Ir0OmEFwy+bIa21Ivs2Rrpjo3OWhuRxMPkjNp7l1QuXFaXeBBBMH5h8CRQyHBtLcEq+Kec45QqG9saSJ/5el4O7c9F7W0ihphoJN6rlVPPwooxNhk4/mYIJ84H1IhF+JMZDwHTqySyhu2uyHEuKH33D7j0lWfq4vUba0ULkVmKiC5RLixRDhElq6WcGggmovLGu6kdeTFN55fJi/BHM/YDK6sHUwlB+JUag/u2RembxxpyrW2tJKUOkapOiWKYSzoobvguNVUx0eJFzJTCckluL3v75IaYXZtdPDKqSSmhl8plOAm4KMvTNwy+39Mq6amjNbnW5gZLQpfkG3tQy3NdB4nueZ72gYdx3Q/jfZH5pBG36RC5hrvk9o33pbtVrLtVouFRVWA38BYwEQHihOMGPc9/u4qh3TlJkmbJ1zWzktQz3fA4bYPfo7m5BS3PA4Goa4jaDQ/QdvcDVNd3svDhSywUoL8buXLTdOImzgnNBq86EYbU2L2pS+zRz8cuFBx5WWRmsZrbPYdZf+9BavNGSMsgOVBFQoFcDKEwTUgWCUkZJyapF/vKZytZUeMAsNk54QsAB+6JtKUhorSyIFf9IOz6Geu37EX8MiGkgGEWsKyOzMA0Jd/0CVp3HUaDUiyrbFon9HYQgAYR9jhgJ8CO/hyhvMT16kdo2PsSHR2d+OItTAOoxzQF9WABMwWzzCrdg0/Rf+A5ggn5nNHXJatFttOZ0QXQWi9SKJnUt/XR0NhMUl7BTDFNsJBgmmLmK4QWMAtgiqqHUKa1bw+Sa0RDoKlOVsu4505p++BJpAY3eZzbpx+jtHSz0pBWwTXF1GPmUQ2YelQ9Lq5i9tJJRk88QXF5DiUnZnfakTgRZgGm5s3SgBVLKQsf/pri0hQi9vHu15JoimUkzkXcunKemSsfoJIn8WrzSxm8Me2AMYC/TChlbxRTKFGLqaIhQTVFNcVCioaKrUQSMMvSFuXQCIIay0WYnMkuAow5NUYAzo4HmZo30mBWLHuCTyoEPkF9uTLPSCqESRaNJ009pTKIYJdvGFdniYCSGW87M0ac8MHVWdzr7wbLxbBUUnDxnThtzRvJOnV2jpFEqMUUk0pDG75gFR0RzgNjEeCBGHjw4qT6vdvjqDZOzeWbpL59M768iPkC6guEtID6IiEtEJICmpYorcww/s7LkM7ae5eQX55Vzbrz08DfVtt1XoQ/mHHvzn7xx74VxXln5qMmiSOHYBWVUQgGIRhpgDQIKyslYgp2ZUbkx69qulQkB7wGfLUSyMdasMMJZ9Vo3LZR/A8ejeP1bd4KJSMNiFlGoOAVQqjkPI5FRi87fv5GSBdWyIkwYcZ9wA1AokwUHDA1uNm9A3ztnzes5sz7kqbB0dHkpK7aEUUOcU6cc7jIWTCRa7ccJ86LvnJGQ7FMbl0LH9Xk+VKhzES2cVsrmdHoT2pDPnaffuRo8vLfrybbAW2sFbb2Oe3tQOprEB9gbgmbmMIuXVOXeANwW3vdmWcPuYO/G9XrPz2pzgmqBkSugj60PSL5TYMLp2qZPbEuf+Spx5/c1H/3P/6H0K9d68DAlr/+6Js9B88dQ95+Li8vPh25uuo1oh+7Sk6PPJbn6BM5rs/lnN/yLL2f+Y4uzt+sGR4e2T888vsvjo+Pb5ubn28XEW1va5nesW1g9MDQ507tG7r/XJV+5P/828Nu5tpFc3HOfviCZ+xfhhP4N5gwShkDZas3AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg=="><span id="alt_home" style="display: none; font-size: 24pt; font-family: wingdings;">G</span></div>
<div id="menu_edit" style="display: none; cursor: pointer;" onclick="edit()"><img id="img_edit" style="display: inline;" alt="Edit" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABGdBTUEAAK/INwWK6QAAAAZiS0dEAP8A/wD/oL2nkwAABSVJREFUeNqVlX9oXFUWxz/3vvfmR6aZyZB0YqKhlTUIldK0ILgisv6s9Rdrq1Y32P4hRcXUij/YNuLSFP3H+ttqtFiwTVfRrtbowhpo1iK7BbWg0qildfwRMzGTkNTxdd5kZt67Z//YmWnSpIoXDvdxL+98z/l+zzlXcWqFgAuBGGD4fUu01kPGmCxgAUH1QlVMgL3hcLgzGo0GIqIr56c8iMzrGMD3feV5Xk5rfZcx5k3ABvwqAEqplIik9+3bt2DlypUml8spy7JqTn9tFxEcx5GdO3eqnp4epbVeb4zZA2jA2JVINEBLSwuO46C1BsC27dq3Umpeq9yprVu3mnA4THd3926llIhIH1D5uwJijKFYLKogCFQ8HldKKVUsFpXv+yoIglnm+37t3Pd9JicnrS1btqienh5E5CWl1DmA0aeT6jgO+Xyevr4+RkdHicfjBEFAoVCgVCrNa+VyWWmtxfM8vWHDBj8ejy8QkXalFPZM50EQUFdXx+DgIF1dXbS2trJmzRrWrl1Lc3Mz4+PjGGOwbbtGW3Vva2tTlmVJoVBQFVpVjftaSSmF7/ssW7aM1tZW2s45m97eXjo7O3n22eewbZtEIk65XK4JPFP0qi4zK24OQKFQYPny5axYsYJ0Os2mTRt5/59vMzr6LTfccCMff3KYC5YsYeHChbS0tNTMcZzTy1nNdHwWkD948KC4rmvy+bzs3r1HOjouEGPyEgRGRET+PbhXzmpeIIcOfSwiRnK5nOTzefE8T1zXlWKxaNLptJ9IJAS4QinFHJEty8J1Xa6++iq0DvHFF5+idZGCd5LLLl/L80+sYt0dnfz8cw6lqIpcY+D0hpwFICI1HYLAZ+nSDvr6/g5EcCILmMh8yepVi7juyhC33LqekyddhoeHGRkZwff9Ws+cEaAahWVZnDhxgtWrb+If+97nyKHtlCYPkD78FIf/c4zt267BnfwvL+zYRTKZwPO8eQWeNwMArTWRSJSLL76Irvs2s/q2R5g4upOIU2C6pPnu6Div7/ozr+16iuPffE97+3mzOvs3KVJKkUqlsG2Hhx/axOXXb+TOv37I4rZGImGL0ZFfaIg4PP34RWzs2kQkEiUSCc87EOelqKqDMYapqSlefnE7pdAKHn1ikPP/0Igdsjjy+U+suXYJl1zosW79PYRC4VpvnLEPZmYwNjZGJpMhk8lw7NhxXtrxJPsP+rz13hDti5Og4LNPfuSZx1aRPtrPq7v2YFkWQRD8egbVVS6XKRaL+L6P67o4jkNv7w42P3mEr45N0NYaJ/dLkYmMy/33LueDf31QCdKcGaCagdaaZDJJU1MTjY2NpFIpHCfEZX+6lGeef4V1DxzAGKH93EakLPS/8yWLFi+q+Jgd6JxhFwQBxhiSyeSc2e/7AevvuJ10+juuW/c3tj34R/oHjjP0Q4revgdPJ0FmAijA1NfXEwqFTENDg7Isaw5tVQG3be0mtbCRNw4coL7xPD56bTtNTU0ANDQ0yMyGqwKUgGD//v0MDw+rfD6vbdtGKUWpVKqlrtT/34vp6WmaU0n+ctvNCEJ//7tMT08TiURkYmJCe54HUBCRWY/+5mg0ep9SqqSUUuVyGSOGumgUYwQQjAnwvGnq6+OUy6VTQmpdHRNijIl4nvcucPes2gcYGBgIZ7PZWCaTqRsYGIh1dCyNjY+nY647FZs6MRHz8l/Hrrliceyhh7tjnpePjYyMxMbGxmLZbDaWzWZjU1NTsaGhoWgikaj5/R958KLgEIeBwgAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAAASUVORK5CYII="><span id="alt_edit" style="display: none; font-size: 24pt; font-family: wingdings;">!</span></div>
<div id="menu_cancel" style="display: inline; cursor: pointer;" onclick="cancel()"><img id="img_cancel" style="display: inline;" alt="Cancel" src="data:image/png;base64,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"><span id="alt_cancel" style="display: none; font-size: 24pt; font-family: wingdings;"></span></div>
<div id="menu_save" style="display: inline; cursor: pointer;" onclick="save()"><img id="img_save" style="display: inline;" alt="Save" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABGdBTUEAAK/INwWK6QAAAAZiS0dEAP8A/wD/oL2nkwAAA0FJREFUeNq1lc+KHFUUxn/n3qqu6h7tGdPByTBOEjQunK26EQRdhAGRuHGE2agLH8C1j5AXCFnkAYyBEIKoRHeabWQyJKIm+IdAdwSd0HZPdVXdc1xU9UynbZIe/xy4XG5R93z3fN937hWqeALYqGcFhH8WBkTAD8DXTCS64n18Jo6ToFo4792hAEQEVUUVc87baDR0ZvYBcEFAngO7eeatD5vHjq2XKysDee/dNxkOc9zcOIJzgXPnrhD0mfDVl+cbt29f/0zEvREBHqD9ZIckWfCdIwnLy8v0+3t47x7PiRkAcexoLy6SZW1arTaAQyq+ACSEAtVAURQyGo3I8/krMANVoSxLQigtaKjKsgkAREAEmRjOzVeBCDgnCPXecU7g8Rn+ZfzvANHkYprxsYD/GYABiExAzS+yWcX/IwEATEu8V7w3vNc5skvVvt7Qyj2zAVSVVqvJj3d6nD37MeAxJimSh+qxuj5DMVNUA7t/wFNHInSC2mhyh6AkyQrd3gOKYhcRv2/V6dOJCBoCjWSJNG2jqiSpAPrQUaLpTXk+4mhnyObma4QAWTZABNJ0AdWDk5mB98bFi9fJ8gWSxBFCybQt/gagqjSbTU6cOMknl66xvd0DjJdfWmNj41WGwwznBFVIU0+z1WQwDMRRNNMUUyJXzIYQyPOMbvcB8DSqSre7S1mOKIoc5xxmRp57NITaebMjmvlVqmq8czingOJ8Zd8DK8pB3ke0y34n26y/qutp8n45dEQ1fPA+qkU0MzMxM4q8JMsCqkpelJgZqoZz4xvU6m6vZqs6bnxYA4hEBDNz/f7vliQtnBuQNBJL0xbr68cpw6+Asf7CsyRJimpFk1klcqOR4HxEVIvsfSzeRQAmApGZfQ9c/uLz81tpupB3Oidd736X7e0dVlc7rK4u1g6LuHXru30NzMA55f5vPfLc0CCEMkgIZTkY7Hog7PebiHNLS8uXKlQpqR5+O+wQEQVCvX6/lrHq+M13PmplWf760c7QnT79Cnt7h3nRFO+Fq1e/saLoRDd3rv10986Nb0WECMTAiOMkWzv+4qfPnyrY2nqb/p97+DletDFdcSz8/EtgNFrj3r0d7nJDRMT+AqKAkRUl/oStAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg=="><span id="alt_save" style="display: none; font-size: 24pt; font-family: wingdings;">&lt;</span></div>
<div id="menu_unlock" style="display: none; cursor: pointer;" onclick="unlock()"><img id="img_lock" style="display: inline;" alt="Unlock" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA%2FwD%2FAP%2BgvaeTAAAEnUlEQVR42o2WX2wUVRTGf3NnZ7a7tkvTdA1rlxSWthgwEpoawh9jS8SHxofqAyaGBzBBE15IBLTxwfgCGBITfZAXk%2FYBjDE09QGJpqKFGBKiDYkuVChd7KbbbbtLy3bb2dk%2Fs3N96M52t63ASU5m5t7c853zne%2FeOwoV9vDhwxpWWSgUypVelYphWfKnmnACrxd8z549rwB2yYslfwuoB9zAayWgXYBrXQQneKU3NzfvcrLs7%2B%2BXsVhMTk1NyVu3bsmK7N8EZCqVcr4PlUDXVlBpBw4ceDEajd7u7e0tJpNJDh48SDqdJpVK4ff7iUQi9Pf3A1wBWFpa4s6dOwDfA92rQdYAzM3NvQRw%2BvRp9erVq1YwGGT79u3s2LGDrVu3Eg6H87t376avr6%2B8ZnZ2lgcPHgAMAi2V%2FaribXp6WllcXLw4MTHByMgIR44ccW3YsOFDr9c76vP54vF4vKOnp6cvGo3S1NRUlVhrayvAp6vEsLYCALd7pUqPx3O%2FpaVl9OjRoxPnzp27%2FH9qOX78OMAMMF2psKoKxsfHBYBpmuUxr9c729raagQCAftJcrxw4QKACeQrx8sA4XBYDAwM1K5eaBiGb3h4uOn69es2z2bFdQG%2B%2FOiDd4bvz%2FQBDA4OkkgknAb%2BtjrCsWPHqK1dyUXXdS5dusThw4cvAreBfxyaFGeDhUIhMxUfJT8%2Fibn4iHzGIJtZYPFxCjOTAUDTNPQaN8Klorlr2NXTSywWI5FI0N7eDvAV8DUQKW3O6h4ouTS59AxGIkrWWCLzOMlcMsGSsQQSPJ4adK8HVRVo6spJUVdXx82bN9m3b98J4LsSwFoV2baNLC5TKG2wFXtZcxKEEKAoKELBtiWvn%2FqBzz45iRCCuro6VFV1wmwCtHVVBBIpJUiJlEViMynGJmYxM1kE0FBfy6aNcPZKnEgkghCCTIm%2BxsZGhoeH6erqugy8CvwJ5KopEipCCBShIIQk8Hw9HpEjs7CIRCBqdHq%2FvceNGzcoFAqMj49jWRaKoqDrOps3b2ZkZISOjo7fgZ3AXREKhbIrHBWxihZWvoCVL%2FDocZrJxBJT81kSCxne%2FfxXzp45g5TLlWqaRltbG21tbWzZsoX6%2Bnr8fj%2Fnz58H%2BAtocJUUlF0mSEFVVFSXC6G6aPR5EVkPGbeNXVJ3Z1cXhmGgKArbtm1D1%2FXl6hWl%2FOzs7HRS3ljdA9tCFjIUcovkc2mi8QTzyXlMw0RzucoBHDdNk0AgAEA0Gi2PO6BA%2FaoeKEhVQwg3Lk0nuLGBWlVimu4qwTmBQqEQwBeAbG5uPjU5OYmiKOTz%2Bf857Io2kiKyWMAqFLByuVJPLGTRAuCXoaEyHQCH3mg%2FeeLtnaecHW1ZFkNDQ870QtU9%2B%2FM3HzPx7zjZhSRZM0sulyWfzVKwiggUajw6g6Murl27hmEYaJpGMBgEIBaLoes6Y2Nj7N%2B%2FH%2BA94McywMt%2B%2FYW%2Fk%2FmpZznN9u7dy8DAALa9cv6Fw2GklHR3dwP0Aj8BdysrUAAV0EvP1X8Slfacz%2BeLp9Pp9ebeB%2F4A7gE55SnJPmneBTQAAaDO4bx06cwDFsB%2F1pf2UYdfB6cAAAAASUVORK5CYII%3D"><span id="alt_lock" style="display: none; font-size: 24pt; font-family: wingdings;">I</span></div>
<div id="menu_lock" style="display: none; cursor: pointer;" onclick="lock()"><img id="img_unlock" style="display: inline;" alt="Lock" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAB3RJTUUH1wMbFisGhO%2Br5wAAAAlwSFlzAAALEwAACxMBAJqcGAAAAARnQU1BAACxjwv8YQUAAANZSURBVHja3VTPT1NZGD3vvZYWGGqVNgKyEBZqwsRYtRpjJpkdMbNk5YrMZjYQF27c%2Bxe4MCxcIJmdyRAjGxMX%2FohKUGMgMAt%2BTCJ0CtqR2tLS9%2Fp%2B3eu5r8UEZphS48qbnL57b9895%2FvO970LfK%2FjKjFJlIhHxH0i9a3Ib%2Fb396%2BPj4%2FLjY0NOTMzIycmJvxEImHyv1%2BbJTP2rG8PDw9fn5ycjPX19aFYLCIWi6Gnp0cbGBgI5%2FP5XzKZjMb3nn1N5FfS6bRZKBTk%2FPx8ZWho6C337GQymR0ZGbHn5ubk1NSUHBwcLNctbHo8YHRycXFRplKpP7ieIS4TP8Xj8eejo6OmsmtsbMzh3r2m2elxMZfLyenp6QqXK8TPRCuhLEn39vZm19bWpKoN1wsH5dV3Jp2dnZFKpYJyuawIbGKeqBJq%2FSabzYrNzU10d3Wp15MHFQjtTJaWlm6xe4bry8eEl2zVb3UfO3rt71wRoegPePniBeUEWiPhoyFDlwQOd7SjI9EN27ZRyr9HV4eB5Wzx3rYbdJyl7RGMEXHCJ3KEW1h5AiE0eJ6A8F3OHVjFf%2Fj0gtSE70G4Nnzbgl%2B18ObhXfz2%2B7riOkvMhvYIlOr4MjSyWPlVlHKr8Cng2xXYTpWJCEgpKcw9x4S3XYBjbkEEssHo2lWD%2FYYQPiSjrC3okFarOnQdmq5B09QGaTQ1N0j4xRRjVw32HzKIlD9YWPgTy6vrsMxqEJlQbdYWxYnjx5CIePBdZiPkrtMNBTSdUdWjPX%2FpAk6fs%2BDRJk9lRZuEWw1sK7ERAuo9VW2cAS1SZJ7jYPbt7P4ZtNTIQ0aoOQHJUwa9NUJhnLuYxunUKbhsSZ%2BiyjqpCuxWsJ3jnPZE2w%2FzVKYJAeEFNrhOBXOzK%2FtmEIcXNITREm22BjqkEWYdIjh74Qx%2BPHOSNbAhpAgKr%2Fz3XQvlDwZaolG4bqTJGvhsU6hWdWFuleHwg1K9L%2Bqtqz4yzzah0cJo2yGU88Vdx40G9O3p%2FrbLbRo9%2FpiBVSrALH9ClVCdJDybNVDZaAxCh7W9haevlvH6nfmUZ3mv4K%2F%2FZaf6RT7uoHbhHRRPiBvEeeBfXftfGjhC9KD26YcbWlq7xz4SWeJDI4EdEUXccoCAdoZqJZf49Bkd5rOdXLtvgwAAAABJRU5ErkJggg%3D%3D"><span id="alt_unlock" style="display: none; font-size: 24pt; font-family: wingdings;">C</span></div></td></tr></tbody></table></div><br><br>
<div id="text_area" style="display: none;">
<div class="menu_area" id="sw_menu_area" style="position: absolute;">
<div class="wiki" id="menu_area" ondblclick="menu_dblclick()"></div>
<div id="menu_edit_button" style="display: inline;">
<hr>

<div style="text-align: center;"><a class="link" onclick="edit_menu()">[Edit]</a></div></div></div>
<div class="text_area" id="wiki_text" ondblclick="page_dblclick()"></div></div>
<div id="edit_area" style="display: inline;">
<div id="edit_page_title" style="display: block;">Page title: <input id="wiki_page_title" size="50" value="Main Page"></div><textarea id="wiki_editor" style="width: 994px; height: 430px;" rows="0" cols="0"></textarea> 
<table style="font-size: 8pt;">
<tbody>
<tr>
<td>[[link]]</td>
<td>[[http://link.com]]</td>
<td>*bold*</td>
<td>* list</td>
<td>!header</td>
<td>--- (ruler)</td></tr>
<tr>
<td>[[text|link]]</td>
<td>_underline_</td>
<td>/italic/</td>
<td># numbered list</td>
<td>!!subheader</td>
<td><a class="world" onclick="open_table_help()">(tables)</a></td></tr></tbody></table></div>
<div id="debug_info" style="display: block;">
<h2>Debug console</h2>
<p>This is a development BETA version of Wiki On a Stick; it is not suggested to use it with important data. If you want to disable this debug console, you will have to find the line that says <b><tt>var debug = true;</tt></b> and change it to <b><tt>false</tt></b>. Note: in the currently active debug mode changes will be saved only if <b><tt>var save_override</tt></b> is set to <b><tt>true</tt></b></p>
<div align="center"><textarea id="swlogger" ondblclick="el('swlogger').value=''" style="width: 90%; background-color: #CCCCCC;" rows="12" readonly="readonly" cols="70"></textarea><br><input onclick="el('swlogger').value=''" value="Clear" type="button"></div></div>
<hr>

<div align="center"><sub><a class="link" onclick="go_to('Special::About')">About Wiki on a Stick v0.9B</a></sub></div></body></html>